import{a as xt,g as Le,h as Ct,i as zt,j as Ie,k as Me,m as Nt,n as Oe}from"./chunk-A36NQ4WF.js";import{a as dt,b as Ve,c as St,g as ze}from"./chunk-TSZP6UXS.js";import{a as He}from"./chunk-IOEYPKEV.js";import{a as Ue,c as $e,h as Fe}from"./chunk-NYGFFQMG.js";import{b as We,d as Ge}from"./chunk-3MQH4JJT.js";import{a as Be}from"./chunk-NZY4JV6E.js";import{c as Pe}from"./chunk-4GT6T77M.js";import{a as mt,b as Fi}from"./chunk-N3RCD34N.js";import{b as Ne,c as Se,m as Ae,n as De,o as Ee,p as Re}from"./chunk-E4QNY2PC.js";import{a as Ce}from"./chunk-B7GBMFFD.js";import{a as tt}from"./chunk-Z6PVZUDE.js";import{a as A}from"./chunk-FEK2HJKI.js";import{a as xe}from"./chunk-NJ63VSGO.js";import{a as O}from"./chunk-OTRTIFBS.js";import{a as et}from"./chunk-MFYKHTND.js";import{I as Te,J as it,a as g,b as j,c as p,l as Vi}from"./chunk-3I3QPOUL.js";import{c as s,e as Vt,f as b,h as c,i as ye,n as ve,q as T,u as d}from"./chunk-4SRFE46V.js";import{a as Bi}from"./chunk-LC5XJ32R.js";import{q as M}from"./chunk-52XVUBCW.js";import{c as $i}from"./chunk-42JNP4CL.js";import{m as Ui}from"./chunk-SOWOQI5E.js";import{e as a}from"./chunk-3GYLW4KZ.js";var Co=e=>T("domainLocalStorageGet",{domain:b(),key:e});var Do=e=>T("domainLocalStorageRemove",{domain:b(),key:e});Fi();function Ye(){let e=b(),t=s.get("tabId");return s.get(["couponsDisabledSites",`${e}_${t}`])>mt()||s.get(["couponsDisabledSites",`${e}_all`])>mt()}function qe(){let e=b(),t=s.get("tabId");return s.get(["cashbackDisabledSites",`${e}_${t}`])>mt()||s.get(["cashbackDisabledSites",`${e}_all`])>mt()}var Ze=a(M());$i();function Y(){let e=s.get(["session"]);return e&&e.roles&&e.roles.indexOf("shadow")===-1}var Xe=e=>T("confirmEmailAddress",e);var Ke=e=>T("emailCreateAccount",e);var Je=a(M());function Ht(e){let t;if(e&&e.responseText)try{t=Je.default.get(JSON.parse(e.responseText),"error")}catch{t=null}return t}async function ut(e){try{return await Xe(e)}catch(t){return{error:Ht(t)||"There was an error"}}}async function ft(e){try{return await Ke(e)}catch(t){return{error:Ht(t)||"There was an error"}}}var Qe=a(p()),Wt,At=1e3*60*60*24,zi=At*30;async function Hi(e,t){switch(e.type){case dt.Destroy:t?.(),s.set("emailCreateAccountVisible",!1);break;case dt.NotificationShow:d("track","extEmailCreateAccount",{action:"seen"});break;case dt.NotificationDismiss:await ft({message:"dismiss"}),d("track","extEmailCreateAccount",{action:"dismissed"}),s.set("emailCreateAccountVisible",!1);break;case dt.Custom:e.eventName==="onCreateAccountClick"?(await ft({message:"clickedCreateAccount"}),d("track","extEmailCreateAccount",{action:"clicked"})):e.eventName==="onSignInClick"&&(await ft({message:"clickedSignIn"}),d("track","extEmailCreateAccount",{action:"signIn"})),s.set("emailCreateAccountVisible",!1),t?.();break}}function Wi(e){let t=e||s.get(["cashback","reward"]);if(!t)return"Rewards";let i=t.categories||t.estimated?"up to ":"";if(t.type==="percentage")return`${i} ${t.amount/100}% Rewards`;let o=t.tiers?.length?t.tiers[t.tiers.length-1].reward.value:t.amount,n=t.tiers?.length?t.tiers[t.tiers.length-1].spend_cents:t.threshold,r=t.type==="threshold"&&n?A(n,{currency:t.currency}):"",l=t.type==="threshold"&&n?` when you spend ${r}`:"",m=A(o,{currency:t.currency});return`${i+m} Rewards${l}`}async function Dt(e){if(await Gt()){let i=await Fe(),o=Wi(e),n={rootEl:"div",logLevel:void 0};Wt?.(),Wt=(await it({appName:"emailCreateAccountNotification",blankSlate:!0,app:(0,Qe.jsx)(St,{config:n,content:i,data:{rewardsText:o},user:{featureFlags:ye()},onEvent:l=>Hi(l,Wt),onRequest:ze}),disableDelay:!0})).unloadApp,s.set("emailCreateAccountVisible",!0)}}async function Gi(){let e=await ft({message:"getEvents"}),t=Ze.default.chain(e).pickBy(m=>new Date().valueOf()-new Date(m).valueOf()<zi).value(),i="hasClickedEmailSignIn"in t&&new Date().valueOf()-new Date(t.hasClickedEmailSignIn).valueOf()<At;if("hasClickedEmailCreateAccount"in t&&new Date().valueOf()-new Date(t.hasClickedEmailCreateAccount).valueOf()<At||i)return!0;let n="seenEmailCreateAccount1"in t&&"seenEmailCreateAccount2"in t&&"seenEmailCreateAccount3"in t,r=new Date(Math.max(new Date(t.seenEmailCreateAccount1||0).valueOf(),new Date(t.seenEmailCreateAccount2||0).valueOf(),new Date(t.seenEmailCreateAccount3||0).valueOf())),l=r&&new Date().valueOf()-r.valueOf()<At;return!!(n||l)}async function Gt(){let e=c("ext_email_create_account_notification_control"),t=s.get("emailCreateAccountVisible");return Y()||e||t||await Gi()?!1:c("ext_email_create_account_notification_enabled")}var ti=a(g()),L=a(g()),q=a(M());var je=e=>T("getElevatedCashback",e);var Yt=()=>T("setReactivateNotifThrottled",{domain:b()});var w=a(p()),Yi=({children:e})=>(0,w.jsx)("div",{className:"bg-overlay flex justify-center items-center fixed top-0 left-0 w-screen h-screen z-[9999]",children:e}),qi=({children:e})=>(0,w.jsx)("div",{className:"bg-white rounded-lg flex flex-col items-center p-2 w-[400px] h-[240px]",children:e}),Xi=({children:e})=>(0,w.jsx)("div",{className:"mt-2 flex justify-between w-full",children:e}),Ki=({children:e})=>(0,w.jsx)("div",{className:"flex flex-col items-center mt-8 w-full",children:e}),Ji=e=>{let t=s.get("cashback"),[i,o]=(0,L.useState)(e.hasActivatedCompetitor||e.warnAboutStandDown),[n,r]=(0,L.useState)(q.default.get(t,"user.compInactivated")),[l,m]=(0,L.useState)(n&&i),[N,h]=(0,L.useState)(!1),[y,S]=(0,L.useState)(!1),[E,v]=(0,L.useState)("Re-activate Rewards"),[C,P]=(0,L.useState)(q.default.get(e.view,"reward",{})),pt=q.default.get(e,"view.exclusions"),vt=async()=>{let G=e.tld,H=await je({domain:G}),U=q.default.get(H,"reward.amount");U&&q.default.isNumber(U)&&C.amount!==U&&(s.set(["cashback","id"],H.id),P(H.reward))};(0,L.useEffect)(()=>{c("notif_reactivation_elevated")&&(i||n)&&vt(),Ie(e.tld)},[]),(0,L.useEffect)(()=>{l&&d("page","rewardsReactivation",{view:"rewardsReactivation",type:"notification"})},[l]);let Ft=async()=>{let G=await Ct();s.merge({cashback:G}),r(q.default.get(s.get("cashback"),"user.compInactivated")),o(e.hasActivatedCompetitor||e.warnAboutStandDown)};(0,L.useEffect)(()=>{(e.hasActivatedCompetitor||e.warnAboutStandDown)&&Ft()},[e.hasActivatedCompetitor,e.warnAboutStandDown]),(0,L.useEffect)(()=>{n&&i&&m(!0)},[n,i]);let Li=async()=>{let H=s.get(["couponView","hasDeferredCouponRewards"])?"Activate":"Re-activate",U=`${H} Rewards`;if(c("notif_reactivation_elevated")){let ke=C.type==="percentage"?`${C.amount/100}%`:A(C.amount,{currency:C.currency}),Bt=`${H} ${ke} back`;return C.categories&&(Bt=`${H} up to ${ke} back`),v(Bt),Bt}return v(U),U};(0,L.useEffect)(()=>{Li()},[C]);let Ii=async(G={})=>{h(!0),await Nt({reward:C,view:"cashbackReactivate",label:E}),h(!1),S(!0),Yt(),setTimeout(()=>m(!1),1e3)},Mi=()=>{d("trackClick","viewExclusionDetails","view details"),window.open(`${O}/s/${e.tld}/coupon`,"_blank")},Oi=(G,H=!1)=>{let U=q.default.get(e.view,"reward",{});m(!1),H||(d("trackClick","dismissCashbackNotification",G,{rewardAmount:U.amount,rewardDisplay:U.type}),xt("rewardsReactivation",G,"dismiss","primary",{rewardAmount:U.amount,rewardDisplay:U.type})),Yt()};return(0,w.jsx)(ti.default.Fragment,{children:l?(0,w.jsx)(Yi,{children:(0,w.jsxs)(qi,{children:[(0,w.jsxs)(Xi,{children:[(0,w.jsx)(et,{greyscale:c("ext_alternative_logo_1"),swoosh:c("ext_alternative_logo_2")}),(0,w.jsx)(tt,{onClick:()=>{Oi(E)}})]}),(0,w.jsxs)(Ki,{children:[(0,w.jsx)("p",{className:"text-2xl leading-9 font-bold text-neutralprimary",children:"Oops! Rewards were disabled."}),(0,w.jsx)("p",{className:"leading-6 text-neutralsecondary",children:"You used another coupon site."}),N?(0,w.jsx)("h5",{className:"bold rewards-only-button red",children:"Activating..."}):y?(0,w.jsx)("h5",{className:"bold rewards-only-button red",children:"Activated!"}):(0,w.jsx)("button",{className:"primary-btn-large red-btn-test",style:{width:"90%",marginTop:"16px"},onClick:Ii,children:E}),(N||y)&&(0,w.jsx)("div",{className:`exclusions-wrapper ${N||y?"visible":"invisible"}`,children:(0,w.jsx)("h6",{style:{height:"30px",display:"flex",marginTop:"10px",paddingLeft:"3px",textAlign:"center"},children:(0,w.jsxs)("span",{children:[(0,w.jsx)("div",{children:"* Rewards may vary based on exchange rates."}),pt?(0,w.jsxs)("div",{children:[" ","Terms and exclusions apply,",(0,w.jsxs)("span",{className:"tertiary-link-lighter",onClick:Mi,children:[" ","view details."]})]}):null]})})})]})]})}):null})},qt=j({view:["cashbackView"],couponView:["couponView"],offers:["offers"],deweyResult:["deweyResult"],events:["events"],session:["session"],settings:["settings"],tld:["siteAPIData","siteData","tld"],hasActivatedCompetitor:["hasActivatedCompetitor"],warnAboutStandDown:["warnAboutStandDown"],couponsVisible:["couponsVisible"]},Ji);var ei=a(M());var Zi=ei.default.debounce(()=>{d("track","standDownIndicator")},5e3,{leading:!0,trailing:!1}),ii=Zi;var x=a(M()),Pi=a(Ui());var uc=a(g()),Ri=a(g()),Ti=a(Vi()),wt=a(xe()),k=a(M());var oi=e=>T("setSeenCashbackNotification",e);function Et(){return c("ext_notif_center")}function Qi(e){return Et()?!1:c("coup_shift_left")?!0:c("n_or_1")&&e}function ai(e){return Et()?{left:"50%",right:"auto",translateX:"-50%"}:Qi(e)?{left:void 0,right:310,translateX:"initial"}:{left:void 0,right:void 0,translateX:"initial"}}var Xa=a(g()),si=a(M());var Ma=a(g()),ni=a(g()),ht=a(xe()),ri=a(M());var R=a(p()),Xt=class extends ni.Component{constructor(...t){super(...t),this.state={hideNotification:!1}}componentDidMount(){d("track","extEmailConfirmation",{action:"displayed"})}render(){let{hideNotification:t}=this.state,{email:i}=ri.default.get(this.props,"session");return(0,R.jsx)("div",{className:t?"disabled email-confirmation-page":"email-confirmation-page",style:{top:"0",bottom:"auto",left:"auto",right:"0"},children:(0,R.jsx)(ht.Motion,{style:{opacity:(0,ht.spring)(t?0:1,{stiffness:180,damping:20}),y:(0,ht.spring)(t?!0?-100:100:0,{stiffness:180,damping:20})},children:({opacity:n,y:r})=>(0,R.jsxs)("div",{className:"email-confirmation-notification",style:{transform:`translate3d(0,${r}%,0)`,opacity:`${n}`},children:[(0,R.jsxs)("header",{children:[(0,R.jsx)(et,{}),(0,R.jsx)(tt,{onClick:this.onClosePopup.bind(this)})]}),(0,R.jsxs)("section",{children:[(0,R.jsx)("h5",{style:{fontWeight:"600",color:"black"},children:"Please verify your email address so we can notify you when your rewards are ready to use!"}),(0,R.jsx)("br",{}),(0,R.jsxs)("h5",{children:["The email address associated with your account is"," ",(0,R.jsx)("span",{style:{fontWeight:"bold",color:"black"},children:i})]}),(0,R.jsx)("div",{className:"button-wrapper",children:(0,R.jsx)("button",{className:"primary-btn-large",onClick:this.onConfirm.bind(this),children:"Confirm"})}),(0,R.jsx)("div",{className:"link-wrapper",children:(0,R.jsx)("a",{className:"not-your-email-link",href:"https://capitaloneshopping.com/help",target:"_blank",rel:"noopener noreferrer",onClick:this.onNotYourEmailClicked.bind(this),children:"Not your email?"})})]})]})})})}async onClosePopup(){await ut({message:"dismiss"}),d("track","extEmailConfirmation",{action:"dismiss"}),s.set("emailConfirmationVisible",!1),this.setState({hideNotification:!0})}async onConfirm(){await ut({message:"confirm"}),d("track","extEmailConfirmation",{action:"confirm"}),s.set("emailConfirmationVisible",!1),this.setState({hideNotification:!0})}async onNotYourEmailClicked(){d("track","extEmailConfirmation",{action:"notYourEmail"})}},Kt=j({session:["session"]},Xt);var ci=a(p()),Jt=1e3*60*60*24,ji=Jt*7,to=Jt*270;async function Zt(){await eo()&&(it({appName:"emailConfirmation",cssUrl:"cashback.css",app:(0,ci.jsx)(Kt,{}),disableDelay:!0}),s.set("emailConfirmationVisible",!0))}async function eo(){if(s.get("emailConfirmationVisible")||!c("email_unengaged"))return!1;let e=await ut({message:"getEvents"}),t=si.default.chain(e).pickBy(l=>new Date-new Date(l)<to).value();if("hasConfirmedEmail"in t&&new Date-new Date(t.hasConfirmedEmail)<ji)return!1;let o="seenEmailConfirmation1"in t&&"seenEmailConfirmation2"in t&&"seenEmailConfirmation3"in t,n=new Date(Math.max(new Date(t.seenEmailConfirmation1||0),new Date(t.seenEmailConfirmation2||0),new Date(t.seenEmailConfirmation3||0))),r=n&&new Date-n<Jt;return!(o||r)}var me=a(g()),xi=a(g()),Q=a(M());var li=a(g()),pi=a(g()),bt=a(M());var D=a(p()),Qt=class extends pi.Component{constructor(t){super(t),this.state={expanded:!1}}toggleContainerSize(t){t.preventDefault(),this.setState({expanded:!this.state.expanded})}onShowExclusion(){d("trackClick","viewExclusionDetails","view details"),window.open(`${O}/s/${this.props.tld}/coupon`,"_blank")}render(){let{expanded:t}=this.state,{center:i,couponCount:o,displayInModal:n,hasCoupons:r,reward:l,runTimeSeconds:m,showCouponCount:N,showDismiss:h,showReward:y}=this.props,S=y?l.type==="percentage"?`${l.amount/100}%`:A(l.amount,{currency:l.currency}):"",E=l&&bt.default.get(l,"categories.length",0)>5,v=5,C=bt.default.get(l,"categories")||[],P=t?C:C.slice(0,v);return l.categories?(0,D.jsxs)("div",{className:`simple-section ${i?"center":""} ${n?"display-in-modal":""}`,children:[y&&(0,D.jsxs)("div",{className:"reward-text",children:[(0,D.jsxs)("h2",{children:["Up to ",(0,D.jsx)("span",{className:"palmetto",children:S})," in Rewards Activated"]}),N&&(0,D.jsxs)("h6",{className:"bold center",children:[o," ",o===1?" code ":" best codes "," tested in"," ",m," sec."]}),(0,D.jsxs)("h6",{className:"exclusion-text center",children:["*Rewards may vary based on exchange rates. Terms and exclusions apply",bt.default.get(this.props,"view.exclusions")?(0,D.jsxs)(li.default.Fragment,{children:[","," ",(0,D.jsx)("span",{className:"tertiary-link-lighter",onClick:this.onShowExclusion.bind(this),children:"view details."})]}):null]})]}),(0,D.jsxs)("div",{className:"reward-categories",children:[(0,D.jsx)("h5",{className:"bold",children:"Rewards by Category"}),(0,D.jsxs)("div",{className:`cashback-category-section ${r&&"show-border"}`,children:[(0,D.jsx)("div",{className:`cashback-category-container ${t&&"expanded"}`,children:bt.default.map(P,({name:pt,amount:vt,type:Ft})=>(0,D.jsxs)("div",{className:"cashback-category-row",children:[(0,D.jsx)("p",{className:"cashback-category-name",children:pt}),(0,D.jsx)("span",{className:"cashback-category-reward",children:Ft==="percentage"?`${vt/100}%`:A(vt)})]},pt))}),E&&(0,D.jsxs)("h5",{className:"toggle-container-cta",onClick:this.toggleContainerSize.bind(this),children:["Show ",this.state.expanded?"all":"fewer"," categories"]})]})]}),h&&(0,D.jsx)("div",{className:"dismiss-notif",children:(0,D.jsx)("h4",{className:"primary-link bold",onClick:this.props.onClosePopup.bind(this),children:"Continue to Checkout"})})]}):null}},jt=Qt;var Rt=a(p()),io={width:40,height:25,color:"#adb9bf",marginTop:0};function mi({style:e,flex:t,width:i,height:o,color:n,onClick:r,marginTop:l,marginRight:m,marginLeft:N}){return(0,Rt.jsx)("div",{style:{...e,display:"flex",flex:t,justifyContent:"right",alignItems:"center",width:i,height:o,color:n,marginTop:l,marginRight:m,marginLeft:N},onClick:r,children:(0,Rt.jsx)("svg",{width:"28",height:"29",viewBox:"0 0 28 29",fill:"none",style:{cursor:"pointer"},"aria-label":"Settings",role:"button",xmlns:"http://www.w3.org/2000/svg",children:(0,Rt.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M25.9952 15.1504L23.019 18.1266V22.3506C23.019 22.9802 22.5039 23.4953 21.8743 23.4953H17.6389L14.6627 26.4715C14.2163 26.9179 13.4951 26.9179 13.0487 26.4715L10.0725 23.4953H5.84855C5.21896 23.4953 4.70385 22.9802 4.70385 22.3506V18.1152L1.72765 15.139C1.28121 14.6926 1.28121 13.9714 1.72765 13.525L4.70385 10.5488V6.32485C4.70385 5.69527 5.21896 5.18015 5.84855 5.18015H10.0725L13.0601 2.20395C13.274 1.9896 13.5643 1.86914 13.8671 1.86914C14.1699 1.86914 14.4603 1.9896 14.6741 2.20395L17.6503 5.18015H21.8743C22.5039 5.18015 23.019 5.69527 23.019 6.32485V10.5488L25.9952 13.5364C26.4416 13.9829 26.4416 14.704 25.9952 15.1504ZM6.99317 14.3379C6.99317 18.1268 10.0724 21.2061 13.8613 21.2061C17.6503 21.2061 20.7295 18.1268 20.7295 14.3379C20.7295 10.549 17.6503 7.46973 13.8613 7.46973C10.0724 7.46973 6.99317 10.549 6.99317 14.3379Z",fill:"#B4BDC2"})})})}mi.defaultProps=io;var _t=mi;var ot=a(g());var I=a(p());function oo(e){let[t,i]=(0,ot.useState)(!1),o=l=>{let m=(0,ot.useRef)();return(0,ot.useEffect)(()=>{let N=()=>{l()};return document.addEventListener("click",N,!0),()=>{document.removeEventListener("click",N,!0)}},[m]),m},n=()=>{setTimeout(()=>{i(!1)})};return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)("div",{style:{width:48},children:(0,I.jsx)(_t,{onClick:()=>i(!t),style:{position:"fixed",top:14,right:15}})}),t?(0,I.jsx)(()=>(0,I.jsx)("div",{ref:o(n),className:"notification-menu",children:(0,I.jsxs)("ul",{children:[(0,I.jsx)("li",{children:(0,I.jsx)("p",{onClick:e.confirmDismiss,className:"menu-item",children:"Dismiss Notification"})}),(0,I.jsx)("li",{children:(0,I.jsx)("p",{onClick:e.snoozeNotification,className:"menu-item",children:"Snooze for 24 Hours"})})]})}),{}):null]})}var te=oo;var di=e=>T("notificationThrottlingSet",{type:e,value:!0});var ui=e=>{e.stopPropagation();let t=`${O}/my-rewards/lifetime-savings`;d("trackClick","showSettingSiteHub","x"),window.open(t,"_blank")},fi=e=>()=>{di("24_hr_throttle_all"),e("Snooze for 24 Hours")},at=(e,t,i,o,n)=>{e.stopPropagation(),o?(i(t,!0),d("trackClick","dismissCompetitorClickWarning",t,{rewardAmount:n?.amount,rewardDisplay:n?.type})):i(t)};var Tt=a(p()),Pt=({hasActivatedCompetitor:e,onUserClosePopup:t,reward:i})=>c("ext_notif_snooze")&&t?(0,Tt.jsx)(te,{confirmDismiss:()=>t("Dismiss Notification"),snoozeNotification:fi(t)}):e!=null&&c("cb_cta_ui_control")&&!e?(0,Tt.jsx)(_t,{onClick:ui,style:{position:"fixed",top:14,right:15}}):t?(0,Tt.jsx)(tt,{onClick:o=>at(o,"x",t,e,i),style:{position:"fixed",top:19,right:15,width:11,height:11}}):null;var F=a(p());function ee({text:e,hoverTitle:t,hoverText:i,side:o="bottom",sideOffset:n=25}){return(0,F.jsx)(Ae,{delayDuration:100,skipDelayDuration:100,children:(0,F.jsxs)(De,{children:[(0,F.jsx)(Ee,{asChild:!0,children:(0,F.jsxs)("p",{className:"inline text-xs text-gray-600",children:[e,(0,F.jsx)(Ne,{className:"h-4 w-4"})]})}),(0,F.jsxs)(Re,{className:"w-[305px] p-4",side:o,sideOffset:n,children:[t&&(0,F.jsx)("p",{className:"text-sm font-[Circular-Pro-Black] mb-2",children:t}),(0,F.jsx)("p",{className:"text-xs",children:i})]})]})})}var B=a(p());function ao(){d("trackClick","viewExclusionDetails","view details"),window.open(`${O}/s/${b()}/coupon`,"_blank")}function ie({reward:e,containerStyle:t}){if(e?.type!=="threshold"&&!e?.threshold)return null;let i=s.get(["siteAPIData","siteData","merchantPage","exclusions"]);return(0,B.jsx)("div",{style:t,children:(0,B.jsx)(ee,{side:"left",text:"*Terms and Conditions Apply",hoverTitle:"This limited time offer is available for one use only.",hoverText:(0,B.jsxs)(B.Fragment,{children:["The spend requirement must be met in a single transaction, on non-excluded items, after discounts, store credits, and redemption dollars are applied, and before taxes and shipping fees are applied.",i&&(0,B.jsxs)(B.Fragment,{children:[" ","Exclusions apply,"," ",(0,B.jsx)("span",{className:"tertiary-link-lighter",onClick:ao,children:"view details"}),"."]})]})})})}var bi=a(Bi());var Lt=a(g());var no=["data:image/jpeg;base64,","data:image/png;base64,","data:image/webp;base64,"];async function oe(e){try{let t=await fetch(e).then(o=>o.blob());return await new Promise(o=>{let n=new window.FileReader;n.onload=()=>{let r=n.result,l=!!r&&no.some(m=>r.startsWith(m));o(l?r:null)},n.readAsDataURL(t)})}catch{return null}}function ae(e){let[t,i]=(0,Lt.useState)("");return(0,Lt.useEffect)(()=>{async function o(){i(await oe(e))}e&&o()},[e]),t}var jn=a(g()),f=a(p());function ro(){return(0,f.jsx)("svg",{width:"129px",height:"128px",viewBox:"0 0 159 158",version:"1.1",xmlns:"http://www.w3.org/2000/svg",style:{height:"100%"},children:(0,f.jsxs)("g",{stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd",children:[(0,f.jsxs)("g",{transform:"translate(1.508527, 0.595868)",children:[(0,f.jsx)("mask",{id:"mask-2",fill:"white",children:(0,f.jsx)("polygon",{points:"0.0159903815 0.158395289 156.744206 0.158395289 156.744206 156.886611 0.0159903815 156.886611"})}),(0,f.jsx)("path",{d:"M156.744357,78.5224278 C156.744357,121.802055 121.659046,156.886611 78.3801738,156.886611 C35.1013011,156.886611 0.0159903815,121.802055 0.0159903815,78.5224278 C0.0159903815,35.2435551 35.1013011,0.158244436 78.3801738,0.158244436 C121.659046,0.158244436 156.744357,35.2435551 156.744357,78.5224278",fill:"#E8E9E9",mask:"url(#mask-2)"})]}),(0,f.jsx)("mask",{id:"mask-4",fill:"white",children:(0,f.jsx)("polygon",{points:"0 157.48263 158.252733 157.48263 158.252733 0.754263279 0 0.754263279"})}),(0,f.jsx)("polygon",{fill:"#39B449",mask:"url(#mask-4)",points:"21.114092 99.6562815 139.51985 99.6562815 139.51985 37.1844254 21.114092 37.1844254"}),(0,f.jsx)("polygon",{stroke:"#177C3E",strokeWidth:"3.852",mask:"url(#mask-4)",points:"27.0803145 94.3138347 133.554382 94.3138347 133.554382 43.1167061 27.0803145 43.1167061"}),(0,f.jsx)("path",{d:"M27.0803145,81.4809501 L27.0803145,94.3139856 L39.9141042,94.3139856 C39.9141042,87.2261735 34.1681266,81.4809501 27.0803145,81.4809501",fill:"#177C3E",mask:"url(#mask-4)"}),(0,f.jsx)("path",{d:"M39.9138779,43.1166307 L27.0800882,43.1166307 L27.0800882,55.9504204 C34.1686545,55.9504204 39.9138779,50.205197 39.9138779,43.1166307",fill:"#177C3E",mask:"url(#mask-4)"}),(0,f.jsx)("path",{d:"M133.554457,55.9501187 L133.554457,43.116329 L120.719913,43.116329 C120.719913,50.204141 126.465891,55.9501187 133.554457,55.9501187",fill:"#177C3E",mask:"url(#mask-4)"}),(0,f.jsx)("path",{d:"M120.720969,94.314061 L133.554005,94.314061 L133.554005,81.4802713 C126.466193,81.4802713 120.720969,87.226249 120.720969,94.314061",fill:"#177C3E",mask:"url(#mask-4)"}),(0,f.jsx)("path",{d:"M96.1528794,68.4205043 C96.1528794,78.3828137 89.0635589,86.4602192 80.3171219,86.4602192 C71.5714392,86.4602192 64.4821186,78.3828137 64.4821186,68.4205043 C64.4821186,58.4574407 71.5714392,50.3807895 80.3171219,50.3807895 C89.0635589,50.3807895 96.1528794,58.4574407 96.1528794,68.4205043",fill:"#177C3E",mask:"url(#mask-4)"}),(0,f.jsx)("polygon",{fill:"#177C3E",mask:"url(#mask-4)",points:"21.114092 102.9856 139.51985 102.9856 139.51985 99.6562815 21.114092 99.6562815"}),(0,f.jsx)("polygon",{fill:"#39B449",mask:"url(#mask-4)",points:"21.114092 106.314918 139.51985 106.314918 139.51985 102.9856 21.114092 102.9856"}),(0,f.jsx)("polygon",{fill:"#177C3E",mask:"url(#mask-4)",points:"21.114092 109.64499 139.51985 109.64499 139.51985 106.315672 21.114092 106.315672"}),(0,f.jsx)("polygon",{fill:"#39B449",mask:"url(#mask-4)",points:"21.114092 112.974308 139.51985 112.974308 139.51985 109.64499 21.114092 109.64499"}),(0,f.jsx)("polygon",{fill:"#177C3E",mask:"url(#mask-4)",points:"21.114092 116.303626 139.51985 116.303626 139.51985 112.974308 21.114092 112.974308"}),(0,f.jsx)("polygon",{fill:"#39B449",mask:"url(#mask-4)",points:"21.114092 119.632944 139.51985 119.632944 139.51985 116.303626 21.114092 116.303626"}),(0,f.jsx)("polygon",{fill:"#177C3E",mask:"url(#mask-4)",points:"21.114092 122.962263 139.51985 122.962263 139.51985 119.63219 21.114092 119.63219"}),(0,f.jsx)("polygon",{fill:"#39B449",mask:"url(#mask-4)",points:"21.114092 126.291581 139.51985 126.291581 139.51985 122.962263 21.114092 122.962263"}),(0,f.jsx)("polygon",{fill:"#F2F2F2",mask:"url(#mask-4)",points:"73.0526614 99.6562815 87.5812807 99.6562815 87.5812807 37.1844254 73.0526614 37.1844254"}),(0,f.jsx)("polygon",{fill:"#C6C6C5",mask:"url(#mask-4)",points:"73.0526614 126.291581 87.5812807 126.291581 87.5812807 99.6562815 73.0526614 99.6562815"}),(0,f.jsx)("polygon",{fill:"#E59534",mask:"url(#mask-4)",points:"8.87013617 131.013269 38.2011723 131.013269 38.2011723 126.208612 8.87013617 126.208612"}),(0,f.jsx)("polygon",{fill:"#FAB042",mask:"url(#mask-4)",points:"2.98235701 126.208612 32.3133932 126.208612 32.3133932 121.4032 2.98235701 121.4032"}),(0,f.jsx)("polygon",{fill:"#E59534",mask:"url(#mask-4)",points:"3.09775929 121.4032 32.4287954 121.4032 32.4287954 116.598543 3.09775929 116.598543"}),(0,f.jsx)("polygon",{fill:"#FAB042",mask:"url(#mask-4)",points:"5.92624659 116.598543 35.2572827 116.598543 35.2572827 111.793132 5.92624659 111.793132"}),(0,f.jsx)("polygon",{fill:"#E59534",mask:"url(#mask-4)",points:"2.98235701 111.793886 32.3133932 111.793886 32.3133932 106.988475 2.98235701 106.988475"}),(0,f.jsx)("polygon",{fill:"#FAB042",mask:"url(#mask-4)",points:"-0.000754263279 106.988475 29.3302819 106.988475 29.3302819 102.183818 -0.000754263279 102.183818"}),(0,f.jsx)("polygon",{fill:"#E59534",mask:"url(#mask-4)",points:"5.92624659 102.183818 35.2572827 102.183818 35.2572827 97.3784064 5.92624659 97.3784064"}),(0,f.jsx)("polygon",{fill:"#FAB042",mask:"url(#mask-4)",points:"2.94388958 97.3784064 32.2749257 97.3784064 32.2749257 92.5737493 2.94388958 92.5737493"})]})})}var hi=ro;var nt=a(p()),so="https://images.capitaloneshopping.com/api/v1/logos",co=({domain:e,width:t=300,height:i=300})=>{let o=ae(`${so}?${bi.default.stringify({domain:e,width:t,height:i})}`);return ve()?(0,nt.jsx)("div",{className:"partner-logo-component",children:o===null?(0,nt.jsx)("div",{className:"partner-logo",children:(0,nt.jsx)(hi,{})}):o?(0,nt.jsx)("div",{className:"partner-logo success",style:{backgroundImage:`url("${o}")`}}):(0,nt.jsx)("div",{className:"partner-logo"})}):null},ne=co;var V=a(p());function It({reward:e}){if(!e?.tiers?.length)return null;let t={currency:e.currency,truncateIntegers:!0};return(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)("h3",{className:"bold mt-3",id:"threshold-tiers","aria-hidden":!0,children:"Rewards by Spend"}),(0,V.jsx)("ol",{"aria-labelledby":"threshold-tiers",children:e.tiers.map((i,o)=>{let n=o<e.tiers.length-1,r=`Spend ${A(i.spend_cents,t)?.replace(n?/[ A-Z]/g:"","")}${n?"-"+A(e.tiers[o+1].spend_cents,t):"+"}`,l=i.reward.type==="percentage"?`${i.reward.value/100}% back`:A(i.reward.value,t);return(0,V.jsxs)("li",{className:"flex text-sm bold mt-2","aria-label":`${r}, earn ${l}`,children:[(0,V.jsx)("span",{className:"grow text-neutralsecondary","aria-hidden":!0,children:r}),(0,V.jsx)("span",{className:"shrink-0 whitespace-nowrap text-[#0276b1] pl-4","aria-hidden":!0,children:l})]},o)})})]})}var _i=a(g());var Z=a(p()),lo=e=>e>160&&e<171?e:160;function po(e){let[t,i]=(0,_i.useState)(!1),o=lo(e.exclusions.length),n=e.exclusions.length,r=e.exclusions.substring(0,o);return(0,Z.jsxs)("div",{className:"website-exclusions",children:[(0,Z.jsx)("h5",{className:"bold",children:"Exclusions Apply:"}),(0,Z.jsx)("p",{children:t?e.exclusions:`${r}${n>o?"...":""}`}),n>o?(0,Z.jsx)("div",{className:"exclusion-expand",children:(0,Z.jsx)("span",{className:"exclusion-expand-text",onClick:()=>i(!t),children:t?"Collapse":"Expand"})}):null]})}var re=po;var yi=a(g()),vi=a(g()),ct=a(M());var gi=a(g());function gt(e){return["wayfair.com","wayfair.ca","jossandmain.com","birchlane.com","allmodern.com","trade.wayfair.com","perigold.com"].includes(e)}var W=a(p()),mo=({onDetailsClick:e,exclusions:t=!0,...i})=>b()==="quill.com"?(0,W.jsx)("p",{style:{color:"#a2adb4",fontSize:"12px",fontFamily:'"Circular-Pro-Book", "Helvetica Neue", Helvetica, Arial, sans-serif',fontWeight:"normal",marginTop:"10px",lineHeight:"1.25em"},children:"*All HP, Epson, and Samsung products are excluded from coupons, discounts, and rewards offers."}):gt(b())?(0,W.jsx)("p",{style:{color:"#a2adb4",fontSize:"12px",fontFamily:'"Circular-Pro-Book", "Helvetica Neue", Helvetica, Arial, sans-serif',fontWeight:"normal",marginTop:"10px",lineHeight:"1.25em"},children:"*Items in cart prior to rewards activation will not be eligible for rewards."}):(0,W.jsxs)("h6",{...i,children:[(0,W.jsx)("span",{style:{marginRight:"3px"},children:"*"}),(0,W.jsxs)("span",{children:["Rewards may vary based on exchange rates.",t&&(0,W.jsxs)(gi.default.Fragment,{children:[" ","Terms and exclusions apply,",(0,W.jsxs)("span",{className:"tertiary-link-lighter",onClick:e,children:[" ","view details."]})]})]})]}),se=mo;var wi=a(g()),ki=a(M());var X=a(p()),ce=class extends wi.default.Component{constructor(...t){super(...t),this.state={}}componentWillMount(){}componentDidMount(){this.props.isCreditsReminderMessage&&setTimeout(()=>{d("page","creditIgnoreTooltip",{view:"cashbackNotification",type:"tooltip"}),chrome.storage.local.set({seenCreditsReminder:Date.now()})},Number(this.props.delay.replace("ms","")))}getCtaButtonText(){let t;try{let i=s.get(["shadowRootsByAppName","notification"]);if(i){let o=i();o&&(t=o.querySelector(".primary-btn-large").textContent)}}catch{}return t}render(){let{tipLabel:t,message:i,isCreditsReminderMessage:o}=this.props,n=this.props.style||{};if(this.props.delay){let r={animationDelay:this.props.delay};n=ki.default.merge(r,n)}return(0,X.jsx)("div",{style:n,className:`new-tooltip ${this.props.position||""}${o?" credits-reminder":""}`,children:(0,X.jsxs)("div",{style:this.props.innerStyle||{},onClick:this.props.onDismissTooltip.bind(this),className:"new-tooltip-wrapper",children:[(0,X.jsx)("div",{className:"close icon-x"}),o?(0,X.jsx)("div",{className:`triangle ${o?"credits-reminder":""}`}):null,(0,X.jsxs)("h2",{children:[this.props.tip?(0,X.jsx)("span",{className:"bold",children:t||"tip:"}):null,i]})]})})}},rt=ce;var st=a(p());function uo(e,{capitalize:t=!0}={}){return e.type==="threshold"&&e.threshold?t?"Earn ":"earn ":t?"Get ":"get "}function fo(e,{capitalizeUpTo:t=!1,hideUpTo:i=!1}={}){let o=!i&&(e.categories||e.estimated)?t?"Up to ":"up to ":"",n=e.tiers?.length?e.tiers[e.tiers.length-1].reward.type:e.type,r=e.tiers?.length?e.tiers[e.tiers.length-1].reward.value:e.amount,l=n==="percentage"?`${r/100}%`:A(r,{currency:e.currency,truncateIntegers:!0});return o+l}function ho(e){let t="";if(e.type==="threshold"&&e.threshold){let i=e.tiers?.length?e.tiers[e.tiers.length-1].spend_cents:e.threshold;t=` when you spend ${A(i,{currency:e.currency,truncateIntegers:!0})}`}return" back"+t}function Mt(e,{hidePrefix:t=!1,hideSuffix:i=!1}={}){return(0,st.jsxs)(st.Fragment,{children:[!t&&uo(e),(0,st.jsx)("span",{className:"brand",children:fo(e)}),!i&&ho(e)]})}var u=a(p()),le=class extends vi.Component{constructor(t){super(t),this.state={isLoggedIn:Y()},this.ebatesComparisonSiteList=["macys.com","oakley.com","puritanspride.com","ebay.com","walmart.com","marriott.com","sephora.com","zulily.com","tirerack.com","ancestry.com","samsclub.com","samsung.com","nordvpn.com","priceline.com","qvc.com","microsoftstore.com","starwoodhotels.com","discounttire.com","officedepot.com","lifelock.com","omahasteaks.com","woot.com","coursera.org","sixt.com","wsj.com","gilt.com"]}componentWillReceiveProps(t){t.showCreditsReminder!==this.state.showCreditsReminder&&!this.state.didDismiss&&this.setState({showCreditsReminder:t.showCreditsReminder})}renderHeadline(){let{deweyResult:t,reward:i,rewardProof:o}=this.props.view,n=ct.default.get(t,"pageData.order.total"),r;if(i.type==="percentage"?r=ct.default.round(n/100*(i.amount/100),2):r=i.amount,c("ext_rewards_show_estimate")&&n)return(0,u.jsxs)("div",{children:[(0,u.jsxs)("h2",{className:"centered",children:["Get ",i.categories||i.estimated?"up to ":"",(0,u.jsx)("span",{className:"palmetto",children:A(r,{currency:i.currency})})," ","back"]}),(0,u.jsxs)("div",{className:"dashed-border",children:[(0,u.jsxs)("div",{children:[(0,u.jsx)("h4",{className:"inline-block-table top",children:"Subtotal:"}),(0,u.jsx)("h4",{className:"table-text-end top",children:A(n,{currency:i.currency})})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)("h4",{className:"inline-block-table palmetto table-bottom",children:"Est. Rewards:"}),(0,u.jsx)("h4",{className:"table-text-end palmetto table-bottom",children:A(r,{currency:i.currency})})]})]})]});if(c("ext_rewards_show_proof")&&o?.avg_conf_time&&o?.avg_rewards){let l=ct.default.round(o.avg_conf_time);return(0,u.jsxs)("div",{children:[(0,u.jsxs)("h2",{className:"centered",children:["Found ",(0,u.jsx)("span",{className:"palmetto",children:"Rewards"})]}),(0,u.jsxs)("div",{className:"dashed-border",children:[(0,u.jsxs)("div",{children:[(0,u.jsx)("h4",{className:"inline-block-table top",children:"Avg. Confirmation Time:"}),(0,u.jsxs)("h4",{className:"table-text-end top",children:[l," ",l===1?"Day":"Days"]})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)("h4",{className:"inline-block-table palmetto table-bottom",children:"Avg. Earned:"}),(0,u.jsx)("h4",{className:"table-text-end palmetto table-bottom",children:A(o.avg_rewards*100,{currency:i.currency})})]})]})]})}return(0,u.jsx)("h2",{children:Mt(i)})}render(){let t=Vt(b()),i=c("ext_red_cta_202305")&&!t,o=this.props.activating&&!this.state.hasClickedToLogin,n=this.props.activated&&!this.state.hasClickedToLogin,{deweyResult:r,reward:l,vendor:m}=this.props.view,N=ct.default.get(r,"pageData.order.total"),h=c("ext_rewards_show_estimate")&&N>0||c("ext_rewards_show_proof"),y=o||n,S=l.amount/100>=5||!!l.categories||h,E=s.get(["couponView","partnerGroupsList"]),v=c("ac_elasticity_3")&&c("ac_elasticity_4")&&!E?.groupA?.includes(b())?"Activate Rewards":"Ok";return(0,u.jsxs)("div",{className:"simple-section",children:[y?(0,u.jsxs)("h2",{children:["Activating ",Mt(l,{hidePrefix:!0})]}):S?this.renderHeadline():(0,u.jsx)("h2",{children:c("ext_found_rewards")?"Found Rewards":c("ext_found_rewards_2")?"Unclaimed Rewards Detected!":"Found 1 offer"}),h?null:(0,u.jsxs)("h4",{className:"bold",children:["at ",m,"."]}),(0,u.jsx)("div",{className:"button-wrapper",children:Y()?(0,u.jsxs)(yi.default.Fragment,{children:[this.renderControl(v),b()==="quill.com"||gt(b())?(0,u.jsx)(se,{}):null,this.state.showCreditsReminder&&!(n||o)?(0,u.jsx)(rt,{tip:!0,isCreditsReminderMessage:!0,tipLabel:"Activating Shopping Rewards is completely free.",message:(0,u.jsx)("span",{className:"dismiss-text",children:"Click the \u201COk\u201D button to activate Rewards on your purchases that you can redeem for gift cards at top stores."}),delay:"7000ms",style:{top:"50%",transform:"translateY(-50%)",width:"360px",right:"calc(100% + 16px)"},onDismissTooltip:this.onDismissTooltip.bind(this)}):null]}):(0,u.jsx)("button",{className:`primary-btn-large ${i?"red-btn-test":""} ${c("notif_rounded_border")?"rounded-btn":""}`,onClick:this.onClickSignIn.bind(this),children:v})})]})}renderControl(t){let i=Vt(b()),o=c("ext_red_cta_202305")&&!i,n=this.props.activating&&!this.state.hasClickedToLogin;return this.props.activated&&!this.state.hasClickedToLogin?(0,u.jsx)("button",{className:`primary-btn-large ${c("notif_rounded_border")?"rounded-btn":""}`,disabled:!0,children:"Activated"}):n?(0,u.jsx)("button",{className:`primary-btn-large ${c("notif_rounded_border")?"rounded-btn":""}`,disabled:!0,children:"Activating"}):(0,u.jsx)("button",{className:`primary-btn-large ${o?"red-btn-test":""} ${c("notif_rounded_border")?"rounded-btn":""}`,onClick:l=>{l.stopPropagation(),this.props.onActivate({label:t})},children:t})}async onClickSignIn(t){t.stopPropagation(),this.setState({hasClickedToLogin:!0});let i=ct.default.get(this.props.view,"vendor"),o=await Gt();this.props.onActivate({preventHide:!this.state.hasClickedToLogin,shouldLoadEmailCreateAccountNotification:o}),d("track","signinRequired",{vendor:i}),o||window.open(`${O}/sign-in`)}},pe=le;var _=a(p()),de=class extends xi.Component{constructor(t){super(t),this.state={}}onShowExclusion(){d("trackClick","viewExclusionDetails","view details"),window.open(`${O}/s/${Q.default.get(this.props.view,"deweyResult.domain")}/coupon`,"_blank")}onConfirmDismiss(){let t=Q.default.get(this.props,"reward",{});d("trackClick","dismissCreditReminder","",{rewardAmount:t.amount,rewardDisplay:t.type}),this.props.onUserClosePopup("activate later",!0)}onShowNewUserDetails(){d("trackClick","viewNewUserBonusDetails","Details",{view:"cashbackNotificiation"}),window.open("https://help.capitaloneshopping.com/hc/en-us/articles/360047681572-How-do-I-earn-a-New-Member-Bonus-of-10-in-Wikibuy-Credits-on-my-first-purchase-","_blank")}render(){let{activating:t,activated:i}=this.props,o=!!Q.default.get(this.props,"reward.categories"),n=this.props.hasActivatedCompetitor,r=this.props.eligibleForNewUserBonus,l=Q.default.get(this.props.view,"reward"),m=s.get(["couponView","partnerGroupsList"]),N=c("ac_elasticity_3")&&c("ac_elasticity_4")&&!m?.groupA?.includes(b()),h=c("rewards_dismissal_1")||N?"No Thanks":c("rewards_dismissal_2")?"No thanks, I don't want rewards":c("rewards_dismissal_3")?"Decline Offer":"Activate Later",y=this.props.view.exclusions;return(0,_.jsxs)("div",{className:"cash-back-resolve",style:this.props.isLandscape?{padding:"20px 24px 0 0"}:void 0,children:[(0,_.jsx)(Pt,{hasActivatedCompetitor:n,onUserClosePopup:this.props.onUserClosePopup,reward:l}),(0,_.jsxs)("div",{className:"credit-prompt",children:[(0,_.jsx)(ne,{domain:b()}),(0,_.jsxs)("div",{children:[c("show_rewards")&&(0,_.jsx)("div",{className:"rewards-activation",children:(0,_.jsx)(pe,{...this.props,onShowExclusion:this.onShowExclusion.bind(this)})}),c("cb_cta_ui_control")&&!t&&!i&&!n?(0,_.jsx)(me.default.Fragment,{children:(0,_.jsx)("h4",{className:"bold activate-later tertiary-link",onClick:S=>at(S,h,this.props.onUserClosePopup,n,l),children:h})}):(i||t)&&(0,_.jsxs)("div",{children:[(0,_.jsxs)("h6",{style:{display:"flex",marginTop:"6px",paddingLeft:"3px",fontSize:"8px",lineHeight:"10px",paddingBottom:"10px",marginBottom:o?"15px":0,borderBottom:o?"1px solid #dedede":0},children:[(0,_.jsx)("span",{style:{marginRight:"3px"},children:"*"}),(0,_.jsxs)("span",{children:["Rewards may vary based on exchange rates.",Q.default.get(this.props,"view.exclusions")?(0,_.jsxs)(me.default.Fragment,{children:[" ","Terms and exclusions apply,",(0,_.jsx)("span",{style:{paddingLeft:"3px"},className:"tertiary-link-lighter",onClick:this.onShowExclusion.bind(this),children:"view details."})]}):null]})]}),o?(0,_.jsx)(jt,{reward:this.props.reward,tld:Q.default.get(this.props.view,"deweyResult.domain")}):null,(0,_.jsx)(It,{reward:this.props.reward}),(i||t)&&c("ext_exclusion_warning")&&y?(0,_.jsx)("div",{style:{paddingTop:"20px"},children:(0,_.jsx)(re,{exclusions:y})}):null]}),(0,_.jsx)(ie,{reward:l,containerStyle:{marginTop:12,textAlign:"left"}}),r&&(0,_.jsxs)("div",{className:"new-user-bonus",children:["Get an ",(0,_.jsx)("span",{className:"bold",children:"additional $10 in Shopping Rewards"})," today with a qualifying purchase of $25."," ",(0,_.jsx)("span",{className:"primary-link",onClick:this.onShowNewUserDetails.bind(this),children:"Details"})]})]})]})]})}},ue=de;var K=a(g()),$t=a(M());var fe=a(p());function Ot(){return(0,fe.jsx)("svg",{className:"w-4 h-4 animate-spin",viewBox:"0 0 512 512",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",children:(0,fe.jsx)("path",{d:"M304 48c0 26.51-21.49 48-48 48s-48-21.49-48-48 21.49-48 48-48 48 21.49 48 48zm-48 368c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zm208-208c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zM96 256c0-26.51-21.49-48-48-48S0 229.49 0 256s21.49 48 48 48 48-21.49 48-48zm12.922 99.078c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.491-48-48-48zm294.156 0c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.49-48-48-48zM108.922 60.922c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.491-48-48-48z"})})}var lt=a(g());function Ci({baobabBranch:e,contentSlug:t,contentProps:i}){let o=[e,t],[n,r]=(0,lt.useState)(null),[l,m]=(0,lt.useState)(null),[N,h]=(0,lt.useState)(!0),y=async()=>{let S=s.select(o);try{h(!0),S.set({loading:!0,error:null,data:null});let E=await Ue({contentSlug:t,contentProps:{domain:b(),...i},context:$e()});r(E),m(null),S.set(o,{loading:!1,data:E,error:null})}catch(E){let v=E;m(v),S.set(o,{data:null,error:v,loading:!1})}finally{h(!1)}};return(0,lt.useEffect)(()=>{y()},[]),{baobabSelector:o,data:n,error:l,loading:N,retry:y}}var Si=a(g());var Ni=a(g()),Ut=(0,Ni.createContext)({onUserClosePopup:()=>{},hasActivatedCompetitor:!1,reward:null});var he=a(p()),Ai=({children:e})=>{let{onUserClosePopup:t,hasActivatedCompetitor:i,reward:o}=(0,Si.useContext)(Ut);return t==null?null:(0,he.jsx)(Se,{variant:"tertiary",className:"mb-2 w-full",onClick:n=>at(n,e,t,i,o),children:(0,he.jsx)("span",{className:"text-gray-400 cursor-pointer font-semibold",children:e})})};var z=a(p());Ve(e=>{e("sp-energy-cashback-dismissal",Ai)});var bo="energy-cashback-notification",Di=(0,K.memo)(({reward:e,onUserClosePopup:t,hasActivatedCompetitor:i,onActivate:o})=>{let[n,r]=(0,K.useState)(!1),[l,m]=(0,K.useState)(!1),[N,h]=(0,K.useState)(!1),y={reward:e},{data:S,error:E,loading:v}=Ci({baobabBranch:"mirageCashback",contentSlug:bo,contentProps:y}),C=(0,K.useCallback)((0,$t.debounce)(async P=>{if("eventName"in P&&P.eventName===S?.events.activationEventName){r(!0);try{await o({label:S.ctaText}),m(!0)}catch{h(!0)}finally{r(!1)}}},350),[S?.events.activationEventName]);return v?(0,z.jsx)("div",{className:"flex p-6 justify-center items-center",children:(0,z.jsx)(Ot,{})}):E||!S?.content?(0,z.jsx)("div",{className:"flex p-6 justify-center items-center",children:(0,z.jsx)("p",{className:"text-critical",children:"Encountered an error retrieving content"})}):(0,z.jsxs)(Ut.Provider,{value:{onUserClosePopup:t,hasActivatedCompetitor:i,reward:e},children:[(0,z.jsx)(Pt,{hasActivatedCompetitor:i,onUserClosePopup:t,reward:e}),(0,z.jsx)(St,{data:{isActivating:n,isActivated:l,hasActivationError:N},config:{rootEl:"div",logLevel:void 0},content:S?.content,onEvent:C,children:(0,z.jsx)("style",{children:S?.blockStyle||""})})]})},({reward:e,hasActivatedCompetitor:t},{reward:i,hasActivatedCompetitor:o})=>(0,$t.isEqual)(e,i)&&t===o);var Ei=e=>(s.get(["energyCashbackDomains"])||[]).includes(e);var ic=a(g());var J=a(p());function _o(){let e=Et(),t=c("coup_shift_left"),i;return e?i="100%":t?i="645px":i="320px",{left:"auto",right:i}}function go({offerSignUp:e,storeName:t,hideNotification:i,onDismissTooltip:o,hasSeenCashbackSignupTip:n,hasSeenCashbackActivateTip:r,wrapperStyle:l={}}){let m=_o();return(0,J.jsxs)("div",{style:l,children:[!n&&e&&!i?(0,J.jsx)(rt,{tip:!0,message:(0,J.jsxs)("span",{children:["Capital One Shopping can help you save ",(0,J.jsx)("br",{}),"on ",t," today, just click activate. It's easy and free money."]}),delay:"1500ms",style:{top:"15px",bottom:"auto",width:"461px",left:m.left,right:m.right},onDismissTooltip:o.bind(null,"hasSeenCashbackSignupTip")}):null,!r&&!e&&!i?(0,J.jsx)(rt,{tip:!0,tipLabel:"Capital One Shopping tip:",message:(0,J.jsx)("span",{children:"Just click when you see this to get free money, seriously."}),delay:"1500ms",style:{top:"15px",bottom:"auto",width:"468px",left:m.left,right:m.right},onDismissTooltip:o.bind(null,"hasSeenCashbackActivateTip")}):null]})}var be=go;var $=a(p()),_e=class extends Ri.Component{constructor(...t){super(...t),this.state={hideNotification:c("ext_rewards_remove_delay")?this.props.view&&k.default.get(this.props,"view.user.activated"):!0}}async componentWillReceiveProps(t){this.props&&t&&!this.props.warnAboutStandDown&&t.warnAboutStandDown&&this.state.activated&&this.setState({hideNotification:!1,hasSentPageNotification:!1,activated:!1,activating:!1,hasActivated:!0})}async componentDidUpdate(t,i){if(i.hideNotification!==this.state.hideNotification&&this.sendCashbackPageEvent(),t.warnAboutStandDown!==this.props.warnAboutStandDown&&this.props.warnAboutStandDown&&!s.get("throttleCreditsReactivation")){let o=await Ct();s.merge({cashback:o}),kt("reactivate")}}componentDidMount(){let t=this.props.view&&k.default.get(this.props,"view.user.activated");setTimeout(()=>{document.querySelector("#honeyContainer")&&this.setState({compNotifLoaded:!0,rightOffset:"300px"}),(document.querySelector(".ebates-notification")||document.querySelector(".ebates-hover.ebates-hover-top"))&&this.setState({compNotifLoaded:!0,rightOffset:"410px"}),c("ext_rewards_remove_delay")||this.setState({hideNotification:t}),this.sendCashbackPageEvent(),oi()},c("ext_rewards_remove_delay")?0:1e3)}async sendCashbackPageEvent(){let t=(0,Ti.findDOMNode)(this),i="",o="";if(t){let n=t.querySelector("button");(c("ext_rewards_show_estimate")||c("ext_rewards_show_proof"))&&(o=Array.from(t.querySelectorAll("h4")).splice(0,4).map(r=>r.textContent.toLowerCase()).join(" ")),n&&n.textContent&&(i=n.textContent.toLowerCase())}!this.state.hideNotification&&!this.state.hasSentPageNotification&&(this.setState({hasSentPageNotification:!0}),d("page","cashbackNotification",{view:"cashbackNotification",type:"notification",source:"cashback",deweyResult:k.default.get(this.props.view,"deweyResult.pageType"),offerSignUp:k.default.get(this.props.view,"offerSignUp"),qualified:k.default.get(this.props.view,"qualified",!1),balance:k.default.get(this.props.view,"balance",0),promotionalRate:void 0,vendorMetaId:k.default.get(this.props.view,"id"),ctaText:i,notificationText:o}))}trackFirstDragEnd=k.default.once((t,i)=>{He("cashbackNotification",t,i)});render(){let{hideNotification:t}=this.state,i=k.default.get(this.props.view,"offerSignUp"),o=k.default.get(this.props.view,"vendor");if(this.props.couponsVisible&&!(this.props.couponView&&this.props.couponView.isQuietSavingsMiss)&&!this.props.view.autoActivate||Oe())return null;let n=k.default.get(this.props,"view.reward"),r=ai(this.state.compNotifLoaded);return(0,$.jsxs)(Ce,{onClick:()=>this.setState({fullScreen:!1}),className:`${t?"disabled cashback-page":"cashback-page"}`,style:{top:"0",bottom:"auto",left:r.left??"auto",right:r.right??"0",translate:r.translateX},dragSelector:"header",isDraggable:c("ext_notif_drag"),onDragEnd:this.trackFirstDragEnd,children:[(0,$.jsx)(wt.Motion,{style:{opacity:(0,wt.spring)(t?0:1,{stiffness:180,damping:20}),tabOpacity:t?0:1,y:(0,wt.spring)(t?-100:0,{stiffness:180,damping:20}),tabX:t?80:0},children:({opacity:l,y:m})=>(0,$.jsxs)("div",{className:`cashback-notification ${c("notif_rounded_border")?"rounded-notification":""}`,style:{transform:`translate3d(0,${m}%,0)`,opacity:`${l}`},children:[(0,$.jsxs)("header",{className:"reward-header",children:[(0,$.jsx)(et,{greyscale:c("ext_alternative_logo_1"),swoosh:c("ext_alternative_logo_2")}),(0,$.jsx)(Pe,{})]}),c("ext_energy_cashback_configured")&&Ei(b())?(0,$.jsx)(Di,{reward:n,onUserClosePopup:this.onUserClosePopup.bind(this),hasActivatedCompetitor:this.props.hasActivatedCompetitor,onActivate:this.determineRunCashback.bind(this)}):(0,$.jsx)(ue,{view:this.props.view,hasActivated:this.state.hasActivated,hasActivatedCompetitor:this.props.hasActivatedCompetitor,reward:n,activated:this.state.activated,activating:this.state.activating,hasCoupons:k.default.get(this.props,"view.hasCoupons"),session:this.props.session,showInitialSignup:this.state.showInitialSignup,tld:this.props.tld,activate:this.state.activate,onActivate:this.determineRunCashback.bind(this),dismissNotification:()=>this.setState({hideNotification:!0}),hasSeenFTUX:k.default.get(this.props,"events.hasSeenCashbackFtux",!1),onUserClosePopup:this.onUserClosePopup.bind(this),deweyResult:k.default.get(this.props.view,"deweyResult"),setSeenCashbackFtux:this.setSeenCashbackFtux.bind(this),eligibleForNewUserBonus:this.props.settings.eligibleForNewUserBonus})]})}),(0,$.jsx)(be,{offerSignUp:i,storeName:o,hideNotification:t,onDismissTooltip:this.onDismissTooltip.bind(this),hasSeenCashbackSignupTip:k.default.get(this.props,"events.hasSeenCashbackSignupTip"),hasSeenCashbackActivateTip:k.default.get(this.props,"events.hasSeenCashbackActivateTip")})]})}determineRunCashback(t){return Y()?this.onActivate(t):(t?.shouldLoadEmailCreateAccountNotification&&this.setState({hideNotification:!0},()=>{Dt()}),Me())}onDismissTooltip(t){k.default.get(this.props,`events.${t}`)||zt(t)}async onActivate(t={}){let i=k.default.get(this.props.view,"reward",{}),n=k.default.get(this.props.view,"hasCoupons")?1500:5e3;this.setState({activating:!0}),this.onDismissTooltip("hasSeenCashbackActivateTip");let{isRedirectEnabled:r}=await Nt({reward:i,view:t.view,label:t.label});this.setState({activated:!0}),t.preventHide||setTimeout(()=>{this.setState({hideNotification:!0},()=>{r||Dt(i)})},n),Zt()}onUserClosePopup(t,i=!1){let o=k.default.get(this.props.view,"reward",{});!(t==="activate later"&&c("no_throttle_activate_later"))&&(k.default.get(this.props.view,"user.hasSeenFirst")||k.default.get(this.props.view,"isCashbackURLMatch"))&&Le(),this.setState({hideNotification:!0}),k.default.get(this.props.view,"offerSignUp")?this.onDismissTooltip("hasSeenCashbackSignupTip"):this.onDismissTooltip("hasSeenCashbackActivateTip"),i||(d("trackClick","dismissCashbackNotification",t,{rewardAmount:o.amount,rewardDisplay:o.type}),xt("cashbackNotification",t,"dismiss","primary",{rewardAmount:o.amount,rewardDisplay:o.type}))}setSeenCashbackFtux(){zt("hasSeenCashbackFtux")}},ge=j({view:["cashbackView"],couponView:["couponView"],deweyResult:["deweyResult"],events:["events"],session:["session"],settings:["settings"],tld:["siteAPIData","siteData","tld"],hasActivatedCompetitor:["hasActivatedCompetitor"],warnAboutStandDown:["warnAboutStandDown"],couponsVisible:["couponsVisible"]},_e);var we=a(p());function yt(){return s.get("hasActivatedCompetitor")||s.get("warnAboutStandDown")}function kt(e="cashback"){it({appName:e,cssUrl:"cashback.css",app:e==="reactivate"?(0,we.jsx)(qt,{}):(0,we.jsx)(ge,{}),disableDelay:!0}),s.set("cashbackVisible",!0),e==="reactivate"&&(Te("cashback"),s.set("cashbackReactivateVisible",!0))}var wo={devRewardTest:!1};async function ko(e,t){let{devRewardTest:i=!1}=t??wo,{siteData:o,meta:n}=s.get("siteAPIData")||await Be(),r=s.get("cashback"),l=s.get("settings"),m=x.default.get(r,"user.compInactivated"),N=c("ext_cashback_notif_preferences")?["cartPage","checkoutPage","reviewPage"]:x.default.get(l,"notificationPreferences.cashbackPrefs"),h,y=x.default.get(e,"pageType"),S=Pi.default.getDomain(location.href);if((Ye()||qe())&&!yt())return ii(),!1;if(S?.match(/hilton\.com/)&&c("cb_hilton_honors"))return!1;let E=x.default.get(o.cashback,"pageTypesOverride",{})||{};if(E&&E[y]){let v=E[y],C=x.default.get(v,"value",v),P;if(C==="show"?h=!0:C==="hide"?h=!1:C==="conditional"&&v.conditional&&(P=yo(v.conditional),!P||P.type==="hide"&&P.hide?h=!1:h=!0),d("track","cashbackNotificationOverride",{show:h,reason:x.default.get(P,"feature","")}),!h)return!1}else if(x.default.get(e,"domain")==="tophatter.com"&&x.default.get(e,"pageType")==="homePage")h=!0;else if(x.default.get(e,"pageType")==="atcPage"&&c("cb_on_atc_page"))h=!0;else if(x.default.get(e,"pageType")==="dealPage"&&c("credit_on_deal"))h=!0;else if(yt()&&m)h=!0;else if(N){if(h=N.indexOf(y)!==-1,yt()&&m&&(h=!0),r&&(x.default.get(r,"user.activated")||yt())&&!h&&!x.default.get(r,"user.dismissed")&&!s.get("cashbackVisible")&&!s.get("couponsVisible")&&!s.get("cashbackReactivateVisible")&&!s.get("throttleCreditsReactivation")){kt("reactivate");return}}else y=x.default.snakeCase(y),h=new Set(o.cashback.minNotificationsPageTypes).has(y);if(i&&(h=!0),!h&&c("ext_rewards_cart")){let v=Object.keys(o.pageTypesV2||{}),C=v.includes("cartPage"),P=v.includes("checkoutPage");(!C&&new RegExp(/^\/cart(?![\w-~!$&'()*+,;=:@%])/i).test(location.pathname)||!P&&new RegExp(/^\/checkout(?![\w-~!$&'()*+,;=:@%])/i).test(location.pathname))&&(h=!0)}if(r&&h&&!x.default.get(r,"user.dismissed")&&!s.get("cashbackVisible")&&!s.get("cashbackReactivateVisible")){if(!x.default.get(r,"user.activated")){let C=await We();if(s.get("cashbackVisible")||Ge(C))return}let v=s.get("cashbackView")||r;if(s.set("cashbackView",{...v,isCashbackURLMatch:!0,deweyResult:e,ebatesReward:o.ebatesReward,exclusions:x.default.get(o,"merchantPage.exclusions"),affiliateLinkCurrentTab:x.default.get(n,"affiliate_link_current_tab")}),m&&yt()&&!x.default.get(r,"user.activated")&&!s.get("couponsVisible")&&!s.get("throttleCreditsReactivation")){s.set(["warnAboutStandDown"],!0),kt("reactivate");return}kt()}}function yo(e){try{let t=JSON.parse(e),i=x.default.map(t.hide,l=>({hide:c(l),feature:l,type:"hide"})),o=x.default.map(t.show,l=>({show:c(l),feature:l,type:"show"})),n=x.default.find(i,{hide:!0}),r=x.default.find(o,{show:!0});return n||r||!1}catch{return!1}}export{Y as a,_t as b,Co as c,Do as d,Ye as e,qe as f,ai as g,Zt as h,Dt as i,jt as j,di as k,ie as l,ae as m,hi as n,ne as o,It as p,re as q,gt as r,se as s,rt as t,uo as u,fo as v,ho as w,Mt as x,Di as y,Ei as z,qt as A,ii as B,yt as C,kt as D,ko as E};
