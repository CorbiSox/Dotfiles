import{G as dt,h as ee,j as te,p as at,q as w,r as re,s as ut,y as ct}from"./chunk-52XVUBCW.js";import{c as ne}from"./chunk-42JNP4CL.js";import{m as st,n as O}from"./chunk-SOWOQI5E.js";import{f as oe,t as ft}from"./chunk-JAUVA5AU.js";import{c as R,d as it,e as d}from"./chunk-3GYLW4KZ.js";var H=R((Ot,z)=>{var ie=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof window.msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto);ie?(V=new Uint8Array(16),z.exports=function(){return ie(V),V}):(q=new Array(16),z.exports=function(){for(var t=0,r;t<16;t++)t&3||(r=Math.random()*4294967296),q[t]=r>>>((t&3)<<3)&255;return q});var V,q});var L=R((Vt,se)=>{var ae=[];for(_=0;_<256;++_)ae[_]=(_+256).toString(16).substr(1);var _;function mt(e,t){var r=t||0,n=ae;return[n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]]].join("")}se.exports=mt});var de=R((qt,ce)=>{var lt=H(),pt=L(),ue,E,U=0,B=0;function gt(e,t,r){var n=t&&r||0,i=t||[];e=e||{};var a=e.node||ue,l=e.clockseq!==void 0?e.clockseq:E;if(a==null||l==null){var m=lt();a==null&&(a=ue=[m[0]|1,m[1],m[2],m[3],m[4],m[5]]),l==null&&(l=E=(m[6]<<8|m[7])&16383)}var p=e.msecs!==void 0?e.msecs:new Date().getTime(),b=e.nsecs!==void 0?e.nsecs:B+1,K=p-U+(b-B)/1e4;if(K<0&&e.clockseq===void 0&&(l=l+1&16383),(K<0||p>U)&&e.nsecs===void 0&&(b=0),b>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");U=p,B=b,E=l,p+=122192928e5;var A=((p&268435455)*1e4+b)%4294967296;i[n++]=A>>>24&255,i[n++]=A>>>16&255,i[n++]=A>>>8&255,i[n++]=A&255;var C=p/4294967296*1e4&268435455;i[n++]=C>>>8&255,i[n++]=C&255,i[n++]=C>>>24&15|16,i[n++]=C>>>16&255,i[n++]=l>>>8|128,i[n++]=l&255;for(var S=0;S<6;++S)i[n+S]=a[S];return t||pt(i)}ce.exports=gt});var me=R((zt,fe)=>{var wt=H(),ht=L();function vt(e,t,r){var n=t&&r||0;typeof e=="string"&&(t=e==="binary"?new Array(16):null,e=null),e=e||{};var i=e.random||(e.rng||wt)();if(i[6]=i[6]&15|64,i[8]=i[8]&63|128,t)for(var a=0;a<16;++a)t[n+a]=i[a];return t||ht(i)}fe.exports=vt});var ge=R((Ht,pe)=>{var xt=de(),le=me(),G=le;G.v1=xt;G.v4=le;pe.exports=G});var j=d(w());var $=d(ut()),we=$.default;window.Baobab?we=window.Baobab:window.Baobab=$.default;var he=we;var Q=[],W=window.tree||new he({notification:{run:null,relatedRuns:null,lastSavings:0,currentSavings:0,updating:!1,showModal:!1,details:null,activeRunId:!1},messages:[],shadowRootsByAppName:{}},{immutable:!1});window.tree||(window.tree=W);W.on("get",e=>{let t=e.data.solvedPath,r=t?t.join("."):!1,n=e.data.data,i=j.default.find(Q,{path:r});i&&i.loader&&i.loader(n,e.data.solvedPath)});function Ut(e,t){if(j.default.find(Q,{path:e}))throw new Error("Only one loader per path");Q.push({path:e,loader:t})}var o=W;var nt=d(ge()),ot=d(ct());var Z={};it(Z,{abortRun:()=>D,addPriceRun:()=>Re,amazonResultsReceived:()=>_e,communityDealReceived:()=>Le,getCookie:()=>Ue,hideFollow:()=>Be,modalDetailsReceived:()=>Ge,notifyXHRIsQuiet:()=>Qe,platformSelectors:()=>We,setupPriceRunPusherBindings:()=>be,showFollow:()=>Je,showSiteHub:()=>Ke,terminatePriceRun:()=>et,updatePriceRun:()=>tt,warnAboutStandDown:()=>rt});var D=e=>{h("abortRun",e)};var X=d(O()),ve=d(dt());ne();var k=e=>f("pusherEvents",e);var v={},u={};function xe(e,t){u[e]&&(u[e]={...u[e],...t})}function bt(e,t){return setTimeout(()=>{T(e,t)},3e4)}function Rt(e,t){if(e)return setTimeout(()=>{D({run:{runId:t}}),k({eventType:"run-aborted",response:{runId:t}})},3e4)}function Ie(e,t){let r=bt(t.userId,e),n=Rt(t.meta.isAmzProductPage,e);u[e]={input:t,inTabTimeoutIds:{abortAmzProductPageRunId:n,terminateRunId:r}},u[e]}function T(e,t){u[t]&&(delete u[t],void 0),_t(e)}async function _t(e){if(Object.keys(u).length>0)return;let t=await v[e];t&&(t.disconnect(),delete v[e],void 0)}var be=e=>{let{userId:t}=e;return v[t]?v[t].then(()=>X.default.resolve()):(v[t]=(0,ve.setupPriceRunPusherBindings)(e,kt(t),Pt,yt),v[t].then(()=>X.default.resolve()))};function kt(e){return async t=>{let r="run-finished-v2",{runId:n}=t;try{if(`${r}`,u[n],!u[n]){`${r}`;return}clearTimeout(u[n].inTabTimeoutIds.terminateRunId),clearTimeout(u[n].inTabTimeoutIds.abortAmzProductPageRunId),k({eventType:r,response:t,additionalData:u[n]})}catch(i){i.message,i.stack}finally{T(e,n)}}}function Pt(e){let t="run-instantOffers",{runId:r}=e;try{if(`${t}`,u[r],!u[r]){`${t}`;return}k({eventType:t,response:e,additionalData:u[r]})}catch(n){n.message,n.stack}}function yt(e){try{let t="run-priceRequest-v2",r=e.inputData?.meta?.tab?.id,n=o.get("tabId"),i=u[e.runId]||r===n&&{input:e.inputData};if(`${t}`,e.runId,e.result?.id,!u[e.runId]&&(!r||r!==n)){`${t}`;return}k({eventType:t,response:e,additionalData:i})}catch(t){t.message,t.stack,e.runId,e.result?.id}}var Re=(e,t)=>Ie(e,t);var _e=e=>{h("amazonResultsReceived",e)};var N=d(w());var Me=d(O());at();var s=d(w()),Ne=d(re());var ke=e=>f("addToAmazonCart",e);var Pe=e=>f("loadProduct",e);function J(e){return e==="amazon.com"||e==="amazon.ca"}var ye=d(st()),M;window.__wbCurrentDomain&&(M=window.__wbCurrentDomain);var g=()=>M||ye.default.getDomain(location.href);function ur(e){M=e,window.__wbCurrentDomain=M}var Ae=d(w());function x(e){return Ce().indexOf(e)>-1}function Ce(){return o.get(["session","features"])||[]}function Se(e,t){return!!Ce().find(n=>n.startsWith(e)&&n.endsWith("_"+Ae.default.snakeCase(t)))}var fr=()=>x("is_pc_notif_off");var Y=d(w()),De=d(re());ne();var Te=e=>({domain:g(),pagePath:location.pathname,pageViewId:o.get("pageViewId"),docStartAt:window.__wb_timing.docStartAt,DOMContentLoadedAt:window.__wb_timing.DOMContentLoadedAt,sendMetricAt:performance.now(),...e});function hr(e,t={}){if(!e){return}let r=Te(t);f("wbAnalytics",{method:"page",priceCheckId:window.priceCheckId,args:[e,r]})}function vr(e,t={}){if(!e){return}let r=Te(t);f("wbAnalytics",{method:"track",priceCheckId:window.priceCheckId,args:[e,r]})}function I(e,...t){let r=Y.default.find(t,i=>!Y.default.isString(i));r?(r.domain=r.domain||g(),r.pagePath=r.pagePath||location.pathname,r.pageViewId=o.get("pageViewId"),r.docStartAt=window.__wb_timing.docStartAt,r.DOMContentLoadedAt=window.__wb_timing.DOMContentLoadedAt,r.sendMetricAt=performance.now(),e==="page"&&r.source&&((!window.__wb_contentId||window.__wb_contentId.constructor!==Object)&&(window.__wb_contentId={}),r.contentId=(0,De.v4)(),window.__wb_contentId[r.source]=r.contentId)):t.push({domain:g(),pagePath:location.pathname});let n={page:{path:window.location.pathname,referrer:document.referrer,search:window.location.search,title:document.title,url:window.location.href}};t.push(n),f("wbAnalytics",{method:e,priceCheckId:window.priceCheckId,args:t})}var c=o.select("notification");function At(e){if((e.asin||s.default.get(e,"gtins[0]"))!==o.get("currentASIN")&&!o.get("ignoreCurrentASIN")&&!e.instantOffers)return;e.instantOffers&&I("track","instantOffersReceived",{parentQuoteId:e.instantOffers.runId,quoteId:e.instantOffers.instantOffersRunId,trigger:o.get("trigger"),currentLocation:s.default.pick(window.location,["hash","host","hostname","href","origin","pathname","port","search"])});let r=s.default.clone(c.get("run")||{});s.default.get(e,"run.runId")===s.default.get(r,"runId")&&e.modal&&(r.betterResults=s.default.map(s.default.get(r,"betterResults"),n=>(n.id===e.modal.id&&(n=e.modal),n))),c.merge({details:e.modal,run:s.default.isEmpty(r)?e.run:r,lastChance:!1,cartPricing:e.cartPricing}),Fe(e)}function Fe(e,t){let r=s.default.get(e,"cartPricing.savings")||e.run.savings;if((s.default.get(e,"run.inputData.asin")||s.default.get(e,"run.inputData.gtins[0]"))!==o.get("currentASIN")&&!t||c.get("activeRunId")===s.default.get(e.run,"runId"))return;e.run.status==="complete"&&(I("page","quoteCompleteNotification",{view:"quoteCompleteNotification",type:"notification",matchDomain:s.default.get(e.run,"betterResults[0].vendor",null),matchUrl:s.default.get(e.run,"betterResults[0].product.url",null),savings:r>0?r:null,paymentsSupport:!!s.default.get(e,"cartPricing.paymentsSupport")}),Ve(e.run),c.merge({activeRunId:s.default.get(e.run,"runId")}));let a=r>0;c.merge({run:e.run,currentSavings:r,updating:!0,lastSavings:c.get("currentSavings"),showPopup:a,resetting:!1,ignoreRun:!1})}function Oe(e){window.priceCheckId=Ne.default.v4(),c.set(["priceCheckStarted"],!0),I("track","priceCheckStart",{quoteId:e,priceCheckId:window.priceCheckId,trigger:o.get("trigger"),currentLocation:s.default.pick(window.location,["hash","host","hostname","href","origin","pathname","port","search"])})}function Ve(e){c.get("priceCheckStarted")||(Oe(e.runId),c.set(["endFiredFirst"],e.runId)),c.set(["priceCheckStarted"],!1),I("track","priceCheckEnd",{quoteId:e.runId,category:s.default.get(e,"originResult.product.vendorCategory"),priceCheckId:window.priceCheckId,matchId:s.default.get(e,"betterResults[0].id")})}function Ct(){c.merge({run:{},details:null,cartPricing:null,currentSavings:0,updating:!0,lastSavings:c.get("currentSavings"),showPopup:!1,resetting:!0,ignoreRun:!1,communityDeal:null}),o.set("bestAmazonResult",null)}function Cr(){c.merge({ignoreRun:!0})}async function Sr(){o.set("appReady",!0);let e=o.get("messages");await Me.default.delay(1e3),s.default.forEach(e,t=>{t.type!=="resetNotification"&&qe(t)}),o.set("messages",[])}function St(e,t){let r=s.default.find(e,a=>!!s.default.get(a,"meta.isOrigin")),n=s.default.get(r,"pricing.total");if(!r||!n)return!1;let i=(0,s.default)(e).map(a=>{let l=s.default.get(a,"pricing.total")?n-s.default.get(a,"pricing.total"):0;if(a.savings=l>0?l:0,!a.product.wbpid)try{let m=a.product.url.match(/gp\/product\/(.*)\/|dp\/(.*)\?/),p=m[2]||m[1];p&&(a.product.wbpid=`amazon.com_${p}`)}catch{}return a}).filter(a=>!!a.savings).sortBy(["savings",a=>te(ee(a?.details?.arrival_date,"ccc. MMM. d"))],["desc","asc"]).reverse().value();i&&i.length&&o.set("bestAmazonResult",i[0])}function qe(e){if(!o.get("appReady")){o.push(["messages"],e);return}let{type:t,...r}=e;if(r)switch(t){case"setInputData":c.merge({inputData:r.inputData});break;case"modalDetailsReceived":At(r);break;case"runUpdated":Fe(r);break;case"abortRun":c.merge({run:{status:"complete",runId:s.default.get(r,"run.runId"),aborted:!0},currentSavings:0,updating:!1,lastSavings:c.get("currentSavings"),showPopup:!1,resetting:!1}),r.run&&Ve(r.run);break;case"resetNotification":Ct();break;case"setRunId":{c.get("endFiredFirst")!==r.runId&&(Oe(r.runId),c.set(["endFiredFirst"],null));break}case"amazonResultsReceived":St(e.amazonResults,e.runId);break;default:console.log("unknown message",e)}}window.handleMessage=qe;function Dr(){let e=J(g()),t=x("ac_elasticity_2"),r=o.get(["couponView","partnerGroupsList"])?.groupA?.includes(g());return t&&r&&!e||!e&&!t}async function ze(e){if(o.get(["ProductPage","lastRunId"])===e.runId)return;o.get(["ProductPage"])?o.merge("ProductPage",{isFetching:!0,lastRunId:e.runId}):o.set("ProductPage",{isFetching:!0,lastRunId:e.runId});let r=await Pe(e);r?(r.isFetching=!1,o.merge("ProductPage",r)):o.merge("ProductPage",{isFetching:!1})}function Tr(e){return ke(e)}var y;async function He(e){y=e,o.set(["siteHubView","primaryDeal"],e),Dt([]);let t=e.id,r=e.runId,n=e.asin;ze({id:t,asin:n,runId:r})}function Dt(e){e=N.default.filter(e,r=>r.savings);let t=o.get(["siteHubView","deals"]);if(t?t=(0,N.default)(t.concat(e)).uniq("asin").filter(r=>r.asin!==N.default.get(y,"asin")).value():t=e,o.set(["siteHubView","deals"],t),y)y.savings>0?P({active:!0,text:"1"}):P({active:!0,text:""});else if(t.length){let r=t.length+(y?1:0);P({active:!0,text:r.toString()})}else P({active:!1,text:""})}var Le=e=>{if(e&&!e.error&&e.deal.asin===o.get("currentASIN")){o.set(["notification","communityDeal"],e);let t=e.deal;He(t)}else e&&e.error&&o.set(["notification","communityDeal"],e)};var Ee=e=>{let t=`${e}=`,n=decodeURIComponent(document.cookie).split(";");for(let i=0;i<n.length;i++){let a=n[i].trim();if(a.indexOf(t)===0)return a.substring(t.length,a.length)}return""};var Ue=({cookieKey:e}={})=>{if(e)return Ee(e)};var Be=async e=>{o.merge("followView",{hiddenFromWebApp:!0})};var Ge=e=>{h("modalDetailsReceived",e)};ft();var $e=new oe,Xr=$e.asObservable(),Qe=()=>{x("ext_fast_roo_totals")&&$e.next()};var je=d(w()),We=e=>je.default.map(e,t=>({selector:t,present:!!document.querySelector(t)}));var Xe=e=>f("initNotificationApp",e);var Je=async e=>{o.set("followView",{resultData:e}),Xe({name:"follow"})};var Ze=d(O());function Ye(e){let t=o.get(["siteHubView","deals"]),r=o.get(["siteHubView","primaryDeal"]);return o.get(["siteHubView","shown"])?(o.set(["siteHubView","visible"],!0),o.set(["siteHubView","site"],e.site)):o.set("siteHubView",{shown:!0,visible:!0,site:e.site,deals:t,primaryDeal:r}),Se("mit_isqualified",g())?!1:!o.get(["siteHubScriptLoaded"])}var Ke=async e=>document.readyState==="interactive"||document.readyState==="complete"||document.readyState==="loaded"?Ye(e):new Ze.default(t=>{document.addEventListener("DOMContentLoaded",()=>{t(Ye(e))})});var et=(e,t)=>T(e,t);var tt=(e,t)=>xe(e,t);var rt=async()=>o.set(["warnAboutStandDown"],!0);var Tt="__wikibuy_instant_content",Mt="__wikibuy_instant_bg",Nt="__wikibuy_instant_external_messages";function Ft(e){return Z[e]}var F=window.wb_messenger;if(!F){let e=chrome.runtime.connect(chrome.runtime.id,{name:Nt});F=window.wb_messenger=(0,ot.default)(Ft,t=>{chrome.runtime.sendMessage({src:Tt,data:t})},{getId:()=>(0,nt.v4)({rng:()=>{for(var t=new Array(16),r=0,n;r<16;r++)r&3||(n=Math.random()*4294967296),t[r]=n>>>((r&3)<<3)&255;return t}})}),chrome.runtime.onMessage.addListener(t=>{t.src===Mt&&F.handleMessage(t.data)})}function f(e,t={}){return F.invoke(e,[t])}function h(e,t={}){window.handleMessage&&window.handleMessage({type:e,...t})}var P=e=>f("setBrowserAction",e);export{ge as a,Ut as b,o as c,P as d,J as e,g as f,ur as g,x as h,Ce as i,fr as j,Ct as k,Cr as l,Sr as m,Dr as n,Tr as o,Xr as p,f as q,h as r,hr as s,vr as t,I as u};
