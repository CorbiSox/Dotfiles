import{a as Go}from"./chunk-3NOLLE5N.js";import{a as J,b as Vo,c as qo,d as Ho,e as we,f as jo,g as Yo,h as Ke}from"./chunk-BNNGPYUP.js";import{a as Wo}from"./chunk-OFJO7COX.js";import{A as Bo,B as fe,C as _e,F as Uo,H as Qe,J as Rt,K as zo,L as ge,M as Zo,a as po,b as co,c as qt,d as He,e as ce,g as Ao,h as No,i as Ze,j as Ht,k as Io,l as Po,m as wt,n as Do,o as Eo,q as Ct,r as Fo,s as Mo,t as Oo,v as $o,w as Lo,x as de,y as me,z as he}from"./chunk-WVZLHOFL.js";import{a as Js}from"./chunk-3XIOB4EC.js";import{D as So,E as Ye,c as _t,d as nt,e as uo,g as mo,i as Ge,j as $t,k as wo,l as Lt,m as bo,n as yo,o as Bt,p as Ut,q as vo,s as zt,t as Co,u as le,v as ko,w as xo,x as gt}from"./chunk-D2E2HG2W.js";import{a as vt,d as qe,e as ft,h as io,i as oo,k as Ot,l as so}from"./chunk-A36NQ4WF.js";import{d as fo,e as _o}from"./chunk-TSZP6UXS.js";import{b as ho}from"./chunk-VZ75JTZE.js";import{a as go}from"./chunk-IOEYPKEV.js";import{b as no,d as ao,n as ro}from"./chunk-NYGFFQMG.js";import{b as Ro,c as To,d as je}from"./chunk-3MQH4JJT.js";import{a as lo}from"./chunk-NZY4JV6E.js";import{a as pe,b as ue}from"./chunk-4GT6T77M.js";import{a as We,b as Ks}from"./chunk-N3RCD34N.js";import{q as eo}from"./chunk-E4QNY2PC.js";import{a as Xs}from"./chunk-ZIQ6U6YW.js";import{a as Xi}from"./chunk-B7GBMFFD.js";import{a as re}from"./chunk-AKTW5CPL.js";import{a as H}from"./chunk-FEK2HJKI.js";import{a as Ve}from"./chunk-NJ63VSGO.js";import{a as st,d as Ki}from"./chunk-OTRTIFBS.js";import{I as to,a as T,b as ae,c as b,j as Ji,l as tn}from"./chunk-3I3QPOUL.js";import{c as _,d as Zi,e as $,f as A,h as u,n as Mt,q as ne,s as Qi,u as y}from"./chunk-4SRFE46V.js";import{a as ze,d as Qs}from"./chunk-RXMLGJMT.js";import{b as se,c as Yi}from"./chunk-LC5XJ32R.js";import{q as Z,r as oe}from"./chunk-52XVUBCW.js";import{b as Ft,c as ji}from"./chunk-42JNP4CL.js";import{n as Zs}from"./chunk-SOWOQI5E.js";import{c as Ue,e as r}from"./chunk-3GYLW4KZ.js";var pi=Ue(xe=>{"use strict";Object.defineProperty(xe,"__esModule",{value:!0});xe.Collapse=void 0;var ve=Object.assign||function(s){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(s[i]=e[i])}return s},ln=function(){function s(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(t,e,i){return e&&s(t.prototype,e),i&&s(t,i),t}}(),dn=T(),ke=ls(dn),mn=Ji(),tt=ls(mn),cs=Ve();function ls(s){return s&&s.__esModule?s:{default:s}}function hn(s,t){var e={};for(var i in s)t.indexOf(i)>=0||Object.prototype.hasOwnProperty.call(s,i)&&(e[i]=s[i]);return e}function fn(s,t){if(!(s instanceof t))throw new TypeError("Cannot call a class as a function")}function _n(s,t){if(!s)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:s}function gn(s,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);s.prototype=Object.create(t&&t.prototype,{constructor:{value:s,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(s,t):s.__proto__=t)}var wn=1,Ce="WAITING",us="RESIZING",ds="RESTING",St="IDLING",ri=function(){return null},bn={collapse:"ReactCollapse--collapse",content:"ReactCollapse--content"},ms=xe.Collapse=function(s){gn(t,s);function t(e){fn(this,t);var i=_n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return yn.call(i),i.state={currentState:St,from:0,to:0},i}return ln(t,[{key:"componentDidMount",value:function(){var i=this.props,o=i.isOpened,n=i.forceInitialAnimation,a=i.onRest;if(o){var p=this.getTo();if(n){var l=this.wrapper.clientHeight;this.setState({currentState:us,from:l,to:p})}else this.setState({currentState:St,from:p,to:p})}a()}},{key:"componentWillReceiveProps",value:function(i){i.hasNestedCollapse?i.isOpened!==this.props.isOpened&&this.setState({currentState:Ce}):this.state.currentState===St&&(i.isOpened||this.props.isOpened)&&this.setState({currentState:Ce})}},{key:"componentDidUpdate",value:function(i,o){var n=this.props,a=n.isOpened,p=n.onRest,l=n.onMeasure;if(this.state.currentState===St){p();return}o.to!==this.state.to&&l({height:this.state.to,width:this.content.clientWidth});var d=this.wrapper.clientHeight,m=a?this.getTo():0;if(d!==m){this.setState({currentState:us,from:d,to:m});return}(this.state.currentState===ds||this.state.currentState===Ce)&&this.setState({currentState:St,from:d,to:m})}},{key:"componentWillUnmount",value:function(){cancelAnimationFrame(this.raf)}},{key:"render",value:function(){return ke.default.createElement(cs.Motion,ve({},this.getMotionProps(),{onRest:this.onRest,children:this.renderContent}))}}]),t}(ke.default.PureComponent);ms.propTypes={isOpened:tt.default.bool.isRequired,springConfig:tt.default.objectOf(tt.default.number),forceInitialAnimation:tt.default.bool,hasNestedCollapse:tt.default.bool,fixedHeight:tt.default.number,theme:tt.default.objectOf(tt.default.string),style:tt.default.object,onRender:tt.default.func,onRest:tt.default.func,onMeasure:tt.default.func,children:tt.default.node.isRequired};ms.defaultProps={forceInitialAnimation:!1,hasNestedCollapse:!1,fixedHeight:-1,style:{},theme:bn,onRender:ri,onRest:ri,onMeasure:ri};var yn=function(){var t=this;this.onContentRef=function(e){t.content=e},this.onWrapperRef=function(e){t.wrapper=e},this.onRest=function(){t.raf=requestAnimationFrame(t.setResting)},this.setResting=function(){t.setState({currentState:ds})},this.getTo=function(){var e=t.props.fixedHeight;return e>-1?e:t.content.clientHeight},this.getWrapperStyle=function(e){if(t.state.currentState===St&&t.state.to){var i=t.props.fixedHeight;return i>-1?{overflow:"hidden",height:i}:{height:"auto"}}return t.state.currentState===Ce&&!t.state.to?{overflow:"hidden",height:0}:{overflow:"hidden",height:Math.max(0,e)}},this.getMotionProps=function(){var e=t.props.springConfig;return t.state.currentState===St?{defaultStyle:{height:t.state.to},style:{height:t.state.to}}:{defaultStyle:{height:t.state.from},style:{height:(0,cs.spring)(t.state.to,ve({precision:wn},e))}}},this.renderContent=function(e){var i=e.height,o=t.props,n=o.isOpened,a=o.springConfig,p=o.forceInitialAnimation,l=o.hasNestedCollapse,d=o.fixedHeight,m=o.theme,f=o.style,g=o.onRender,h=o.onRest,w=o.onMeasure,x=o.children,R=hn(o,["isOpened","springConfig","forceInitialAnimation","hasNestedCollapse","fixedHeight","theme","style","onRender","onRest","onMeasure","children"]),C=t.state,S=C.from,F=C.to;return g({current:i,from:S,to:F}),ke.default.createElement("div",ve({ref:t.onWrapperRef,className:m.collapse,style:ve({},t.getWrapperStyle(Math.max(0,i)),f)},R),ke.default.createElement("div",{ref:t.onContentRef,className:m.content},x))}}});var gs=Ue(Re=>{"use strict";Object.defineProperty(Re,"__esModule",{value:!0});Re.UnmountClosed=void 0;var vn=Object.assign||function(s){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(s[i]=e[i])}return s},Cn=function(){function s(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(t,e,i){return e&&s(t.prototype,e),i&&s(t,i),t}}(),kn=T(),hs=_s(kn),xn=Ji(),fs=_s(xn),Rn=pi();function _s(s){return s&&s.__esModule?s:{default:s}}function Tn(s,t){var e={};for(var i in s)t.indexOf(i)>=0||Object.prototype.hasOwnProperty.call(s,i)&&(e[i]=s[i]);return e}function Sn(s,t){if(!(s instanceof t))throw new TypeError("Cannot call a class as a function")}function An(s,t){if(!s)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:s}function Nn(s,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);s.prototype=Object.create(t&&t.prototype,{constructor:{value:s,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(s,t):s.__proto__=t)}var In=Re.UnmountClosed=function(s){Nn(t,s);function t(e){Sn(this,t);var i=An(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.componentWillReceiveProps=function(o){var n=o.isOpened;!i.props.isOpened&&n&&i.setState({forceInitialAnimation:!0,shouldUnmount:!1})},i.onRest=function(){var o=i.props,n=o.isOpened,a=o.onRest;n||i.setState({shouldUnmount:!0}),a&&a.apply(void 0,arguments)},i.state={shouldUnmount:!i.props.isOpened,forceInitialAnimation:!i.props.isOpened},i}return Cn(t,[{key:"render",value:function(){var i=this.props,o=i.isOpened,n=i.onRest,a=Tn(i,["isOpened","onRest"]),p=this.state,l=p.forceInitialAnimation,d=p.shouldUnmount;return d?null:hs.default.createElement(Rn.Collapse,vn({forceInitialAnimation:l,isOpened:o,onRest:this.onRest},a))}}]),t}(hs.default.PureComponent);In.propTypes={isOpened:fs.default.bool.isRequired,onRest:fs.default.func}});var bs=Ue((mp,ws)=>{"use strict";var Pn=pi(),Dn=Pn.Collapse,En=gs(),Te=En.UnmountClosed;Te.Collapse=Dn;Te.UnmountClosed=Te;ws.exports=Te});var Qo=r(Xs()),Tt=r(Z()),Ko=r(Js());ji();Ks();var en=_.select("couponView");function on(){return A()==="ebay.com"&&_.get(["selfStandDown",`${A()}_${_.get("tabId")}`])}async function sn(s){let t=document.createElement("iframe");t.src=s,t.style="position: fixed; top: 0; left: 0; border: 0; background: transparent;",t.width=1,t.height=1,t.setAttribute(`data-${_.get("pageViewId")}`,!0),document.body.appendChild(t),await ce.setupIframeMessenger(t)}async function nn(){let s=(0,Qo.exponential)({randomisationFactor:0,initialDelay:50,maxDelay:5e3});await new Promise((e,i)=>{s.on("ready",async()=>{let o=await ce.checkShouldPrompt();o&&(s.removeAllListeners(),e(o)),s.backoff()}),s.backoff()})}async function an(s){let t;if(u("shopify_async_tigger")&&s==="Shopify"){let e=(0,Ko.getSiteData)(s,"checkoutPage");t=Tt.default.get(e,"identifiers")}return t?{siteData:{coupons:{identifiers:t}}}:null}async function Jo(s={}){return he({...s,isAsyncTigger:!0})}async function ma(s={}){let t=A(),e=await lo(t);Ft("AFTER SITE CACHE");let i=e,o=_.get("platform");if(o){let N=await an(o);N&&(i=N)}if(!await Qe(i)){let N=_.get("deweyResult");if(He(N)){y("trackError","couponsInitError","asyncTigger"),Ye(N);return}await new Promise((I,O)=>{ho.emitter.on("result",async W=>{let U=await Qe(i);U?I(U):He(W)&&(y("trackError","couponsInitError","asyncTigger"),Ye(W),O("coupon identifiers not found on page, loading cashback instead"))})})}Ft("AFTER PROMPT");let a=u("shopify_async_tigger")&&o?o:Tt.default.get(e,"siteData.tld"),p=`${Ki}?site=${a}`;await sn(p),Ft("AFTER SETUP REMOTE"),await nn();let{coupons:l,ignoreAffiliate:d}=Tt.default.get(e,"siteData.coupons",{}),m=l&&l.length,f=!1,g=!1,h=!1,w=l&&l.length&&on();w&&Zi({active:!0}),(d||_.get(["couponsAffiliateDisabledSites",`${t}_${_.get("tabId")}`])>We()||_.get(["couponsAffiliateDisabledSites",`${t}_all`])>We())&&!w&&(en.set("disableAffiliate",!0),f=!0),uo()&&!w&&(g=!0),Uo({siteAPIData:e,domain:t}),y("track","couponCheck");let x,R;if(ce.setConfig(No),!m)return h;let C;try{let N=await _t("couponRun");if(C=JSON.parse(N),C){let D={domain:t},{savings:I}=await Ao(D);C.result.savings=I,C.result.pageReload=void 0,await nt("couponRun")}}catch{nt("couponRun")}R&&(l=[],m=R),h={coupons:l,estimatedRunTime:x,disableAffiliate:f,couponCount:m,affiliateLinkCurrentTab:Tt.default.get(e,"meta.affiliate_link_current_tab"),pageWasReloaded:!!C,standDown:g,standDownOverride:w,autoCoupConfig:Tt.default.get(e,"siteData.coupons.config.auto_coup")};let S=_.get("couponsConfig");return Tt.default.get(S,"pageWasReloaded")&&(h.pageWasReloaded=!0),_.set("couponsConfig",h),C&&Bo(C),h}function Gt(){return u("roo_coup_24_q_3_test")||u("tigger_coup_24_q_3_test")?_.get(["couponView","rooVsTiggerDomains"])?.includes(A()):!1}var Ee=r(T()),qs=r(tn()),Fe=r(Ve()),ee=r(Zs()),c=r(Z()),Hs=r(oe());ji();Qs();var Vr=r(T()),as=r(T()),Q=r(Z());function Wt(s){return parseInt(s.replace(/[^0-9]/gi,""))}var ts=r(T()),es=r(T()),Xe=r(Z());Yi();var Xo=r(T());var jt=r(b()),rn=({activateRewardsOnly:s,toggleHideSecondaryCta:t,hideSecondaryCta:e,activatingCredits:i,creditsActivated:o,ctaText:n}={})=>{let a=$(A()),p=u("ext_red_cta_202305")&&!a,l=u("ext_notif_animation")?"btn-wiggle":"",d=u("notif_rounded_border")?"rounded-btn":"";return(0,jt.jsx)(Xo.default.Fragment,{children:i&&e?(0,jt.jsx)("button",{className:`bold primary-btn-large ${p?"red-btn-test":""}
          ${d}`,children:"Activating..."}):o&&e?(0,jt.jsx)("button",{className:`bold primary-btn-large ${p?"red-btn-test":""}
          ${d}`,children:"Activated!"}):(0,jt.jsx)("button",{className:`bold primary-btn-large ${p?"red-btn-test":""}
            ${l} ${d}`,onClick:async()=>{s({ctaText:"dismissCouponNotification",label:n}),t()},children:n})})},Je=rn;var E=r(b()),ti=class extends es.Component{constructor(...t){super(...t),this.state={hideSecondaryCta:!1},this.onShowExclusion=this.onShowExclusion.bind(this)}componentDidMount(){$(A())&&(this.closeTimeout=setTimeout(()=>this.props.onClosePopup(),5e3)),nt("couponNotifiedImmediately")}async sendCtaEvent({ctaText:t,notificationText:e,clickId:i}={}){let o=se(i);y("track","couponsModalClickCta",{coupons:this.props.couponsFromResult,savings:this.props.rawSavings,bestCoupon:this.props.bestCode,cashback:this.props.isCashback,triggerType:"auto",ctaText:t.toLowerCase(),notificationText:e,runDuration:Xe.default.get(this,"props.runDuration"),clickId:i,redirectId:o,couponRunId:_.get(["couponView","result","couponRunId"])}),vt("couponNotificationResult",t,"cta","primary",{redirect:!0,cashback:this.props.isCashback&&!this.props.hasDeferredCouponRewards,coupons:this.props.couponsFromResult,savings:this.props.rawSavings,bestCoupon:this.props.bestCode,triggerType:"auto",notificationText:e,runDuration:Xe.default.get(this,"props.runDuration"),clickId:i,redirectId:o,couponRunId:_.get(["couponView","result","couponRunId"])})}onShowExclusion(){y("trackClick","viewExclusionDetails","view details"),window.open(`${st}/s/${this.props.tld}/coupon`,"_blank")}componentWillUnmount(){clearTimeout(this.timeout),clearTimeout(this.closeTimeout)}render(){let{activateRewardsOnly:t,savings:e,reward:i,exclusions:o,postCoupons:n,requiresInput:a,didTryCodes:p,running:l,onClosePopup:d,activateCredits:m,activatingCredits:f,creditsActivated:g,isBonkersSavings:h,hasDeferredCouponRewards:w}=this.props,x=i&&i.amount&&!n&&(!w||a),R=i&&(!!i.categories||i.estimated),C=i&&i.type==="threshold"&&i.threshold,S=$(A()),F=u("ext_red_cta_202305")&&!S,N=u("ext_notif_animation")?"btn-wiggle":"",D=!1,I="Apply Savings",O="Apply Savings",W=i&&i.amount&&(u("apply_savings_rewards_option")||u("apply_savings_rewards_option_2")),U=W&&!h&&!a?"rewards-only-btn":"";W&&(I="Check for Rewards"),(S||h)&&(I="Continue",D=!0);let Y=()=>D?`Continue to ${C?"earn":"get"} ${R?"up to an additional":"an additional"}`:`Click to ${C?"earn":"get"} ${R?"up to an additional":"an additional"}`,q=()=>ko(i,{hideUpTo:!0})+xo(i),lt=()=>{this.setState({hideSecondaryCta:!0})},it=`${a||h?"code entered":`you saved ${e} automatically!`} ${x?`${Y().toLowerCase()} ${q()}`:""}`,ht=u("notif_rounded_border")?"rounded-btn":"";return(0,E.jsxs)("div",{className:`savings-wrapper automatic ${x?"has-reward":""} ${o?"has-exclusions":""} ${S?" amazon":""}`,children:[(0,E.jsx)(Bt,{domain:A()}),(0,E.jsxs)("div",{children:[(0,E.jsx)("div",{className:`coupon-count ${x?"":"no-reward"}`,children:a||h?(0,E.jsx)("div",{children:(0,E.jsxs)("h2",{children:["Code Entered",x?(0,E.jsxs)("span",{className:"credits-text",children:[(0,E.jsx)("br",{}),Y()," ",(0,E.jsx)("span",{className:"palmetto",children:q()}),"."]}):null]})}):(0,E.jsxs)("h2",{className:"result-text",children:[(0,E.jsxs)("span",{children:["You saved",(0,E.jsxs)("span",{className:"palmetto",children:[" ",e," "]})," automatically!"]}),x?(0,E.jsxs)("span",{className:"credits-text",children:[Y()," ",(0,E.jsx)("span",{className:"palmetto",children:q()}),"."]}):null]})}),(0,E.jsxs)("div",{children:[p&&!l&&(0,E.jsxs)("div",{style:{marginTop:"25px"},children:[W&&!h&&!a&&(0,E.jsx)(Je,{creditsActivated:g,activatingCredits:f,activateRewardsOnly:t,toggleHideSecondaryCta:lt,hideSecondaryCta:this.state.hideSecondaryCta,ctaText:I}),!this.state.hideSecondaryCta&&(0,E.jsx)("button",{className:`primary-btn-large ${U} ${F?"red-btn-test":""} ${U?"":N} ${ht}`,disabled:l||g||f,onClick:async()=>{let ot=J();this.sendCtaEvent({ctaText:I,notificationText:it,clickId:ot}),x||w&&i&&i.amount?(m({clickId:ot,fromAutoRun:!0,savings:!0,codeEntered:a,shouldLoadEmailCreateAccountNotification:!0}),this.timeout=setTimeout(()=>{d()},750)):(de({clickId:ot,fromAutoRun:!0,autoSavings:!0}),d())},children:W?O:I})]}),x&&(0,E.jsx)(Lt,{reward:i,containerStyle:{marginTop:12,textAlign:"left"}}),(f||g)&&(!W||W&&this.state.hideSecondaryCta)&&!w?(0,E.jsx)("div",{className:"exclusions-wrapper visible",children:(0,E.jsxs)("h4",{style:{fontSize:"12px"},className:"try-more-link",children:["*Rewards may vary based on exchange rates.",o?(0,E.jsxs)(ts.default.Fragment,{children:[" ","Terms and exclusions apply,",(0,E.jsxs)("span",{className:"tertiary-link-lighter",onClick:this.onShowExclusion,children:[" ","view details."]})]}):null]})}):null]})]})]})}},ei=ti;var os=r(T()),ss=r(T()),Yt=r(Z()),ns=r(oe());Yi();var er=r(T()),is=r(Z());var dt=r(b());function pn(){let s=ue();return(0,dt.jsxs)("div",{style:{border:"none",borderTop:"2px dashed lightgray",borderBottom:"2px dashed lightgray",padding:6,margin:"12px 0"},children:[(0,dt.jsxs)("div",{children:[(0,dt.jsxs)("h4",{style:{display:"inline-block",width:"75%",textAlign:"left",marginBottom:0},children:[(0,dt.jsx)(pe,{}),":"]}),(0,dt.jsx)("h4",{style:{display:"inline-block",width:"25%",textAlign:"end"},children:s})]}),(0,dt.jsxs)("div",{children:[(0,dt.jsx)("h4",{className:"palmetto",style:{display:"inline-block",width:"75%",textAlign:"left",marginBottom:0},children:"Transaction Savings:"}),(0,dt.jsx)("h4",{className:"palmetto",style:{display:"inline-block",width:"25%",textAlign:"end"},children:"???"})]})]})}var ii=pn;var at=r(b()),un=s=>{let{couponCount:t,showReward:e,reward:i}=s,o=_.get("lifetimeSavings"),n=is.default.get(o,"lifetimeSavings.amount",0)*100,a,p,l=u("ext_shorten_notif_text")?"Test codes in seconds.":"Capital One Shopping tests codes in seconds.",d=u("ext_coupon_savings_emphasis")&&n>=1e3;d?(a=(0,at.jsx)(ii,{}),p=(0,at.jsxs)("span",{style:{textAlign:"center",display:"block"},children:["Found"," ",(0,at.jsxs)("span",{className:"palmetto",children:[t," ",t===1?"code":"codes"]})]})):(a=(0,at.jsx)("h4",{className:"bold left",children:fe()||l}),p=ge({couponCount:t}));let m=!0;return(!Mt()||Do())&&(m=!1),m?(0,at.jsxs)("div",{children:[(0,at.jsxs)("h2",{className:"left",children:[p,e&&!d?(0,at.jsxs)(at.Fragment,{children:[" ","and",(0,at.jsx)("br",{}),le(i,{capitalize:!1}),gt(i,{hidePrefix:!0})]}):null]}),a]}):null},be=un;var P=r(b()),oi=class extends ss.Component{constructor(...t){super(...t)}async componentDidMount(){wt()&&!await _t("couponNotifiedImmediately")&&await qe("couponNotifiedImmediately",JSON.stringify({notifiedImmediate:!0})),$(A())&&(this.closeTimeout=setTimeout(()=>this.props.onClosePopup(),5e3))}componentWillUnmount(){clearTimeout(this.closeTimeout)}sendCtaEvent({ctaText:t,clickId:e,couponRunId:i,manuallyActivatedAutoRun:o}={}){let n=se(e);y("track","couponsModalClickCta",{coupons:this.props.couponsFromResult,bestCoupon:this.props.bestCode,savings:this.props.rawSavings,cashback:this.props.isCashback,triggerType:o?"auto":"auto_fallback",ctaText:t,runDuration:Yt.default.get(this,"props.runDuration"),clickId:e,redirectId:n,couponRunId:i}),vt(o?"couponNotification":"couponNotificationResult",t,"cta","primary",{redirect:!0,cashback:this.props.isCashback&&!this.props.hasDeferredCouponRewards,coupons:this.props.couponsFromResult,bestCoupon:this.props.bestCode,savings:this.props.rawSavings,triggerType:o?"auto":"auto_fallback",runDuration:Yt.default.get(this,"props.runDuration"),clickId:e,redirectId:n,couponRunId:i})}onShowExclusion(){y("trackClick","viewExclusionDetails","view details"),window.open(`${st}/s/${this.props.tld}/coupon`,"_blank")}async autoCoupNotifClick({manuallyActivatedAutoRun:t,continueCtaText:e,hasReward:i}){let{activateCredits:o,manuallyActivateAutocoupRun:n}=this.props,a=J(),p=ns.default.v4();t&&sessionStorage.getItem("__cos_coupon_run_id")&&(p=sessionStorage.getItem("__cos_coupon_run_id")),this.sendCtaEvent({ctaText:e,clickId:a,couponRunId:p,manuallyActivatedAutoRun:t});let l=_.get("couponsConfig"),d=Yt.default.get(l,"affiliateLinkCurrentTab")||ft();if(t)await qe("manuallyActivatedAutoRun",JSON.stringify({manuallyActivatedAutoRun:!0})),nt("couponNotifiedImmediately"),n({clickId:a,couponRunId:p}),d||(i?o({clickId:a,fromAutoRun:!0,savings:!0,manuallyActivatedAutoRun:!0}):de({clickId:a,fromAutoRun:!0}));else{nt("couponNotifiedImmediately");let m={fromAutoRun:!0,clickId:a,couponRunId:p};this.props.onTryCodes({disableAutomatic:!0,disableCookieDrop:!1,config:m})}}determineTryCodeCount(){let{autoFallbackCouponsCount:t,couponCount:e}=this.props;return t&&Rt({autoFallbackCouponsCount:t})?t:e}render(){let{activateRewardsOnly:t,reward:e,postCoupons:i,activatingCredits:o,creditsActivated:n,manuallyActivatedAutoRun:a,hasDeferredCouponRewards:p,onShowExclusion:l,vendorName:d}=this.props,m=e&&e.amount&&!i&&!p,f=u("ext_notif_animation")?"btn-wiggle":"",g=this.determineTryCodeCount(),h=Yt.default.get(this.props,"exclusions"),w=$(A()),x=u("ext_red_cta_202305")&&!w,R={display:"flex",flexDirection:"column",justifyContent:"center"};Mt()||(R={...R,paddingLeft:10,paddingRight:10});let C=ge({couponCount:g,isTryCodesButton:!0}),S=d||A(),F=(0,P.jsxs)("div",{children:[o?null:(0,P.jsx)("button",{className:`primary-btn-large ${x?"red-btn-test":""} ${f} ${u("notif_rounded_border")?"rounded-btn":""}`,onClick:async()=>{this.autoCoupNotifClick({manuallyActivatedAutoRun:a,continueCtaText:C,hasReward:m})},children:C}),Eo()?(0,P.jsx)(Vo,{creditsActivated:n,activatingCredits:o,activateRewardsOnly:t,ctaText:C,fromAutoCoupImmediateNotif:a}):null,m&&(0,P.jsx)(Lt,{reward:e,containerStyle:{marginTop:12,textAlign:"left"}}),n||o?(0,P.jsx)("div",{className:`exclusions-wrapper ${o||n?"visible":"invisible"}`,style:{textAlign:"left"},children:(0,P.jsxs)("h6",{style:{height:"30px",display:"flex",marginTop:"10px",paddingLeft:"3px"},children:[(0,P.jsx)("span",{style:{marginRight:"3px"},children:"*"}),(0,P.jsxs)("span",{children:["Rewards may vary based on exchange rates.",h?(0,P.jsxs)(os.default.Fragment,{children:[" ","Terms and exclusions apply,",(0,P.jsxs)("span",{className:"tertiary-link-lighter",onClick:l,children:[" ","view details."]})]}):null]})]})}):null,(n||o)&&(e?.categories||e?.tiers)?(0,P.jsxs)("div",{style:{textAlign:"left",borderTop:"1px solid #dedede",marginTop:15,paddingTop:10},children:[(0,P.jsx)($t,{reward:e}),(0,P.jsx)(Ut,{reward:e})]}):null,(n||o)&&u("ext_exclusion_warning")&&h?(0,P.jsx)("div",{style:{paddingTop:"20px"},children:(0,P.jsx)(vo,{exclusions:h})}):null]});return(0,P.jsx)("div",{className:`no-savings-wrapper automatic${w?" amazon":""}`,children:(0,P.jsxs)("div",{children:[w?(0,P.jsx)("h2",{className:"left",children:(0,P.jsx)("span",{children:"Code Clipped"})}):(0,P.jsxs)("div",{children:[(0,P.jsx)(Bt,{domain:A()}),o?(0,P.jsxs)("h2",{children:["Activating ",e.categories?"up to ":"",(0,P.jsx)("span",{className:"palmetto",children:e.type==="percentage"?`${e.amount/100}%`:H(e.amount,{currency:e.currency})})," ","back"]}):(0,P.jsx)("div",{"data-testid":"right-content",style:R,children:(0,P.jsx)(be,{couponCount:g,showReward:m,reward:e,vendor:S})})]}),F]})})}},ye=ae({vendorName:["siteAPIData","meta","name"]},oi);var ut=r(b()),si=class extends as.Component{constructor(...t){super(...t),this.state={viewCodes:!1,estimatedTimeLeft:null,willEstimateDuration:!1},this.onInitTryCoupons=()=>{this.setState({willEstimateDuration:!0})},this.onEstimatedCouponDuration=({detail:e})=>{this.setState({estimatedTimeLeft:e.estimatedTimeLeft})}}componentDidMount(){document.addEventListener("__iv_init_try_coupons",this.onInitTryCoupons),document.addEventListener("__iv_estimated_coupon_try_duration",this.onEstimatedCouponDuration),!this.props.didTryCodes&&!this.props.running&&this.props.onTryCodes({ignoreCancelled:!0,disableAutomatic:!1,disableCookieDrop:!0})}componentWillUnmount(){document.removeEventListener("__iv_init_try_coupons",this.onInitTryCoupons),document.removeEventListener("__iv_estimated_coupon_try_duration",this.onEstimatedCouponDuration)}render(){let{result:t,couponCount:e,roo:i,hasDeferredCouponRewards:o}=this.props.view,{activateRewardsOnly:n,activateCredits:a,activatingCredits:p,barComplete:l,creditsActivated:d,didTryCodes:m,isCashback:f,manuallyActivateAutocoupRun:g,onShowExclusion:h,onTryCodes:w,pause:x,postCoupons:R,reward:C,running:S}=this.props,F=Q.default.get(t,"pageReload"),N=Q.default.get(t,"originalTotal"),D=Q.default.filter(Q.default.get(t,"coupons"),Be=>Be.savings>0||Be.generatedFreeGift||Be.generatedFreeShipping),I=t&&t.savings&&t.savings>0?H(Math.trunc(t.savings)):0,O=Q.default.get(t,"savings")>=1e5||typeof I=="string"&&Wt(I)>=1e5,W=Q.default.get(t,"savings")>1e6||typeof I=="string"&&Wt(I)>1e6,U=Q.default.get(t,"bestCoupon.code"),Y=(Q.default.get(t,"runTime",0)/1e3).toFixed(2),lt=S||F||l&&!x,it=t&&t.requiresInput,ht=t&&(!U||!I)&&!S&&!it,ot=this.props.exclusions,Et=this.props.tld,xt=C&&C.amount&&!R,Me=Q.default.get(t,"savings"),Oe=Q.default.get(t,"coupons"),$e=Q.default.get(this,"props.view.autoCoupConfig.codeCount")||(i||Gt()?1:2),Gs=Q.default.get(this,"props.view.couponCount")-$e,ie=e-Math.min(e,$e),Le=Q.default.get(this,"props.view.result.runTime"),js=!S&&!t||S||F,Ys=!lt&&!x&&!S&&xt&&this.props.eligibleForNewUserBonus;return(0,ut.jsx)("div",{className:"auto-render-result render-result-layout auto",children:(0,ut.jsx)("div",{className:"left full",children:(0,ut.jsxs)("div",{className:`result-column ${Q.default.get(this.props.googleData,"contacts.length")?"has-contacts":""}`,children:[js?(0,ut.jsx)(ye,{activateRewardsOnly:n,activateCredits:a,activatingCredits:p,autoCoupTryMoreCount:ie,bestCode:U,couponCount:e,couponsFromResult:Oe,creditsActivated:d,didTryCodes:m,exclusions:ot,hasDeferredCouponRewards:o,isCashback:f,manuallyActivateAutocoupRun:g,onShowExclusion:h,onTryCodes:w,postCoupons:R,rawSavings:Me,requiresInput:it,result:t,reward:C,roo:i,runDuration:Le,running:S,runTimeSeconds:Y,tld:Et,couponCount:$e,manuallyActivatedAutoRun:!0,onClosePopup:this.props.onClosePopup.bind(this)}):ht&&!Ct()||ie<0?(0,ut.jsx)(ye,{activateRewardsOnly:n,activateCredits:a,activatingCredits:p,autoCoupTryMoreCount:ie,autoFallbackCouponsCount:Gs,bestCode:U,couponCount:e,couponsFromResult:Oe,creditsActivated:d,didTryCodes:m,exclusions:ot,hasDeferredCouponRewards:o,isCashback:f,onShowExclusion:h,onTryCodes:w,postCoupons:R,rawSavings:Me,requiresInput:it,result:t,reward:C,roo:i,runDuration:Le,running:S,runTimeSeconds:Y,tld:Et,onClosePopup:this.props.onClosePopup.bind(this)}):(0,ut.jsx)(ei,{activateCredits:a,activatingCredits:p,activateRewardsOnly:n,autoCoupTryMoreCount:ie,bestCode:U,couponCount:e,couponsFromResult:Oe,creditsActivated:d,didTryCodes:m,exclusions:ot,hasDeferredCouponRewards:o,isBigSavings:O,isBonkersSavings:W,isCashback:f,onTryCodes:w,originalTotal:N,postCoupons:R,rawSavings:Me,requiresInput:it,reward:C,runDuration:Le,running:S,runTimeSeconds:Y,savings:I,tld:Et,workingCoupons:D,onClosePopup:this.props.onClosePopup.bind(this)}),Ys&&(0,ut.jsxs)("div",{className:"new-user-bonus",children:["Get an ",(0,ut.jsx)("span",{className:"bold",children:"additional $10 in Shopping Rewards"})," today with a qualifying purchase of $25."," ",(0,ut.jsx)("span",{className:"primary-link",onClick:this.onShowNewUserDetails.bind(this),children:"Details"})]})]})})})}onClickViewCode(){y("trackClick","toggleCodes",this.state.viewCodes?"hide codes":"view codes"),this.state.viewCodes||_e(),this.setState({viewCodes:!this.state.viewCodes})}onShowNewUserDetails(){y("trackClick","viewNewUserBonusDetails","Details",{view:"cashbackNotificiation"}),window.open("https://help.capitaloneshopping.com/hc/en-us/articles/360047681572-How-do-I-earn-a-New-Member-Bonus-of-10-in-Wikibuy-Credits-on-my-first-purchase-","_blank")}},ni=si;var rs=r(T()),ps=r(T());var j=r(b()),cn=({reward:s,activateRewardsOnly:t,exclusions:e,onShowExclusion:i,onClosePopup:o,activatingCredits:n,creditsActivated:a,onLoad:p})=>{(0,ps.useEffect)(()=>{p(),Qi("couponDismissConfirmation")},[]);let l=u("ext_red_cta_202305")?"red-btn-test":"",d=u("ext_red_cta_202305")?"unfavorable-text":"primary-text",m=!n&&!a,f=s.type==="percentage"?`${s.amount/100}%`:H(s.amount,{currency:s.currency}),g=s.type==="threshold"&&s.threshold?` when ${H(s.threshold,{currency:s.currency})} spent`:"",h=`Dismiss with ${f} back${g}`,w="Decline Offer",x;u("notif_areyousure_message")&&(h=`Oops! Activate my ${f} back${g}`,x="Rewards are free and take one click.",w="Yes, close without Rewards");let R=()=>{t({label:h,pageLocation:"couponDismissConfirmation"})},C=()=>{u("notif_areyousure_throttling")&&wo("areyousure_throttling"),o(w,{pageLocation:"couponDismissConfirmation"})};return(0,j.jsxs)("div",{className:"flex flex-col items-center justify-center button-wrapper",children:[(0,j.jsx)("h2",{style:{marginTop:16,marginBottom:16},children:"Are you sure?"}),x?(0,j.jsx)("p",{className:"mb-4",children:x}):null,n?(0,j.jsx)("h5",{className:`bold ${d}`,children:"Activating..."}):a?(0,j.jsx)("h5",{className:`bold ${d}`,children:"Activated!"}):(0,j.jsx)("button",{className:`primary-btn-large ${l}`,onClick:R,children:h}),m&&(0,j.jsx)("a",{onClick:C,style:{textDecoration:"none"},children:(0,j.jsx)("h5",{className:"mt-4 font-bold text-base text-neutralsecondary",children:w})}),a||n?(0,j.jsx)("div",{className:`exclusions-wrapper ${n||a?"visible":"invisible"}`,children:(0,j.jsxs)("h6",{style:{height:"30px",display:"flex",marginTop:"10px",paddingLeft:"3px"},children:[(0,j.jsx)("span",{style:{marginRight:"3px"},children:"*"}),(0,j.jsxs)("span",{children:["Rewards may vary based on exchange rates.",e?(0,j.jsxs)(rs.default.Fragment,{children:[" ","Terms and exclusions apply,",(0,j.jsxs)("span",{className:"tertiary-link-lighter",onClick:i,children:[" ","view details."]})]}):null]})]})}):null]})},ai=cn;var Tp=r(T()),Cs=r(T());var _p=r(T()),ys=r(T()),vs=r(bs()),ui=r(Z());function bt(s){return navigator.clipboard.writeText(s).catch(t=>{y("trackError","copyCodeError",s)}),!0}var L=r(b()),Zt=class extends ys.Component{constructor(...t){super(...t),this.state={copied:!1}}render(){let t=this.props.coupon,e=this.props.result&&!this.props.running,i={borderTop:"1px solid #f1f1f1",padding:"10px 0"};return(0,L.jsx)("div",{className:this.state.copied?"copied":"",children:(0,L.jsxs)("div",{style:u("ext_eeyore_modernization")?i:{},className:"coupon-list-item-container",onClick:this.onClickCopy.bind(this),children:[(0,L.jsx)("div",{className:"details",children:(0,L.jsx)("h4",{className:`code midnight bold ${this.props.noScript?"noscript":""}`,children:t.code})}),u("ext_eeyore_modernization")?(0,L.jsx)("div",{className:"savings",children:this.state.copied?(0,L.jsxs)("span",{style:{color:"#01c049"},className:"copied-text",children:["Copied",(0,L.jsx)("svg",{width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",xmlns:"http://www.w3.org/2000/svg",style:{width:"14px",height:"14px",marginLeft:"4px"},children:(0,L.jsx)("path",{d:"M4.49999 14C4.42502 13.9998 4.35104 13.9829 4.28341 13.9506C4.21578 13.9183 4.1562 13.8713 4.10899 13.813L0.108989 8.81302C0.0261092 8.70932 -0.0121819 8.57695 0.00253975 8.44502C0.0172614 8.31308 0.0837895 8.1924 0.187489 8.10952C0.291189 8.02664 0.423565 7.98835 0.555497 8.00307C0.687429 8.0178 0.808109 8.08432 0.890989 8.18802L4.47099 12.664L13.089 0.215024C13.1264 0.161051 13.1741 0.114978 13.2293 0.0794354C13.2846 0.0438932 13.3463 0.0195776 13.4109 0.00787743C13.4755 -0.00382275 13.5418 -0.00267826 13.606 0.0112449C13.6702 0.025168 13.731 0.0515974 13.785 0.0890241C13.839 0.126451 13.885 0.174142 13.9206 0.229374C13.9561 0.284606 13.9804 0.346299 13.9921 0.410928C14.0038 0.475558 14.0027 0.541859 13.9888 0.606047C13.9748 0.670234 13.9484 0.73105 13.911 0.785024L4.91099 13.785C4.86661 13.8491 4.80788 13.9019 4.73947 13.9392C4.67106 13.9765 4.59487 13.9974 4.51699 14H4.49999Z",fill:"#19AC39"})})]}):(0,L.jsx)("svg",{width:"17",height:"19",viewBox:"0 0 17 19",fill:"none",children:(0,L.jsx)("path",{d:"M6.05775 15.5C5.55258 15.5 5.125 15.325 4.775 14.975C4.425 14.625 4.25 14.1974 4.25 13.6923V2.30775C4.25 1.80258 4.425 1.375 4.775 1.025C5.125 0.675 5.55258 0.5 6.05775 0.5H14.4423C14.9474 0.5 15.375 0.675 15.725 1.025C16.075 1.375 16.25 1.80258 16.25 2.30775V13.6923C16.25 14.1974 16.075 14.625 15.725 14.975C15.375 15.325 14.9474 15.5 14.4423 15.5H6.05775ZM6.05775 14H14.4423C14.5192 14 14.5898 13.9679 14.6538 13.9038C14.7179 13.8398 14.75 13.7692 14.75 13.6923V2.30775C14.75 2.23075 14.7179 2.16025 14.6538 2.09625C14.5898 2.03208 14.5192 2 14.4423 2H6.05775C5.98075 2 5.91025 2.03208 5.84625 2.09625C5.78208 2.16025 5.75 2.23075 5.75 2.30775V13.6923C5.75 13.7692 5.78208 13.8398 5.84625 13.9038C5.91025 13.9679 5.98075 14 6.05775 14ZM2.55775 19C2.05258 19 1.625 18.825 1.275 18.475C0.925 18.125 0.75 17.6974 0.75 17.1923V4.30775H2.25V17.1923C2.25 17.2693 2.28208 17.3398 2.34625 17.4038C2.41025 17.4679 2.48075 17.5 2.55775 17.5H12.4423V19H2.55775Z",fill:"#1D92FF"})})}):(0,L.jsxs)("div",{className:"savings",children:[this.state.copied?(0,L.jsx)("span",{style:{color:"#788b96",marginRight:"8px"},className:"copied-text",children:"Copied"}):null,this.state.copied&&!this.props.disableChecks?(0,L.jsx)("svg",{viewBox:"0 0 150 150",children:(0,L.jsx)("path",{d:"M10,30 l30,50 l95,-70",fill:"none",strokeWidth:"15",style:{stroke:"#0276b1",strokeDasharray:"180px, 180px",strokeDashoffset:"0px",animationDelay:e?"0ms":`${this.props.stagger*this.props.index}ms`}})}):null]})]})})}onClickCopy(){let t=J();this.setState({copied:bt(this.props.coupon.code)},()=>{this.timeoutId=setTimeout(()=>{this.setState({copied:!1})},1e4)}),y("trackClick","copyCouponCode","code",{clickId:t})}componentWillUnmount(){clearTimeout(this.timeoutId)}};Zt.defaultProps={stagger:400};function Vt(s){return s.collapsable?(0,L.jsx)(vs.default,{isOpened:!!s.show,className:"reactcollapse",children:(0,L.jsx)("div",{className:`code-list ${s.className||""}`,children:ui.default.map(s.coupons,(t,e)=>(0,L.jsx)(Zt,{running:s.running,result:s.result,index:e,coupon:t,stagger:s.stagger,disableChecks:s.disableChecks,noScript:s.noScript},e))})}):(0,L.jsx)("div",{className:`code-list ${s.className||""}`,children:ui.default.map(s.coupons,(t,e)=>(0,L.jsx)(Zt,{running:s.running,result:s.result,index:e,coupon:t,stagger:s.stagger,disableChecks:s.disableChecks,noScript:s.noScript},e))})}var V=r(b()),ci=class extends Cs.Component{state={showCodes:!1};componentDidMount(){localStorage.getItem("__wb_redirecting")&&this.setUpPostRedirect()}setUpPostRedirect(){this.setState({showCodes:!0}),localStorage.removeItem("__wb_redirecting")}render(){let{coupons:t,result:e,couponCount:i}=this.props.view,{reward:o,postCoupons:n,onShowExclusion:a,exclusions:p}=this.props,l=o&&o.amount&&!n,d=!e&&l&&this.props.eligibleForNewUserBonus,m=u("notif_rounded_border")?"rounded-btn":"";return(0,V.jsxs)("div",{children:[(0,V.jsxs)("div",{className:"found-codes",children:[this.props.reward&&this.state.showCodes?(0,V.jsxs)("h2",{children:["Activated ",gt(o,{hidePrefix:!0})]}):(0,V.jsxs)("h2",{children:["Found ",i," ",i===1?"code":"codes",l&&(0,V.jsxs)(V.Fragment,{children:[" ","and",(0,V.jsx)("br",{}),le(o,{capitalize:!1}),gt(o,{hidePrefix:!0})]})]}),this.state.showCodes?(0,V.jsx)("h4",{className:"bold",children:"Click code to copy to clipboard."}):(0,V.jsxs)("h4",{className:"bold",children:["Click show ",i===1?"code":"codes"," to save."]})]}),this.state.showCodes?(0,V.jsx)("div",{children:(0,V.jsx)(Vt,{show:!0,result:e,running:!1,coupons:t,stagger:0,noScript:!0,collapsable:!0})}):(0,V.jsxs)("button",{className:`primary-btn-large ${u("ext_red_cta_202305")?"red-btn-test":""} ${m}`,style:{width:"100%",fontWeight:"bold",marginTop:"20px"},onClick:this.onShowCodes.bind(this),children:["Show ",i===1?"Code":"Codes"]}),d&&(0,V.jsxs)("div",{className:"new-user-bonus",children:["Get an ",(0,V.jsx)("span",{className:"bold",children:"additional $10 in Shopping Rewards"})," today with a qualifying purchase of $25."," ",(0,V.jsx)("span",{className:"primary-link",onClick:this.onShowNewUserDetails.bind(this),children:"Details"})]}),o&&this.state.showCodes&&(0,V.jsx)(zt,{exclusions:p,onDetailsClick:a,style:{display:"flex"}})]})}onShowCodes(){let t=this.props.reward,e=A();y("trackClick","showCodesButton","show codes",{domain:e,cashback:this.props.isCashback}),vt("couponNotification","show codes","cta","primary",{redirect:!0,cashback:this.props.isCashback,domain:e}),this.props.reward&&(Ot(),y("track","activateCashbackRedirect",{rewardAmount:t.amount,rewardDisplay:t.type}));let{clickId:i}=re();Lo(i),y("track","showCodes",{cashback:this.props.isCashback,clickId:i}),this.setState({showCodes:!0})}onShowNewUserDetails(){y("trackClick","viewNewUserBonusDetails","Details",{view:"cashbackNotificiation"}),window.open("https://help.capitaloneshopping.com/hc/en-us/articles/360047681572-How-do-I-earn-a-New-Member-Bonus-of-10-in-Wikibuy-Credits-on-my-first-purchase-","_blank")}},li=ci;var ks=r(T()),Kt=r(Ve()),Qt=r(b());function Se({hideNotification:s,shouldDisableCouponNotifAnimation:t,styles:e,children:i}){let{width:o,minHeight:n,marginRight:a,className:p,left:l,right:d,translate:m}=e;return(0,Qt.jsx)(ks.default.Fragment,{children:t&&!s?(0,Qt.jsx)("div",{className:p,style:{transform:"translate3d(0,0%,0)",opacity:"1",width:o,minHeight:n,marginRight:a,left:l,right:d,translate:m},children:i}):(0,Qt.jsx)(Kt.Motion,{style:{opacity:(0,Kt.spring)(s?0:1,{stiffness:180,damping:20}),y:(0,Kt.spring)(s?-100:0,{stiffness:180,damping:20})},children:({opacity:f,y:g})=>(0,Qt.jsx)("div",{className:p,style:{transform:`translate3d(0,${g}%,0)`,opacity:`${f}`,width:o,minHeight:n,marginRight:a,left:l,right:d,translate:m},children:i})})})}var Vs=r(T()),B=r(Z());var pu=r(T()),Rs=r(T()),At=r(Z()),Ts=r(oe());var di=r(T()),rt=r(Z()),xs=r(oe());var mi=class extends di.default.Component{constructor(...t){super(...t),this.state={},this.impressionMap=[]}componentWillMount(){rt.default.get(this.props,"children.length")&&!this.props.ignoreImpression&&this.setState({children:this.attachProps(this.props.children)})}componentDidMount(){this.props.logOnMount&&this.logImpression(rt.default.map(this.state.children,(t,e)=>({type:"impression",props:{...t.mirageData.trackProps,displayIndex:String(e)}})))}componentWillReceiveProps(t){!this.props.ignoreImpression&&rt.default.get(t.children,"length")&&!rt.default.get(this.props.children,"length")&&!this.state.children&&this.setState({children:this.attachProps(t.children)})}render(){let t=this.props.children;return this.state.children?(t=this.state.children,rt.default.map(t,e=>e.component)):t}attachProps(t){let e=this.logImpression.bind(this);return rt.default.map(t,i=>{if(!i||!i.props)throw new Error("Children Must Be A Component");let o=rt.default.clone(rt.default.get(i.props,"__mirage",{}));o.trackProps.view_id=xs.default.v4();let n={...i.props,__mirage:o,logImpression:e};return{mirageData:o,component:di.default.cloneElement(i,n)}})}logImpression(t){t=rt.default.isArray(t)?t:[t];let e=rt.default.filter(t,i=>!rt.default.find(this.impressionMap,{type:i.type,props:{contentInstanceId:i.props.contentInstanceId}}));e.length&&(this.impressionMap=this.impressionMap.concat(e),ro(t))}},hi=mi;var ct=r(b()),Fn=({style:s,image:t,title:e,subtitle:i,cta:o,onClickContentCard:n,...a})=>{let p=bo(t?.url);return(0,ct.jsx)("div",{style:s,onClick:()=>n(a),className:"store-content-card-a",children:(0,ct.jsxs)("div",{className:"flex",children:[(0,ct.jsx)("div",{className:"image-wrapper",children:(0,ct.jsx)("div",{className:`image ${t?.className||""}`,style:{...t?.style||{},backgroundImage:p?`url("${p}")`:void 0},children:p===null&&(0,ct.jsx)(yo,{})})}),(0,ct.jsxs)("div",{className:"content",children:[(0,ct.jsx)("h4",{className:`${e?.className||""} charcoal`,style:e?.style,children:e?.value}),(0,ct.jsx)("h5",{className:`${i?.className||""} silver`,style:i?.style,children:i?.value}),(0,ct.jsx)("h6",{className:`${o?.className||""} palmetto`,style:o?.style,children:o?.value})]})]})})},fi=Fn;var Nt=r(b()),_i=class extends Rs.Component{constructor(...t){super(...t),this.state={}}render(){return(0,Nt.jsxs)("div",{className:"store-content-data",children:[(0,Nt.jsx)("div",{children:(0,Nt.jsx)("h2",{className:"bold",children:"Personalized Offers"})}),(0,Nt.jsx)(hi,{logOnMount:!0,children:At.default.map(At.default.get(this.props.data,"items"),(t,e)=>(0,Nt.jsx)(fi,{onClickContentCard:this.onClickContentCard.bind(this),index:e,...t},e))})]})}onClickContentCard(t){let e=Ts.default.v4(),i=At.default.get(t,"__mirage.trackProps",{});t.logImpression({type:"click",props:{...i,clickId:e,displayIndex:String(t.index)}}),t.actions&&At.default.forEach(t.actions,o=>{if(o.type==="openUrl"){let n=At.default.get(o.props,"href").replace("__WBCLICKID__",e);window.open(n,At.default.get(o.props,"target","_blank"))}})}},gi=_i;var Ss=()=>ne("manufacturedSavingsThrottlingGet");var wi=r(b());function Ae(){return(0,wi.jsx)("div",{className:"blocks-offers",children:(0,wi.jsx)(Go,{contentSlug:"blocks-personalized-offers"})})}var Ns=r(T());var As=()=>ne("manufacturedSavingsThrottlingSet");var pt=r(b()),Mn=({payoutProcessingPeriod:s,onClosePopup:t})=>{let[e,i]=(0,Ns.useState)(!1),o=async()=>{let n=_.get("siteAPIData","tld");y("track","extSavingsEarned",{domain:n}),await As(),t()};return(0,pt.jsxs)("div",{className:"activate-manufactured-wrapper",children:[(0,pt.jsxs)("div",{className:"spacing",children:[(0,pt.jsxs)("h3",{children:["Activate now to receive ",(0,pt.jsx)("span",{className:"palmetto size-emphasis",children:"$5.00"})]}),(0,pt.jsx)("h5",{children:"in Shopping Rewards"})]}),(0,pt.jsxs)("div",{className:"spacing",children:[(0,pt.jsxs)("p",{children:["Complete your purchase now to receive your rewards by"," ",we(s)]}),(0,pt.jsx)("p",{children:"You can redeem your Rewards for gift cards from top merchants"})]}),(0,pt.jsx)("div",{className:"activate-button",children:(0,pt.jsx)("button",{className:"primary-btn-large red-btn-test",disabled:e,onClick:()=>{o(),i(!0)},children:e?"Activating Rewards ...":"Activate Rewards"})})]})},bi=Mn;var Ne=r(T());var z=r(b());function On(s){y("trackClick","viewExclusionDetails","view details"),window.open(`${st}/s/${s}/coupon`,"_blank")}var Is={marginTop:30},yi={marginTop:10},Ps="Activate Rewards",$n=({reward:s,payoutProcessingPeriod:t,exclusions:e,tld:i,activateRewardsOnly:o})=>{let[n,a]=(0,Ne.useState)(void 0),p=$(A()),l=u("ext_red_cta_202305")&&!p;return(0,z.jsx)("div",{style:{display:"flex",height:"100%",overflow:"scroll",padding:u("ext_coupons_streamlined_click")?void 0:"0 28px"},children:(0,z.jsxs)("div",{style:{alignSelf:s.categories?"flex-start":"safe center",flex:u("ext_coupons_streamlined_click")?1:void 0},children:[!u("ext_coupons_streamlined_click")&&(0,z.jsxs)("h2",{children:["Activate now to earn ",gt(s,{hidePrefix:!0}),"!"]}),s.type==="threshold"&&s.threshold?(0,z.jsx)(Lt,{reward:s,containerStyle:yi}):(0,z.jsxs)("h6",{style:yi,children:["Rewards may vary based on exchange rates.",e&&(0,z.jsxs)(Ne.default.Fragment,{children:[" ","Terms and exclusions apply,",(0,z.jsxs)("span",{className:"tertiary-link-lighter",onClick:()=>On(i),children:[" ","view details."]})]})]}),!u("ext_coupons_streamlined_click")&&(0,z.jsxs)(z.Fragment,{children:[(0,z.jsxs)("h5",{style:Is,children:["Complete your purchase now to receive your Rewards by"," ",(0,z.jsx)("span",{className:"bold",children:we(t)}),"."]}),(0,z.jsx)("h5",{style:yi,children:"You can redeem your Rewards for gift cards from top merchants."}),!!s.categories&&(0,z.jsx)("div",{style:Is,children:(0,z.jsx)($t,{reward:s,tld:i,center:!0})}),(0,z.jsx)(Ut,{reward:s})]}),(0,z.jsx)("div",{className:"sticky-cta",children:(0,z.jsx)("button",{className:`primary-btn-large ${l?"red-btn-test":""}`,disabled:n,onClick:()=>{let{clickId:d}=re();o({clickId:d,label:Ps,fromActivateRewards:!0}),a(!0)},style:u("ext_coupons_streamlined_click")?{width:"100%",marginTop:10}:void 0,children:n?"Activating Rewards...":Ps})})]})})},vi=$n;var sc=r(T()),Ci=r(T()),Ds=r(Z());var kt=r(b()),Ie=class extends Ci.Component{constructor(...t){super(...t),this.state={copied:!1}}render(){let t=this.props.coupon;return(0,kt.jsx)("div",{className:`coupon-item-wrapper ${this.props.active?"active":""} ${t.success?"success":"finished"} ${this.state.copied?"copied":""}`,children:(0,kt.jsx)("div",{className:"coupon-list-item-container",onClick:this.onClickCopy.bind(this),children:(0,kt.jsx)("div",{className:"details",children:(0,kt.jsx)("h4",{className:"code midnight bold",children:t.code})})})})}onClickCopy(){let t=J();this.setState({copied:bt(this.props.coupon.code)},()=>{this.timeoutId=setTimeout(()=>{this.setState({copied:!1})},1e3)}),y("trackClick","copyCouponCode","code",{clickId:t})}componentWillUnmount(){clearTimeout(this.timeoutId)}};Ie.defaultProps={stagger:400};var Jt=class extends Ci.Component{constructor(...t){super(...t);let e=0;this.props.roo&&this.props.currentCodeIndex>-1&&(e=this.props.currentCodeIndex),this.state={active:e},this.onEstimatedCouponDuration=({detail:i})=>{let o=i.currentCodeIndex;o>=0&&o<this.props.coupons.length&&o>this.state.active&&this.setState({active:o})}}componentWillReceiveProps(t){t.pause!==this.state.pause&&(t.pause?clearInterval(this.interval):this.startInterval())}componentDidMount(){this.props.roo&&this.startInterval(),document.addEventListener("__iv_estimated_coupon_try_duration",this.onEstimatedCouponDuration)}startInterval(){let t=this.props.runTimePerCoupon||(this.props.estimatedRunTime+1e3)/this.props.coupons.length;this.interval=setInterval(()=>{let e=this.state.active+1;this.setState({active:e}),e===this.props.coupons.length-1&&clearInterval(this.interval)},t)}componentWillUnmount(){clearInterval(this.interval),document.removeEventListener("__iv_estimated_coupon_try_duration",this.onEstimatedCouponDuration)}render(){let t=!!u("ext_coupons_streamlined_click"),e=t?(this.state.active-1)*40:(this.state.active-4)*40,i=u("ext_coupons_streamlined_click")?"reduced-height":"",o=t?this.state.active>2:this.state.active>4,n={WebkitTransform:`translate3d(0px, -${e}px, 0px)`,transform:`translate3d(0px, -${e}px, 0px)`,msTransform:`translate3d(0px, -${e}px, 0px)`,WebkitTransition:"-webkit-transform 0.3ms ease",transition:"transform 0.3s ease"};return(0,kt.jsx)("div",{className:"code-list-wrapper",children:(0,kt.jsx)("div",{style:o?n:{},className:`code-list ${this.props.className||""} ${i}`,children:Ds.default.map(this.props.coupons,(a,p)=>(0,kt.jsx)(Ie,{last:p===this.props.coupons.length-1,running:this.props.running,result:this.props.result,index:p,active:this.state.active===p,coupon:a,disableChecks:this.props.disableChecks},p))})})}};var Pe=r(T());var K=r(b()),ki=class extends Pe.default.Component{constructor(t){super(t),this.state={answered:!1}}componentDidMount(){y("page","ilSurvey")}handleSelection=t=>{t.type==="change"&&(y("track","ilSurveyResponse",{value:t.target.value}),setTimeout(()=>{this.setState({answered:!0},()=>{this.props.dismiss()})},250))};render(){let t=u("il_survey_split")?"Would you be interested in splitting this purchase into 4 payments with 0% interest and no fees?":u("il_survey_apr")?"Would you be interested in splitting this purchase into equal monthly payments with a competitive APR and no fees?":"Would you be interested in splitting this purchase into equal monthly payments at 0% APR and no fees?";return(0,K.jsx)("div",{className:"installment-survey",children:this.state.answered?(0,K.jsxs)(Pe.default.Fragment,{children:[(0,K.jsx)("h3",{children:"Thank you for letting us know!"}),(0,K.jsx)("p",{children:"We're exploring this as a feature of Capital One Shopping and will let you know if it becomes available!"})]}):(0,K.jsxs)(Pe.default.Fragment,{children:[(0,K.jsx)("h3",{children:t}),(0,K.jsxs)("div",{children:[(0,K.jsxs)("div",{className:"answer",children:[(0,K.jsx)("input",{type:"radio",className:"default",name:"survey-response",id:"survey-response-yes",onChange:this.handleSelection,value:"yes"}),(0,K.jsx)("label",{htmlFor:"survey-response-yes",children:"Yes"})]}),(0,K.jsxs)("div",{className:"answer",children:[(0,K.jsx)("input",{type:"radio",className:"default",name:"survey-response",id:"survey-response-no",onChange:this.handleSelection,value:"no"}),(0,K.jsx)("label",{htmlFor:"survey-response-no",children:"No"})]})]})]})})}},xi=ki;var X=r(b()),Ln=()=>(0,X.jsxs)("svg",{width:"232",height:"157",viewBox:"0 0 232 157",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,X.jsx)("circle",{cx:"120.273",cy:"66.7137",r:"55.183",fill:"#0276B1"}),(0,X.jsx)("path",{d:"M91.229 83.5287C98.2439 87.999 105.053 90.2341 111.655 90.2341C115.85 90.2341 119.22 89.4088 121.765 87.7583C124.309 86.1077 125.581 83.8726 125.581 81.0528C125.581 77.7517 123.415 75.2758 119.082 73.6253L114.027 71.5621C108.182 69.2238 104.021 66.6447 101.545 63.825C99.138 61.0053 97.9344 57.3947 97.9344 52.9932C97.9344 48.2478 99.2068 44.0526 101.751 40.4076C104.296 36.6938 107.735 33.8741 112.067 31.9484C116.469 29.954 121.386 28.9568 126.819 28.9568C130.74 28.9568 134.9 29.5069 139.302 30.6073C143.703 31.6389 147.245 32.9456 149.927 34.5274L147.245 48.0415C144.769 46.5284 141.846 45.3249 138.477 44.4308C135.175 43.468 132.046 42.9866 129.089 42.9866C125.375 42.9866 122.383 43.7087 120.114 45.153C117.913 46.5284 116.813 48.3853 116.813 50.7236C116.813 52.2367 117.294 53.4402 118.257 54.3343C119.22 55.2283 121.18 56.2943 124.137 57.5322L129.192 59.6986C134.694 62.1057 138.614 64.8222 140.952 67.8483C143.291 70.8056 144.46 74.5881 144.46 79.1959C144.46 84.354 143.188 88.8587 140.643 92.71C138.098 96.4925 134.591 99.4154 130.121 101.479C125.65 103.473 120.492 104.47 114.646 104.47C106.394 104.47 98.5878 102.51 91.229 98.5901V83.5287Z",fill:"white"}),(0,X.jsx)("path",{d:"M57.73 29.6364C55.4526 30.2482 53.1151 28.9172 52.5135 26.666C51.9118 24.4148 53.2724 22.0903 55.5497 21.4784C57.8271 20.8666 60.1646 22.1976 60.7663 24.4488C61.3679 26.7 60.0073 29.0246 57.73 29.6364Z",fill:"#281830"}),(0,X.jsx)("path",{d:"M164.824 9.46223C162.765 10.6147 160.174 9.89826 159.04 7.8634C157.907 5.82853 158.658 3.24066 160.717 2.0882C162.775 0.935729 165.367 1.65217 166.5 3.68703C167.633 5.7219 166.882 8.30977 164.824 9.46223Z",fill:"#CC2427"}),(0,X.jsx)("path",{d:"M219.769 81.6748L214.815 71.7271L209.862 61.7795L220.931 62.4522L232 63.1248L225.884 72.3998L219.769 81.6748Z",fill:"#98D5EC"}),(0,X.jsx)("path",{d:"M23.483 33.3298L27.1139 30.2731C27.1139 30.2731 16.7896 28.992 15.0857 22.2543C12.6536 12.6373 5.07239 9.98347 5.07239 9.98347L1.22218 13.1913C1.22218 13.1913 6.41654 16.1741 9.96631 25.139C13.6656 34.4813 23.483 33.3298 23.483 33.3298Z",fill:"#98D5EC"}),(0,X.jsx)("path",{d:"M190.01 110.924L194.315 112.916C194.315 112.916 191.075 103.005 196.429 98.5896C204.072 92.2881 203.239 84.2805 203.239 84.2805L198.705 82.1536C198.705 82.1536 198.225 88.136 191.646 95.1738C184.791 102.508 190.01 110.924 190.01 110.924Z",fill:"#CC2427"}),(0,X.jsx)("path",{d:"M212.266 30.3042C212.266 30.3042 212.392 26.2833 216.522 25.1719C220.143 24.1977 220.048 22.5491 220.048 22.5491C220.048 22.5491 215.036 19.9703 212.293 16.6328C210.213 14.1012 210.241 10.347 210.241 10.347C210.241 10.347 210 12.5232 205.239 14.9111C203.772 15.6465 200.975 16.0245 200.975 16.0245C200.975 16.0245 202.814 20.7328 205.115 23.9045C207.416 27.0763 212.266 30.3042 212.266 30.3042Z",fill:"#3374AC"}),(0,X.jsx)("path",{d:"M31.3189 76.0543C31.3189 76.0543 32.6673 72.6618 36.5354 72.9946C39.9264 73.2864 40.3534 71.8497 40.3534 71.8497C40.3534 71.8497 36.8719 68.0942 35.561 64.3952C34.5664 61.5892 35.7491 58.394 35.7491 58.394C35.7491 58.394 34.8716 60.1764 30.0716 60.7375C28.5932 60.9103 26.0888 60.3651 26.0888 60.3651C26.0888 60.3651 26.2058 64.9539 27.1907 68.3745C28.1757 71.7951 31.3189 76.0543 31.3189 76.0543Z",fill:"#CC2427"}),(0,X.jsx)("path",{d:"M51.9231 118.149C51.9231 118.149 49.3936 115.522 51.2873 112.124C52.9474 109.145 51.817 108.164 51.817 108.164C51.817 108.164 46.9708 109.8 43.0688 109.477C40.1088 109.232 37.6905 106.837 37.6905 106.837C37.6905 106.837 38.9499 108.372 37.4856 112.989C37.0346 114.411 35.5088 116.476 35.5088 116.476C35.5088 116.476 39.7286 118.256 43.2433 118.763C46.7581 119.27 51.9231 118.149 51.9231 118.149Z",fill:"#98D5EC"}),(0,X.jsx)("ellipse",{cx:"120.284",cy:"152.263",rx:"45.1112",ry:"4.2963",fill:"#D9D9D9"})]}),Es=Ln;var It=r(b()),Bn=()=>(0,It.jsxs)("div",{className:"manufactured-rewards-wrapper",children:[(0,It.jsx)("h5",{children:"Limited Time Offer!"}),(0,It.jsx)("h3",{children:"You've been selected for a special one time offer!"}),(0,It.jsx)("div",{className:"celebrate-svg",children:(0,It.jsx)(Es,{})})]}),Ri=Bn;var Fs=r(T()),Ms=r(T()),Xt=r(Z());var Ic=r(T()),Ti=r(b()),Un=s=>{let t=s.h||60,e=s.w||76;return(0,Ti.jsx)("svg",{className:"checkmark-icon",width:e,height:t,viewBox:"0 0 76 60",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,Ti.jsx)("path",{d:"M24.323 57.46h0L2.668 35.91l-.002-.002a.79.79 0 01-.235-.563v-.005c0-.217.08-.412.232-.565l.001-.001 5.862-5.86s0 0 0 0a.787.787 0 01.565-.235h.002a.78.78 0 01.562.235h0L23.77 43.027l1.061 1.06 1.06-1.06L66.378 2.541h.001a.785.785 0 01.512-.233 1.5 1.5 0 01.364.088.73.73 0 01.251.147l.001.001 5.836 5.898h0a.8.8 0 01-.003 1.123l1.06 1.06-1.06-1.06L25.447 57.46a.788.788 0 01-.562.231.79.79 0 01-.562-.23z",strokeWidth:"3"})})},Si=Un;var v=r(b()),Ai=class extends Ms.Component{constructor(...t){super(...t),this.state={viewCodes:!1}}componentDidMount(){let t=$(A());if(u("coup_modal_auto_dismiss")&&!t){let e=this.props.reward?8e3:5e3;this.props.closeModalTimeout(e)}}render(){let{runTimeSeconds:t,couponCount:e,reward:i,codes:o,postCoupons:n,requiresInput:a,view:p}=this.props,l=i&&i.amount&&!i.categories&&!n&&!p.hasDeferredCouponRewards,d=$(A()),m=u("ext_red_cta_202305")&&!d,f=`${u("ext_coupons_streamlined_click")?"primary-btn-small":"primary-btn-large"} ${m?"red-btn-test":""}`,g=u("ext_modal_savings_emphasis")?ue():null,h=!!g;return(0,v.jsxs)("div",{className:"no-savings-wrapper",children:[a&&(0,v.jsxs)("div",{className:"no-savings-header",children:[(0,v.jsx)("h2",{children:"Code Entered"}),o&&o.length&&!u("ext_coupons_streamlined_click")&&(0,v.jsx)("div",{className:"view-codes-link-wrapper",children:(0,v.jsx)("h6",{onClick:l?()=>this.setState({viewCodes:!this.state.viewCodes}):null,className:`${l?"clickable":""} bold"`,children:this.state.viewCodes?(0,v.jsx)("span",{children:"hide codes"}):(0,v.jsxs)("span",{children:[u("coup_fo_202403_test")?"A variety of codes":`${e} ${e===1?"code":"codes"}`," ","tested in ",t," sec."]})})})]}),this.state.viewCodes&&!l?(0,v.jsx)("div",{className:"view-codes",children:Xt.default.map(o,(w,x)=>{let R=this.state.copied===w.code;return(0,v.jsx)("div",{onClick:this.onClickCopy.bind(this,w.code),style:{animationDelay:`${(x+1)*50}ms`},className:`coupon-list-item-container gray ${R?"copied":""}`,children:(0,v.jsxs)("h4",{className:"code midnight bold",children:[R?(0,v.jsx)("span",{className:"copied-text",children:"COPIED"}):w.code,(0,v.jsx)("span",{className:"hidden",children:w.code})]})},x)})}):null,l&&a?(0,v.jsx)("div",{className:u("ext_coupons_streamlined_click")?void 0:"center-content",children:(0,v.jsxs)("div",{className:"activation-amount",children:[(0,v.jsxs)("h3",{className:"silver",style:u("ext_coupons_streamlined_click")?{margin:"10px 0"}:void 0,children:[(0,v.jsx)("span",{className:"palmetto bold",children:i.type==="percentage"?`+${i.amount/100}%`:"+"+H(i.amount,{currency:i.currency})})," ",(0,v.jsx)("span",{className:"antialiased",children:"Shopping Rewards"})]}),Xt.default.get(this.props,"exclusions")?(0,v.jsx)(zt,{style:u("ext_coupons_streamlined_click")?{display:"flex"}:{height:"19px",marginTop:"1px",display:"flex",alignItems:"center",justifyContent:"center"},onDetailsClick:this.onShowExclusion.bind(this)}):null]})}):!p.hasDeferredCouponRewards&&!i.categories&&a?(0,v.jsx)("div",{className:"center-content",children:(0,v.jsxs)("h6",{className:"bold",children:[u("coup_fo_202403_test")?"A variety of codes":`${e} ${e===1?"code":"best codes"}`," ","tested in ",t," sec."]})}):!p.hasDeferredCouponRewards&&i.categories&&a?(0,v.jsx)("div",{}):!p.hasDeferredCouponRewards||!a?(0,v.jsxs)("div",{className:u("ext_coupons_streamlined_click")?void 0:"center-column",children:[u("ext_coupons_streamlined_click")&&(0,v.jsx)("div",{className:"best-price-image",style:{width:140,height:140,margin:"0 auto"},children:(0,v.jsx)(Si,{w:"100%",h:"100%"})}),(0,v.jsx)("h2",{style:u("ext_coupons_streamlined_click")?{fontSize:20}:void 0,children:"You have a great price."}),!u("ext_coupons_streamlined_click")&&!h&&(0,v.jsx)("div",{className:"best-price-image",children:(0,v.jsx)(Si,{})}),u("ext_coupons_streamlined_click")?(0,v.jsx)("h4",{className:"bold left",children:i&&p.hasDeferredCouponRewards?(0,v.jsxs)(v.Fragment,{children:["Activate now to earn ",gt(i,{hidePrefix:!0})]}):(0,v.jsxs)(v.Fragment,{children:["We tried"," ",(0,v.jsx)("span",{children:u("coup_fo_202403_test")?"a variety of codes":`${e} ${e===1?"code":"codes"}`})]})}):(0,v.jsxs)("p",{style:h?{textAlign:"center",marginTop:8}:void 0,children:["We tried"," ",(0,v.jsx)("span",{children:u("coup_fo_202403_test")?"a variety of codes":`${e} ${e===1?"code":"codes"}`})," ","to make sure you got a great price, but did not find any additional savings."]}),h&&(0,v.jsxs)("div",{style:{textAlign:"center",marginTop:64},children:[(0,v.jsx)("h6",{className:"bold",children:(0,v.jsx)(pe,{prefixText:"You've",hoverText:"saved"})}),(0,v.jsx)("h1",{className:"brand",children:g}),(0,v.jsx)("h6",{className:"bold",children:"so far with"}),(0,v.jsx)("h6",{className:"bold",children:"Capital One Shopping"})]})]}):null,(!i||!p.hasDeferredCouponRewards)&&(0,v.jsx)("div",{className:"dismiss-notif",children:wt()&&Xt.default.get(this,"props.view.manuallyActivatedAutoRun")&&!(Xt.default.get(this,"props.view.result.savings")>0)?(0,v.jsx)(Fs.default.Fragment,{children:(0,v.jsx)(Yo,{view:this.props.view,isCashback:this.props.isCashback,onTryCodes:this.props.onTryCodes,buttonClassName:f})}):(0,v.jsx)("button",{className:f,onClick:this.props.onClosePopup.bind(this),style:u("ext_coupons_streamlined_click")?{width:"100%",marginTop:10}:void 0,children:"Continue to Checkout"})})]})}onShowExclusion(){y("trackClick","viewExclusionDetails","view details"),window.open(`${st}/s/${this.props.tld}/coupon`,"_blank")}onClickCopy(t){let e=J();bt(t),this.setState({copied:t},()=>{this.timeoutId=setTimeout(()=>{this.setState({copied:!1})},1e3)}),y("trackClick","copyCouponCode","code",{clickId:e})}},Ni=Ai;var nl=r(T()),$s=r(T()),Ls=r(Z());var Os=r(T()),mt=r(b()),Ii=class extends Os.default.Component{render(){return this.props.type==="half"?this.half():this.full(this.props.type)}half(){return(0,mt.jsxs)("svg",{className:"nc-icon glyph star",x:"0px",y:"0px",width:"48px",height:"48px",viewBox:"-281 373 48 48",children:[(0,mt.jsx)("g",{children:(0,mt.jsx)("path",{fill:"#E8E8E8",stroke:"#acaaaa",d:`M-256.1,376l6.5,13.2l14.6,2.1c0.8,0.1,1.1,1.1,0.6,1.7l-10.5,10.3l2.5,14.5c0.1,0.8-0.7,1.4-1.5,1.1l-13-6.9
            l-13,6.9c-0.7,0.4-1.6-0.2-1.5-1.1l2.5-14.5l-10.5-10.3c-0.6-0.6-0.3-1.6,0.6-1.7l14.6-2.1l6.5-13.2
            C-257.5,375.2-256.5,375.2-256.1,376z`})}),(0,mt.jsx)("g",{children:(0,mt.jsx)("path",{fill:"#F9C319",d:`M-257,412l-13,6.9c-0.7,0.4-1.6-0.2-1.5-1.1l2.5-14.5l-10.5-10.3c-0.6-0.6-0.3-1.6,0.6-1.7l14.6-2.1l6.5-13.2
            c0.2-0.4,0.5-0.6,0.9-0.6L-257,412z`})})]})}full(t){let e=this.props.type==="empty";return(0,mt.jsx)("svg",{onClick:this.props.onClick?this.props.onClick.bind(this,this.props.rating):null,className:"nc-icon glyph star",x:"0px",y:"0px",width:"48px",height:"48px",viewBox:"0 0 48 48",children:(0,mt.jsx)("g",{children:(0,mt.jsx)("path",{fill:e?"#E8E8E8":"#f9c319",stroke:e?"#acaaaa":"#f9c319",d:"M24.897,2.99l6.521,13.211l14.577,2.119c0.82,0.119,1.148,1.127,0.554,1.706L36,30.307l2.49,14.52 c0.14,0.817-0.717,1.44-1.451,1.054l-13.038-6.854l-13.04,6.856C10.227,46.27,9.37,45.647,9.51,44.83L12,30.307L1.451,20.026 c-0.594-0.578-0.266-1.587,0.554-1.706l14.577-2.119L23.103,2.99C23.47,2.247,24.53,2.247,24.897,2.99z"})})})}},Pi=Ii;var Pt=r(b()),Di=class extends $s.Component{constructor(...t){super(...t),this.state={deduction:5}}componentDidMount(){y("track","reviewWikibuyVisible",{})}render(){return this.state.confirmation?(0,Pt.jsx)("span",{}):(0,Pt.jsxs)("div",{className:"review-wrapper",children:[(0,Pt.jsx)("h4",{className:"bold charcoal",style:{textAlign:"center",marginBottom:15},children:"How would you rate Capital One Shopping?"}),(0,Pt.jsx)("div",{className:"review-wikibuy",children:Ls.default.map(new Array(5),(t,e)=>(0,Pt.jsx)(Pi,{onClick:this.starWikibuy.bind(this,e),rating:e,type:this.state.deduction<=e?"fill":"empty"},e))})]})}starWikibuy(t){this.setState({deduction:t}),this.rateWikibuy("star",t)}checkStars(t){let e=this.state.deduction;e===0?this.rateWikibuy(t,e):this.rateWikibuy(t,e)}rateWikibuy(t,e){let i=this.props.savings;y("trackClick","rateWikibuy",t,{savings:i,rating:5-e});let n=no().browser.name;if(e===0){if(n==="Edge"){window.open("https://microsoftedge.microsoft.com/addons/detail/capital-one-shopping-add/kiiaghlmeikbpmeabhilfphikfcefljn","_blank");return}else if(n==="Firefox"){window.open("https://addons.mozilla.org/en-US/firefox/addon/wikibuy-for-firefox/","_blank");return}window.open("https://chromewebstore.google.com/detail/capital-one-shopping-save/nenlahapcbofgnanklpelkaejcehkggg/reviews?hl=en-US","_blank")}this.props.onClosePopup("rate capital one shopping")}},Ei=Di;var _l=r(T()),Bs=r(T()),Fi=r(Z());var M=r(b()),Mi=class extends Bs.Component{constructor(...t){super(...t),this.state={}}render(){let{runTimeSeconds:t,couponCount:e,savings:i,reward:o,workingCoupons:n,postCoupons:a,isBonkersSavings:p,onClosePopup:l,hasDeferredCouponRewards:d}=this.props,m=l?l.bind(this):null,f=o&&o.amount&&!a&&!d,g=$(A()),h=u("ext_red_cta_202305")&&!g;return(0,M.jsxs)("div",{className:`savings-wrapper ${o.categories?"has-categories":""}`,children:[(0,M.jsxs)("div",{className:`coupon-count ${f?"":"no-reward"}`,children:[this.props.requiresInput||p?(0,M.jsx)("h2",{children:"Code Entered"}):(0,M.jsxs)("h2",{className:u("ext_coupons_streamlined_click")?"center":void 0,children:["You saved ",(0,M.jsx)("span",{className:"palmetto",children:i})]}),n.length?(0,M.jsxs)("h6",{className:"bold center",children:[n.length," ",n.length===1?" code ":" codes "," worked in"," ",t," sec."]}):(0,M.jsxs)("h6",{className:"bold center",children:[u("coup_fo_202403_test")?"A variety of codes":`${e} ${e===1?"code":"codes"}`," ","tested in ",t," sec."]})]}),f||n.length?(0,M.jsxs)("div",{className:"center-content",children:[(0,M.jsx)("div",{className:`flex-center savings-breakdown ${f?"reward":""} ${this.props.hideBorder?"hide-border":""}`,children:(0,M.jsx)("div",{className:"code-scroll-container",children:this.renderWorkingCodes(n)})}),f&&!o.categories&&this.props.requiresInput?(0,M.jsxs)("div",{className:"activation-amount",children:[(0,M.jsxs)("h3",{className:"silver",children:[(0,M.jsx)("span",{className:"palmetto bold",children:o.type==="percentage"?`+${o.amount/100}%`:H(o.amount,{currency:o.currency})})," ",(0,M.jsx)("span",{className:"antialiased",children:"Shopping Rewards"})]}),Fi.default.get(this.props,"exclusions")?(0,M.jsx)(zt,{style:{height:"19px",marginTop:"1px",display:"flex",alignItems:"center",justifyContent:"center"},onDetailsClick:this.onShowExclusion.bind(this)}):null]}):null]}):null,m?(0,M.jsx)("div",{className:`dismiss-notif ${f&&!o.categories&&this.props.requiresInput?"code-entered-cashback":""}`,children:(0,M.jsx)("button",{className:`primary-btn-large ${h?"red-btn-test":"brand"}`,onClick:m,children:"Continue to Checkout"})}):null]})}onShowExclusion(){y("trackClick","viewExclusionDetails","view details"),window.open(`${st}/s/${this.props.tld}/coupon`,"_blank")}renderWorkingCodes(t){return Fi.default.map(t,(e,i)=>{let o=this.state.copied===e.code;return(0,M.jsx)("div",{onClick:this.onClickCopy.bind(this,e.code),style:{animationDelay:`${(i+1)*50}ms`},className:`coupon-list-item-container ${o?"copied":""}`,children:(0,M.jsxs)("h4",{className:"code midnight bold",children:[o?(0,M.jsx)("span",{className:"copied-text",children:"COPIED"}):e.code,(0,M.jsx)("span",{className:"hidden",children:e.code})]})},i)})}onClickCopy(t){let e=J();bt(t),this.setState({copied:t},()=>{this.timeoutId=setTimeout(()=>{this.setState({copied:!1})},1e3)}),y("trackClick","copyCouponCode","code",{clickId:e})}},Oi=Mi;var Dt=r(b()),zn=s=>(0,Dt.jsx)("div",{className:"try-codes-wrapper",style:{textAlign:"center"},children:(0,Dt.jsxs)("div",{children:[(0,Dt.jsx)("h2",{children:"Trying Coupon Codes"}),(0,Dt.jsx)("h5",{className:"silver",children:"Capital One Shopping automatically tries codes to save you money."}),s.renderProgressRunning(),(0,Dt.jsx)("div",{className:"streamlined",children:s.renderProgressBar()})]})}),$i=zn;var yt=r(T()),zi=r(Z());var Us=r(T()),Li=r(b()),De=class extends Us.default.Component{constructor(...t){super(...t),this.state={progress:0,end:0}}componentWillMount(){let t=this.props.coupons.length||0,e,i;this.props.currentCodeIndex===-1?(e=0,i=1/t*100):(i=(this.props.currentCodeIndex+1)/t*100,this.props.currentCodeIndex===0?e=15:e=this.props.currentCodeIndex/t*100),e>this.state.progress&&(this.setState({progress:Math.round(e)}),this.setState({end:Math.round(i)}),this.initInterval())}componentWillUnmount(){clearInterval(this.intervalId)}componentWillReceiveProps(t){if(!this.props.complete&&t&&t.complete)clearInterval(this.intervalId),this.setState({progress:100});else if(!this.props.complete&&t&&t.currentCodeIndex){if(clearInterval(this.intervalId),this.props.coupons.length){let e=t.currentCodeIndex/this.props.coupons.length*100;if(e>this.state.progress){let i=(t.currentCodeIndex+1)/this.props.coupons.length*100;this.setState({progress:Math.round(e)}),this.setState({end:Math.round(i)})}}this.initInterval()}}initInterval(){let t=Math.round(this.props.runTimePerCoupon*this.props.coupons.length/100);this.intervalId=setInterval(()=>{this.state.progress<this.state.end?this.setState({progress:this.state.progress+1}):clearInterval(this.intervalId)},t)}render(){return(0,Li.jsx)("div",{className:this.props.rounded?"rounded progress-bar":"progress-bar",children:(0,Li.jsx)("div",{className:"progress",style:{width:`${Math.min(this.state.progress||10,100)}%`}})})}};De.defaultProps={estimatedDuration:3e3};var Bi=De;var te=r(T());function Ui(s,t,e=!0){let i=(0,te.useRef)();(0,te.useEffect)(()=>{i.current=s},[s]),(0,te.useEffect)(()=>{function o(){i.current?.()}if(e){let n=window.setTimeout(o,t);return()=>window.clearTimeout(n)}},[t,e])}var et=r(b()),Wn=s=>{let{currentCodeIndex:t,coupons:e}=s,i="Finding great deals...",[o,n]=(0,yt.useState)(i),[a,p]=(0,yt.useState)(0),[l,d]=(0,yt.useState)(0),[m,f]=(0,yt.useState)(0);return(0,yt.useEffect)(()=>(d(Date.now()),()=>{d(0),f(0)}),[]),Ui(()=>{let g=(Date.now()-l)/1e3;f(g)},4e3,l>0),(0,yt.useEffect)(()=>{if(t){if(t>1){let g=(Date.now()-l)/1e3;f(g)}p(t/e.length)}},[t]),(0,yt.useEffect)(()=>{e.length>1&&a<.8&&m>4&&n("Checking for savings..."),(a>=.8||e.length===1&&m>4)&&n("Wrapping up...")},[a,m]),(0,et.jsx)("h2",{children:o})},Vn=s=>{let{coupons:t,couponCount:e,currentCouponCode:i,roo:o}=s,n=(0,zi.default)(t).take(e).map((p,l)=>(p.success=!0,p)).value(),a;return o&&(a=zi.default.findIndex(n,p=>p.code===i),n.forEach((p,l)=>{p.success=l<a})),a},zs=({currentCodeIndexTigger:s,view:t}={})=>{let e=Vn(t);return s||e},Wi=s=>{let{estimatedRunTime:t,barIsComplete:e,coupons:i,currentCodeIndexTigger:o,pause:n,runTimePerCoupon:a,estimatedDuration:p,estimatedTimeLeft:l,resetProgressBarState:d,roo:m,view:f}=s,g=zs({currentCodeIndexTigger:o,view:f}),h=u("ext_coupons_streamlined_click")?"streamlined":"";return(0,et.jsx)("div",{className:`progress-bar ${h}`,children:m?(0,et.jsx)(Bi,{estimatedDuration:t,complete:e,currentCodeIndex:g,coupons:i,runTimePerCoupon:a}):(0,et.jsx)(Zo,{pause:n,estimatedDuration:p,complete:e,estimatedTimeLeft:l,resetProgressBarState:d})})},qn=s=>{let{couponCount:t,currentCodeIndexTigger:e,coupons:i,view:o}=s;if(!i)return null;let n=zs({currentCodeIndexTigger:e,view:o});return(0,et.jsx)("div",{className:"try-codes-wrapper",children:(0,et.jsxs)("div",{children:[(0,et.jsx)(Wn,{currentCodeIndex:n,coupons:i}),(0,et.jsx)("h5",{className:"silver",children:"Capital One Shopping automatically tries codes to save you money."}),(0,et.jsx)(Wi,{...s,currentCodeIndex:n}),n>-1?(0,et.jsx)("h5",{style:{textAlign:"center",marginTop:15},className:"bold",children:u("coup_fo_202403_test")?"Trying Codes":`Trying ${Math.min(n+1,t)} of ${t} Codes`}):(0,et.jsx)("h5",{style:{height:"20px"}})]})})},Vi=qn;var k=r(b()),Ws="_blocks_personalized_offers",qi=class extends Vs.Component{constructor(...t){super(...t),this.state={viewCodes:!1,estimatedTimeLeft:null,willEstimateDuration:!1,currentCodeIndexTigger:0,couponQtTigger:null,viewedInstallmentSurvey:!1,ctaColorClass:""},this.onInitTryCoupons=()=>{this.setState({willEstimateDuration:!0})},this.onEstimatedCouponDuration=({detail:e})=>{this.setState({estimatedTimeLeft:e.estimatedTimeLeft,currentCodeIndexTigger:e.currentCodeIndex,couponQtTigger:e.couponQt})}}async componentDidMount(){let[t,e]=await Promise.all([Ss(),this.checkCanShowBlocksOffers()]);document.addEventListener("__iv_init_try_coupons",this.onInitTryCoupons),document.addEventListener("__iv_estimated_coupon_try_duration",this.onEstimatedCouponDuration);let i=$(A()),o=u("ext_red_cta_202305")&&!i;this.setState({ctaColorClass:o?"red-btn-test":"",manufacturedSavingsThrottle:t,canShowBlocksOffers:e})}componentWillUnmount(){document.removeEventListener("__iv_init_try_coupons",this.onInitTryCoupons),document.removeEventListener("__iv_estimated_coupon_try_duration",this.onEstimatedCouponDuration)}resetProgressBarState(){this.setState({viewCodes:!1,estimatedTimeLeft:null,willEstimateDuration:!1,currentCodeIndexTigger:0,couponQtTigger:null,viewedInstallmentSurvey:!1})}async checkCanShowBlocksOffers(){if(!u("ext_show_blocks_offers"))return!1;let t=1e3*60*60*24*30;return!await fo(t,Ws)}selectDisplayableCouponsAndCount(){let t=qt(_.get("couponView")),e=_.get("couponNotif")==="siteHub",i=t.couponCount,o=t.coupons,n=B.default.get(t,"autoFallback.autoFallbackCouponsCount");return n&&Rt({autoFallbackCouponsCount:n})&&!e&&(i=n,o=B.default.get(t,"autoFallback.coupons")),this.props.manuallyActivatedAutoRun&&(i=t.automaticCoupons&&t.automaticCoupons.length,o=t.automaticCoupons,!i&&t.result&&(i=t.result.coupons&&t.result.coupons.length,o=t.result.coupons)),t.manuallyActivatedAutoRun&&(i=t.automaticCoupons&&t.automaticCoupons.length,!i&&t.result&&(i=t.result.coupons&&t.result.coupons.length)),{couponCount:i,coupons:o}}determineCouponCount(){let{couponCount:t}=this.selectDisplayableCouponsAndCount();return t}getCurrentIndexRoo(){let{coupons:t,couponCount:e,currentCouponCode:i,roo:o}=this.props.view,n=(0,B.default)(t).take(e).map((p,l)=>(p.success=!0,p)).value(),a;return o&&(a=B.default.findIndex(n,p=>p.code===i),n=B.default.map(n,(p,l)=>(l<a?p.success=!0:p.success=!1,p))),a}determineManufacturedSavings(t,e){return u("ext_manufactured_savings")&&!u("ext_coupons_streamlined_click")&&t&&e&&!this.state.manufacturedSavingsThrottle}renderProgressRunning(){let{pause:t,barComplete:e}=this.props;this.props.clearCloseModalTimeout();let i=qt(_.get("couponView")),{currentCodeIndexTigger:o,couponQtTigger:n,estimatedTimeLeft:a}=this.state,p=this.state.willEstimateDuration?8e4:i.estimatedRunTime,{couponCount:l,coupons:d}=this.selectDisplayableCouponsAndCount(),m={pause:t,estimatedRunTime:i.estimatedRunTime,estimatedDuration:p,estimatedTimeLeft:a,barIsComplete:e,view:i,currentCodeIndexTigger:o,couponCount:l,resetProgressBarState:this.resetProgressBarState.bind(this),roo:i.roo,coupons:d,runTimePerCoupon:i.runTimePerCoupon,couponQtTigger:n};return u("ext_coupons_streamlined_click")?(0,k.jsx)(Wi,{...m}):(0,k.jsx)(Vi,{...m})}renderLeft(){let{running:t,barComplete:e,reward:i,postCoupons:o,pause:n,vendor:a,payoutProcessingPeriod:p,creditsActivated:l,activatingCredits:d,activateRewardsOnly:m,onShowExclusion:f,view:g}=this.props,{result:h,couponCount:w,roo:x}=g,R=B.default.get(h,"pageReload"),C=B.default.filter(B.default.get(h,"coupons"),xt=>xt.savings>0||xt.generatedFreeGift||xt.generatedFreeShipping),S=h&&h.savings&&h.savings>0?H(Math.trunc(h.savings)):0,F=B.default.get(h,"savings")>1e6||typeof S=="string"&&Wt(S)>1e6,N=B.default.get(h,"bestCoupon.code"),D=(B.default.get(h,"runTime",0)/1e3).toFixed(2),I=e&&!n,O=t||R||I,W=h&&(!N||!S)&&!t,U=!I&&!t&&h&&!n,Y=h&&h.requiresInput,q=this.props.exclusions,lt=this.props.tld,it=i&&i.amount&&!o&&!g.hasDeferredCouponRewards,ht=!O&&!n&&!t&&!h&&it&&this.props.eligibleForNewUserBonus,ot=(!u("ext_coupons_streamlined_click")||!h)&&(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(jo,{domain:this.props.domain,onTryCodes:this.props.onTryCodes.bind(this),onClosePopup:this.props.onClosePopup.bind(this),renderViewCodes:this.renderViewCodes.bind(this),renderPostResultCtaInUi:U,loading:this.props.ctaLoading,settings:this.props.settings,roo:x,hideExclusions:this.props.fullPageModal&&this.props.fullPageModal.length>0,creditsActivated:l,activatingCredits:d,activateRewardsOnly:m,exclusions:q,onShowExclusion:f,running:t,result:h,couponCount:w,pageReload:R,savings:S,reward:i,showReward:it}),ht&&(0,k.jsxs)("div",{className:"new-user-bonus",children:["Get an ",(0,k.jsx)("span",{className:"bold",children:"additional $10 in Shopping Rewards"})," today with a qualifying purchase of $25."," ",(0,k.jsx)("span",{className:"primary-link",onClick:this.onShowNewUserDetails.bind(this),children:"Details"})]})]}),Et=this.determineManufacturedSavings(U,g.hasDeferredCouponRewards);return(0,k.jsx)("div",{className:"left",children:(0,k.jsxs)("div",{className:`result-column ${B.default.get(this.props.googleData,"contacts.length")?"has-contacts":""}`,children:[O||n?this.renderProgressRunning():!t&&!h||t||R||I?(0,k.jsx)("div",{children:(0,k.jsxs)("div",{className:"found-codes",children:[(0,k.jsx)(Bt,{domain:A()}),d?(0,k.jsxs)("h2",{children:["Activating ",i.categories?"up to ":"",(0,k.jsx)("span",{className:"palmetto",children:i.type==="percentage"?`${i.amount/100}%`:H(i.amount,{currency:i.currency})})," ","back"]}):(0,k.jsx)(be,{couponCount:w,showReward:it,reward:i})]})}):W?Et?(0,k.jsx)(Ri,{}):!g.hasDeferredCouponRewards&&(i.categories||i.tiers)&&!Y?(0,k.jsx)(Ke,{reward:i,payoutProcessingPeriod:p,exclusions:q,tld:lt,showDismiss:!0,noSavingsAvailable:!0,vendor:a,couponCount:this.determineCouponCount(),onClosePopup:this.props.onClosePopup.bind(this),onTryCodes:this.props.onTryCodes.bind(this),ctaColorClass:this.state.ctaColorClass,view:this.props.view}):(0,k.jsx)(Ni,{exclusions:q,tld:lt,runTimeSeconds:D,roo:x,reward:i,postCoupons:o,requiresInput:Y,workingCoupons:C,vendor:a,couponCount:this.determineCouponCount(),closeModalTimeout:this.props.closeModalTimeout.bind(this),manuallyActivatedAutoRun:this.props.manuallyActivatedAutoRun,codes:B.default.get(h,"coupons"),onClosePopup:this.props.onClosePopup.bind(this),onTryCodes:this.props.onTryCodes.bind(this),view:this.props.view}):(0,k.jsx)(Oi,{activateRewardsOnly:m,exclusions:q,tld:lt,runTimeSeconds:D,couponCount:w,savings:S,reward:i,postCoupons:o,workingCoupons:C,requiresInput:Y,isBonkersSavings:F,hideBorder:i.categories,onClosePopup:this.props.onClosePopup.bind(this),hasDeferredCouponRewards:g.hasDeferredCouponRewards}),ot]})})}renderProgressBar(){let{view:t,autoFallback:e}=this.props,{result:i,pageWasReloaded:o,estimatedRunTime:n,runTimePerCoupon:a,roo:p}=this.props.view,l=$(A()),d=t.couponCount,m=t.coupons;this.props.manuallyActivatedAutoRun&&(d=t.automaticCoupons&&t.automaticCoupons.length,m=t.automaticCoupons,!d&&t.result&&(d=t.result.coupons&&t.result.coupons.length,m=t.result.coupons)),u("coupon_non_rerun")&&!l&&e&&t.autoFallback&&(d=B.default.get(t,"autoFallback.autoFallbackCouponsCount",d),m=B.default.get(t,"autoFallback.coupons",m));let{running:f,barComplete:g,pause:h}=this.props,w=this.props.getRunAnimation(this.state.willEstimateDuration),x=(0,B.default)(m).take(d).map((N,D)=>(N.success=!0,N)).value(),R=this.getCurrentIndexRoo(),C=B.default.get(i,"pageReload");return f||C||g&&!h||h?(0,k.jsx)("div",{className:"run-codes",children:(0,k.jsx)(Jt,{pause:h,runTimePerCoupon:a,currentCodeIndex:R,estimatedRunTime:n,roo:p,disableChecks:!0,show:f||i,result:i,running:f,coupons:x,stagger:o?0:w.stagger,collapsable:!0})}):null}renderRightComponent(){let{activateRewardsOnly:t,view:e}=this.props,{result:i}=e,{running:o,barComplete:n,reward:a,postCoupons:p,pause:l,payoutProcessingPeriod:d}=this.props,m=i&&i.savings&&i.savings>0?H(Math.trunc(i.savings)):0,f=B.default.get(i,"bestCoupon.code"),g=n&&!l,h=i&&(!f||!m)&&!o,w=!g&&!o&&i&&!l,x=i&&i.requiresInput,R=this.props.exclusions,C=this.props.tld,S=u("il_survey_split")||u("il_survey_no_apr")||u("il_survey_apr"),F=!u("show_rewards")&&!u("show_price_comparison");return w&&!this.props.reportAProblem&&S&&!this.state.viewedInstallmentSurvey?(0,k.jsx)(xi,{dismiss:this.dismissInstallmentSurvey}):this.determineManufacturedSavings(w,e.hasDeferredCouponRewards)&&h&&!this.props.reportAProblem?(0,k.jsx)(bi,{payoutProcessingPeriod:d,onClosePopup:this.props.onClosePopup.bind(this)}):w&&e.hasDeferredCouponRewards&&h&&a&&a.amount&&!this.props.reportAProblem?(0,k.jsx)(vi,{reward:a,payoutProcessingPeriod:d,exclusions:R,tld:C,activateRewardsOnly:t}):u("ext_coupons_streamlined_click")?null:w&&(a.categories||a.tiers)&&h&&!F&&!this.props.reportAProblem?(0,k.jsxs)("div",{className:"w-full px-6",children:[(0,k.jsx)($t,{displayInModal:!0,reward:a,tld:C,center:!0,onClosePopup:this.props.onClosePopup.bind(this)}),(0,k.jsx)(Ut,{reward:a})]}):!e.hasDeferredCouponRewards&&(h&&!a.categories||!h)&&a&&a.amount&&w&&!this.props.reportAProblem&&!x?(0,k.jsx)(Ke,{postCoupons:p,reward:a,payoutProcessingPeriod:d,exclusions:R,tld:C,onTryCodes:this.props.onTryCodes.bind(this),ctaColorClass:this.state.ctaColorClass,view:this.props.view}):this.props.reportAProblem?(0,k.jsx)(Ho,{email:this.props.email,onClosePopup:this.props.onClosePopup.bind(this),forceReportCoupon:this.props.forceReportCoupon,toggleReportAProblem:this.props.toggleReportAProblem}):w?this.state.canShowBlocksOffers?(_o(Ws),(0,k.jsx)(Ae,{})):B.default.get(this.props.storeContentApiData,"items.length")?(0,k.jsx)(gi,{data:this.props.storeContentApiData}):(0,k.jsx)(Ei,{onClosePopup:this.props.onClosePopup.bind(this),savings:B.default.get(this.props,"view.savings",0)}):null}renderRight(){let{running:t,barComplete:e,pause:i,view:o}=this.props,{result:n}=o,p=!(e&&!i)&&!t&&n&&!i,l=this.determineManufacturedSavings(p,o.hasDeferredCouponRewards);return this.props.hideRight?null:(0,k.jsxs)("div",{className:"right",style:u("ext_coupons_streamlined_click")?{display:"block"}:l?{backgroundColor:"#F7FCFF"}:void 0,children:[this.renderProgressBar(),this.renderRightComponent()]})}renderLayout(){return(0,k.jsxs)("div",{className:"base",children:[this.renderLeft(),this.renderRight()]})}render(){let{view:t}=this.props;return(0,k.jsx)("div",{className:`render-result-layout ${t.hasDeferredCouponRewards?"activate-rewards":""} ${this.state.canShowBlocksOffers?"blocks-offers-container":""}`,children:(this.props.running||this.props.barComplete)&&u("ext_coupons_streamlined_click")?(0,k.jsx)($i,{renderProgressBar:this.renderProgressBar.bind(this),renderProgressRunning:this.renderProgressRunning.bind(this)}):this.renderLayout()})}renderViewCodes(){let{coupons:t,result:e,couponCount:i}=this.props.view,o=e?t.slice(i,t.length):t;return o&&o.length>0?(0,k.jsxs)("div",{children:[(0,k.jsx)("h4",{className:"bold",style:{marginBottom:"8px",marginTop:"8px",textAlign:"center"},children:(0,k.jsx)("span",{className:"tertiary-link",onClick:this.onClickViewCode.bind(this),children:this.state.viewCodes?"hide codes":"view codes"})}),(0,k.jsx)(Vt,{running:this.props.running,show:!!this.state.viewCodes,coupons:o,collapsable:!0,result:e,disableChecks:!0})]}):null}onClickViewCode(){y("trackClick","toggleCodes",this.state.viewCodes?"hide codes":"view codes"),this.state.viewCodes||_e(),this.setState({viewCodes:!this.state.viewCodes})}onShowNewUserDetails(){y("trackClick","viewNewUserBonusDetails","Details",{view:"cashbackNotificiation"}),window.open("https://help.capitaloneshopping.com/hc/en-us/articles/360047681572-How-do-I-earn-a-New-Member-Bonus-of-10-in-Wikibuy-Credits-on-my-first-purchase-","_blank")}dismissInstallmentSurvey=()=>{setTimeout(()=>{this.setState({viewedInstallmentSurvey:!0})},4e3)}},Hi=qi;var G=r(b()),Gn="coupons",Gi=class extends Ee.Component{constructor(...t){super(...t),this.state={hideNotification:!0,isThrottled:!1,viewCodes:!1,running:this.props.view.rooRunning,rooRunning:this.props.view.rooRunning,didTryCodes:this.props.view.rooRunning||this.props.view.pageWasReloaded||!1,result:this.props.view.result,roo:this.props.view.roo,showThrottleToolTip:this.props.view.showThrottleToolTip,settings:this.props.settings,ctaLoading:!1,autoFallback:c.default.get(this.props,"affiliateRedirect.autoFallback.autoFallback"),automaticCouponsEnabled:Po(),manuallyActivatedAutoRun:this.props.view.manuallyActivatedAutoRun||!1,scriptType:c.default.get(_.get("siteAPIData"),"siteData.coupons.type"),showDismissConfirmation:!1,dismissConfirmationDisplayed:!1},this.activateCreditsAfterAutomatic=this.activateCreditsAfterAutomatic.bind(this),this.activateRewardsOnly=this.activateRewardsOnly.bind(this),this.isRewardSite=this.isRewardSite.bind(this),this.boundCloseModal=this.closeModalOnClickOutside.bind(this),this.determineIfCouponsNotifiedImmediately=this.determineIfCouponsNotifiedImmediately.bind(this)}async getContentAPiData(){let t=await ao();this.setState({storeContentApiData:t})}onDismissConfirmationPageLoad(){this.setState({dismissConfirmationDisplayed:!0})}async componentWillMount(){let t=!this.state.disableAutomatic&&this.state.automaticCouponsEnabled&&!this.state.manuallyActivatedAutoRun,e=wt()&&t;e&&!this.state.result&&this.sendCouponNotificationEvent({runAutomatically:t,notifyImmediate:e});let i=_.get("siteAPIData"),n=c.default.get(i,"siteData.coupons.type")==="eeyore"&&ft();localStorage.getItem("__wb_redirecting")?(n||(localStorage.removeItem("__wb_redirecting"),await _t("affiliateRedirect")&&(await nt("affiliateRedirect"),_.unset("affiliateRedirect")),this.setState({redirectInCurrentTab:!1},()=>{let a={manuallyActivatedSameTabReload:this.state.manuallyActivatedAutoRun};this.onTryCodes({disableCookieDrop:!0,config:a})})),await _t("manuallyActivatedAutoRun")&&this.setState({manuallyActivatedAutoRun:!0})):(c.default.get(this.props,"view.affiliateLinkCurrentTab")||ft())&&this.setState({redirectInCurrentTab:!0})}async componentDidMount(){this.getContentAPiData(),this.isAutoFallback(),_t("manuallyActivatedAutoRun").then(n=>{n&&(this.setState({manuallyActivatedAutoRun:!0}),this.setAutomaticCouponCursor(),_.select("couponView").set("manuallyActivatedAutoRun",!0),this.state.result&&nt("manuallyActivatedAutoRun"))}),await this.determineIfCouponsNotifiedImmediately(),await this.checkThrottledForAutoCoup(),this.checkForCompetitorNotifs(),To(this.setState.bind(this));let t=!!c.default.get(this.props,"cashbackView.reward.amount");Ct()&&this.state.result&&!this.state.automaticCouponsEnabled&&_.select("couponView").set("isQuietSavingsMiss",!1),this.state.autoFallback&&this.couponsNonRerun(),Ct()&&!this.state.automaticCouponsEnabled&&!this.state.didTryCodes&&!this.state.running&&!this.preparingToRun&&!this.state.result&&!_.get("cashbackVisible")&&(t&&Mo({isFromNonAutoRun:!0}),this.setState({hideNotification:!0})),this.props.view.shouldTryCoupons&&!this.state.didTryCodes&&!this.state.running&&!this.preparingToRun&&(this.preparingToRun=!0,this.setState({hideNotification:!1,didTryCodes:!1,result:null,running:!0,barComplete:!1},()=>{this.onTryCodes({ignoreCancelled:!0,disableAutomatic:!1,disableCookieDrop:!1}),this.preparingToRun=!1}));let e=c.default.get(this.props,"view.affiliateLinkCurrentTab")&&this.state.manuallyActivatedAutoRun,i=_.get("couponNotif")==="siteHub",o=this.state.automaticCouponsEnabled&&!this.state.manuallyActivatedAutoRun||!this.state.disableAutomatic&&this.state.automaticCouponsEnabled;o&&this.state.result?this.sendCouponNotificationEvent({runAutomatically:o,isSiteHub:i}):!o&&!e&&this.sendCouponNotificationEvent({runAutomatically:o,isSiteHub:i})}async componentDidUpdate(t,e){if(this.isRewardSite()&&t.warnAboutStandDown!==this.props.warnAboutStandDown&&this.props.warnAboutStandDown&&!_.get("throttleCreditsReactivation")){let o=await io();_.merge({cashback:o}),to(Gn),So("reactivate")}if(this.props.affiliateRedirect!==t.affiliateRedirect&&this.isAutoFallback(),this.state.autoFallback!==e.autoFallback&&this.couponsNonRerun(),this.state.result!==e.result){this.isAutoFallback();let o,n=_.get("couponNotif")==="siteHub",a=!this.state.manuallyActivatedAutoRun&&this.state.automaticCouponsEnabled||!this.state.disableAutomatic&&this.state.automaticCouponsEnabled;this.state.result&&!this.state.manuallyActivatedAutoRun&&(o=this.state.result.autoFallback),n&&!o&&_.get(["couponView","autoFallback"])&&_.unset(["couponView","autoFallback"]),a||o?this.sendCouponNotificationEvent({runAutomatically:a,isSiteHub:n}):a||(this.sendCouponNotificationEvent({runAutomatically:a,isSiteHub:n}),this.state.result&&n&&(_.unset("couponNotif"),n=!1))}}componentWillReceiveProps(t){if((!this.preparingToRun&&!this.state.running&&!this.state.didTryCodes&&t.view.shouldTryCoupons&&!this.props.view.shouldTryCoupons||this.state.didTryCodes&&t.view.forceTryCoupons&&!this.props.view.forceTryCoupons)&&(this.preparingToRun=!0,this.setState({hideNotification:!1,didTryCodes:!1,result:null,running:!0,barComplete:!1,roo:t.view.roo,automaticCouponsEnabled:!1},()=>{this.onTryCodes({ignoreCancelled:!0}),this.preparingToRun=!1}),t.view.forceTryCoupons))return;let e={};this.state.rooRunning&&this.props.view.rooRunning&&!t.view.rooRunning&&(e.running=!1,e.rooRunning=!1),!this.props.view.shouldDismissTooltip&&t.view.shouldDismissTooltip&&!this.state.running&&!this.state.result&&this.onDismissTooltip(),t.view.result&&(e.result=t.view.result),t.view.roo&&(e.roo=t.view.roo),c.default.has(t,"view.showThrottleToolTip")&&(e.showThrottleToolTip=t.view.showThrottleToolTip),c.default.has(t,"view.hideThrottleToolTip")&&(e.hideThrottleToolTip=t.view.hideThrottleToolTip),this.setState(e),c.default.has(t,"shouldHidePrompt")&&t.shouldHidePrompt===!0&&!t.shouldShowSPAPrompt&&!this.state.hideNotification&&!this.state.running&&!this.state.results&&(_.unset("shouldHidePrompt"),this.setState({hideNotification:!0}),y("track","hideSPAPrompt",{currentLocation:c.default.pick(window.location,["hash","host","hostname","href","origin","pathname","port","search"])})),c.default.has(t,"shouldShowSPAPrompt")&&t.shouldShowSPAPrompt===!0&&this.state.hideNotification&&!this.state.running&&!this.state.result&&(_.unset("shouldShowSPAPrompt"),this.setState({hideNotification:!1}),y("track","showSPAPrompt",{currentLocation:c.default.pick(window.location,["hash","host","hostname","href","origin","pathname","port","search"])}))}async determineIfCouponsNotifiedImmediately(){let t=await _t("couponNotifiedImmediately");return t&&(this.state.disableAutomatic||this.setState({couponsHasNotifiedInitially:!0}),this.state.result&&nt("couponNotifiedImmediately")),t}couponsNonRerun(){let{autoFallbackCouponsCount:t}=this.determineCouponTryCount();this.setState({couponsNonRerunCreditNotif:!0});let e=$o(),i=this.isRewardSite(),o=$(A());if(!(u("coupon_non_rerun")&&u("coupon_selective_non_rerun")&&t<=0&&!c.default.get(this.state,"result.errored"))&&u("coupon_non_rerun")&&!o&&t<=0&&!c.default.get(this.state,"result.errored")&&!this.state.couponsNonRerunCreditNotif){if(e&&!i)return;_.set("couponsVisible",!1),this.setState({hideNotification:!0,isThrottled:!0}),Ht(),i&&Oo()}}isAutoFallback(){if(c.default.get(this.state,"automaticCouponsEnabled")&&this.state.result&&c.default.get(this.state.result,"automaticCouponsRun"))return this.setState({autoFallback:!0}),!0;this.props.affiliateRedirect&&c.default.get(this.props,"affiliateRedirect.autoFallback.autoFallback")&&this.setState({autoFallback:!0})}async checkThrottledForAutoCoup(){if(this.state.automaticCouponsEnabled&&wt()){let t=await eo({domain:A(),message:"isThrottled",fromAutoCoupImmediateNotif:!0});if(t){let{isThrottled:e,fromAutoCoupImmediateNotif:i}=t;i&&e&&this.setState({hideNotification:!0,didTryCodes:!0,isThrottled:!0})}}}async checkForCompetitorNotifs(){this.state.isThrottled||this.setState({hideNotification:!1});let t=200,e=1;for(;t<7e3;){let i=document.querySelector("#honeyContainer"),o=document.querySelector("#piggyWrapper");if(i){let n=i.shadowRoot.querySelector("#honey-shadow").style;i.shadowRoot.querySelector("#cornerContent")&&(n.opacity==="1"||n.visibility==="visible")&&(this.setState({compNotifLoaded:!0,rightOffset:"310px"}),this.setState({compNotifLoaded:!0,rightOffset:"455px"}))}if(o&&(o.offsetWidth>0||o.offsetHeight>0)&&this.setState({compNotifLoaded:!0,rightOffset:"340px"}),(document.querySelector(".ebates-notification")||document.querySelector(".ebates-hover.ebates-hover-top"))&&this.setState({compNotifLoaded:!0,rightOffset:"420px"}),await ze(t),e>25&&(t*=1.5),(this.state.running||this.state.results)&&!this.state.automaticCouponsEnabled)break;e+=1}}async manuallyActivateAutocoupRun({clickId:t,couponRunId:e}={}){this.setState({manuallyActivatedAutoRun:!0,disableAutomatic:!0}),_.select("couponView").set("manuallyActivatedAutoRun",!0),sessionStorage.removeItem("__cos_coupon_run_id"),this.state.rooRunning&&sessionStorage.setItem("__r_reload_auto",JSON.stringify({reload:!0,manuallyActivatedAutoRun:!0}));let o=c.default.get(this.props,"cashbackView.reward")?c.default.get(this.props,"cashbackView.reward"):!1,n=c.default.get(this.props.cashbackView,"postCoupons"),a=!1;o&&o.amount&&!n&&(a=!0),await this.determineShouldRespectSameTab()&&(ft()||this.state.redirectInCurrentTab)&&(a||!this.props.view.disableAffiliate)&&await me(a,{couponRunId:e,clickId:t,fromAutoRun:!1,manuallyActivatedAutoRun:!0})}isRewardSite(){return!!c.default.get(this.props,"cashbackView.reward")}onShowExclusion(){y("trackClick","viewExclusionDetails","view details"),window.open(`${st}/s/${this.props.tld}/coupon`,"_blank")}isResultWithSavings(){let{result:t,running:e}=this.state;if(t){let i=t.savings&&t.savings>0?H(Math.trunc(t.savings)):0,o=t.requiresInput;return!((!c.default.get(t,"bestCoupon.code")||!i)&&!e&&!o)}return null}trackFirstDragEnd=c.default.once((t,e)=>{go("couponNotification",t,e)});render(){let{roo:t,reportAProblem:e,forceReportCoupon:i}=this.state,{hideNotification:o}=this.state,n=!this.state.running&&!this.props.view.result,a=this.props.view.noScript,p=!!c.default.get(this.props,"cashbackView.reward.amount"),l=c.default.get(this.props,"vendorName",this.props.tld),d=c.default.get(this.props,"cashbackView.payoutProcessingPeriod",{}),m=$(A()),f=!!(this.state.manuallyActivatedAutoRun||this.shouldShowFullPage()),g=f?"full-page":"",h=m&&(this.state.running||c.default.get(this.state.result,"pageReload")||this.state.barComplete)&&c.default.get(this.props.deweyResult,"pageType")!=="checkoutPage",w=n||h||this.state.running===!1&&u("ext_coupons_streamlined_click")?"hide-right":"",x=u("ext_coupons_streamlined_click")&&this.state.running?"streamlined-running":"",R=this.isRewardSite()?c.default.get(this.props,"cashbackView.reward"):!1,C=!this.state.disableAutomatic&&this.state.automaticCouponsEnabled&&!this.state.manuallyActivatedAutoRun,S=!!(this.state.couponsHasNotifiedInitially&&C),{running:F,result:N,pageReload:D}=this.state;if(!wt()&&C&&(!F&&!N||F||D||m&&N.savings<=0&&!N.requiresInput||Ct()&&(N.savings<=0||!N.savings))&&(o=!0),wt()&&C&&Ct()&&N&&(N.savings<=0||!N.savings)&&(o=!0),je(this.state))return null;let O=mo(this.state.compNotifLoaded),W=qt(this.props.view),U=this.state.showDismissConfirmation?null:(0,G.jsx)(qo,{fullPageModal:g,determineIfCouponsNotifiedImmediately:this.determineIfCouponsNotifiedImmediately.bind(this),noScript:a,onClosePopup:this.onClosePopup.bind(this),reportAProblem:({forceCoupon:q}={})=>{this.clearCloseModalTimeout(),this.setState({reportAProblem:!this.state.reportAProblem,forceReportCoupon:q&&!this.state.reportAProblem})},reportAProblemOpen:this.state.reportAProblem,roo:t,runAutomatically:C,running:this.state.running,view:W,isRewardSite:this.isRewardSite()}),Y=(0,G.jsx)(Ee.default.Fragment,{children:(0,G.jsx)("section",{className:"result-section-wrapper",children:a?(0,G.jsx)(li,{view:W,reward:R,isCashback:p,postCoupons:c.default.get(this.props,"cashbackView.postCoupons"),eligibleForNewUserBonus:this.props.settings.eligibleForNewUserBonus,onShowExclusion:this.onShowExclusion.bind(this),exclusions:this.props.exclusions}):this.state.showDismissConfirmation?(0,G.jsx)("div",{children:(0,G.jsx)(ai,{reward:R,activateRewardsOnly:this.activateRewardsOnly,exclusions:this.props.exclusions,onShowExclusion:this.onShowExclusion.bind(this),onClosePopup:this.onClosePopup.bind(this),activatingCredits:this.state.activatingCredits,creditsActivated:this.state.creditsActivated,onLoad:this.onDismissConfirmationPageLoad.bind(this)})}):C?(0,G.jsx)("div",{children:(0,G.jsx)(ni,{activateRewardsOnly:this.activateRewardsOnly,activateCredits:this.activateCreditsAfterAutomatic,activatingCredits:this.state.activatingCredits,barComplete:this.state.barComplete,closeModalTimeout:this.closeModalTimeout.bind(this),creditsActivated:this.state.creditsActivated,ctaLoading:this.state.ctaLoading,deweyResult:this.props.deweyResult,didTryCodes:this.state.didTryCodes,domain:A(),eligibleForNewUserBonus:this.props.settings.eligibleForNewUserBonus,exclusions:this.props.exclusions,getRunAnimation:this.getRunAnimation.bind(this),isCashback:p,onClosePopup:this.onClosePopup.bind(this),onShowExclusion:this.onShowExclusion.bind(this),onTryCodes:this.onTryCodes.bind(this),manuallyActivateAutocoupRun:this.manuallyActivateAutocoupRun.bind(this),postCoupons:c.default.get(this.props,"cashbackView.postCoupons"),reportAProblem:e,reward:R,running:this.state.running,settings:this.props.settings,tld:this.props.tld,view:W})}):(0,G.jsx)(Hi,{activateRewardsOnly:this.activateRewardsOnly,activatingCredits:this.state.activatingCredits,autoFallback:this.state.autoFallback,barComplete:this.state.barComplete,clearCloseModalTimeout:this.clearCloseModalTimeout.bind(this),closeModalTimeout:this.closeModalTimeout.bind(this),couponResult:this.state.result,creditsActivated:this.state.creditsActivated,ctaLoading:this.state.ctaLoading,deweyResult:this.props.deweyResult,domain:A(),eligibleForNewUserBonus:this.props.settings.eligibleForNewUserBonus,email:c.default.get(this.props,"session.email"),exclusions:this.props.exclusions,forceReportCoupon:i,fullPageModal:g,getRunAnimation:this.getRunAnimation.bind(this),googleData:this.props.googleData,hideRight:h,isCashback:p,manuallyActivatedAutoRun:this.state.manuallyActivatedAutoRun,onClosePopup:this.onClosePopup.bind(this),onShowExclusion:this.onShowExclusion.bind(this),onTryCodes:this.onTryCodes.bind(this),payoutProcessingPeriod:d,postCoupons:c.default.get(this.props,"cashbackView.postCoupons"),reportAProblem:e,reward:R,running:this.state.running,session:this.props.session,settings:this.state.settings,shortCode:c.default.get(this.props,"session.short_code"),storeContentApiData:this.state.storeContentApiData,tld:this.props.tld,toggleReportAProblem:({forceCoupon:q}={})=>{this.setState({reportAProblem:!this.state.reportAProblem,forceReportCoupon:q&&!this.state.reportAProblem})},vendor:l,view:W})})});return this.state.showThrottleToolTip?(0,G.jsx)("div",{children:(0,G.jsx)(Fe.Motion,{style:{opacity:(0,Fe.spring)(this.state.hideThrottleToolTip?0:1,{stiffness:180,damping:20})},children:({opacity:q})=>(0,G.jsx)(Co,{tip:!0,tipLabel:"Capital One Shopping tip:",message:(0,G.jsx)("span",{children:'click the "S" above if you want to try codes again.'}),style:{top:"15px",bottom:"auto",width:"461px",left:"auto",right:"310px"},innerStyle:{opacity:`${q}`},onDismissTooltip:this.onDismissTooltip.bind(this)})})}):this.isResultWithSavings()===null||!Fo(!this.isResultWithSavings())?(0,G.jsx)(Xi,{onClick:q=>{this.boundCloseModal(q)},className:o?`disabled coupon-page ${w} ${this.state.resetNotification?g:""} ${C?"run-automatically":""}`:`coupon-page ${x} ${w} ${C?"run-automatically":""} ${g}`,style:{top:0,bottom:"auto",left:O.left??"auto",right:O.right??0,translate:!f&&O.translateX},dragSelector:"header",isDraggable:!f&&u("ext_notif_drag"),onDragEnd:this.trackFirstDragEnd,children:(0,G.jsxs)(Se,{hideNotification:o,shouldDisableCouponNotifAnimation:S,styles:{className:`coupon-notification ${!Mt()||m?"":"notification-min-height"} ${u("notif_rounded_border")?"rounded-notification":""}`},children:[U,Y]})}):null}shouldShowFullPage(){if(u("ext_coupons_streamlined_click")||!this.state.manuallyActivatedAutoRun&&!this.state.disableAutomatic&&this.state.automaticCouponsEnabled)return!1;let e=_.get("siteAPIData");return c.default.get(e,"siteData.coupons.type")==="eeyore"?!1:!this.state.barComplete&&!this.state.running&&c.default.get(this.state.result,"savings",0)>0&&(!this.state.qualified||this.state.qualified&&this.state.activated)||this.state.running||!!this.state.result||c.default.get(this.props.view,"forceTryCoupons")}onDismissTooltip({type:t}={}){this.state.tooltipDismissed||(this.setState({hideThrottleToolTip:!0}),this.setState({hideNotification:!0}),this.setState({tooltipDismissed:!0}),oo("hasSeenCouponsThrottleToolTip"))}dismissOrActivateRewardsOnlyCouponNotificationEvent({ctaText:t,label:e,runAutomatically:i,eventName:o,category:n,pageLocation:a,modalType:p,activateRewardsOnly:l=!1,fromActivateRewards:d=!1,fromAutoCoupImmediateNotif:m=!1}={}){let f=Math.trunc((performance.now()-window.__wb_timing.couponsRequireAt)/1e3),g=_.get(["siteAPIData","siteData","coupons","type"]);d||y("trackClick",o,e,{pageLocation:a,triggerType:i?"auto":null,savings:c.default.get(this,"props.view.result.savings"),bestCoupon:c.default.get(this,"props.view.result.bestCoupon.code"),coupons:c.default.get(this,"props.view.result.coupons"),ctaText:t,runDuration:c.default.get(this,"props.view.result.runTime"),dismissalTimeSeconds:f,category:n,engine:g,modalType:p}),n!=="auto"&&vt(i&&!m||d?"couponNotificationResult":"couponNotification",e,l?"cta":"dismiss",l?d?"primary":"secondary":"primary",{redirect:l,cashback:l,pageLocation:a,triggerType:i?"auto":null,savings:c.default.get(this,"props.view.result.savings"),bestCoupon:c.default.get(this,"props.view.result.bestCoupon.code"),coupons:c.default.get(this,"props.view.result.coupons"),runDuration:c.default.get(this,"props.view.result.runTime"),dismissalTimeSeconds:f,category:n,engine:g,modalType:p})}async showDismissConfirmationModal(){let t=this.state.scriptType==="eeyore",e=!1;return u("notif_areyousure_throttling")&&(e=await Wo("areyousure_throttling")),u("notif_areyousure_inplace")&&this.isRewardSite()&&!e&&!this.state.showDismissConfirmation&&!this.shouldShowFullPage()&&!this.state.showDismissConfirmation&&!this.state.creditsActivated&&!t}async onClosePopup(t,e={}){let{ctaText:i,fromTooltip:o,urlChange:n,fromAutoCoupImmediateNotif:a,autoDismissNotif:p,sameTab:l,pageLocation:d,skipEvent:m,shouldLoadCreateAccountNotification:f,willRedirect:g}=e;this.clearCloseModalTimeout();let h=await this.showDismissConfirmationModal(),w=!this.state.disableAutomatic&&this.state.automaticCouponsEnabled;if(l||this.setState({hideNotification:!h,resetNotification:!h,showDismissConfirmation:h},()=>{!h&&!g&&(!w&&this.state.didTryCodes||f)&&Ge(c.default.get(this.props,"cashbackView.reward",null)),this.timeout=setTimeout(()=>{this.setState({resetNotification:!1})},1e3)}),h&&!this.state.dismissConfirmationDisplayed)return;this.state.running&&(y("track","couponRunCancelled"),_.set(["coupons","runCancelled"],!0)),this.state.rooRunning&&Ze.cancel(),n||Ht(),w&&a&&Ht({fromAutoCoupImmediateNotif:a});let x=d==="couponDismissConfirmation";if(!m){if(this.state.running&&t==="x")return this.dismissOrActivateRewardsOnlyCouponNotificationEvent({ctaText:i,label:t,runAutomatically:w,eventName:"dismissCouponNotification",modalType:"runningModal",pageLocation:d,fromAutoCoupImmediateNotif:a});w&&p?this.dismissOrActivateRewardsOnlyCouponNotificationEvent({label:null,runAutomatically:w,eventName:"autoDismissCouponNotification",category:"auto",pageLocation:d,fromAutoCoupImmediateNotif:a}):(!this.state.didTryCodes||w&&(t==="x"||o||x))&&this.dismissOrActivateRewardsOnlyCouponNotificationEvent({ctaText:i,label:t,runAutomatically:w,eventName:"dismissCouponNotification",pageLocation:d,fromAutoCoupImmediateNotif:a})}}async determineShouldRespectSameTab(){if(!c.default.get(this.props,"view.affiliateLinkCurrentTab")&&!ft())return!1;let t=!0,e=c.default.get(this,"props.deweyResult.pageData.meta");return e&&c.default.has(e,"disable_aff_link_current_tab")&&(t=!1),t}determineCouponTryCount({disableAutomatic:t,autoFallback:e}={}){let i=this.props.affiliateRedirect,o=c.default.get(_.get("siteAPIData"),"siteData.coupons.type")==="roo",n=c.default.get(this,"props.view.autoCoupConfig.codeCount")||(o||Gt()?1:2),a=c.default.get(i,"autofallback.autoFallbackCouponsCount")||c.default.get(this,"props.view.couponCount")-n,p=null;return(!t&&this.state.automaticCouponsEnabled||this.state.manuallyActivatedAutoRun)&&(p=n),Rt({autoFallbackCouponsCount:a})&&(this.state.autoFallback||e)&&(p=a,this.setFallbackCouponCursor({autoFallbackCouponsCount:a})),{autoCoupTryCount:n,autoFallbackCouponsCount:a,couponTryCount:p}}setAutomaticCouponCursor(){let{autoCoupTryCount:t}=this.determineCouponTryCount(),e=_.select("couponView"),i=co(e.get("coupons"));e.set("automaticCoupons",c.default.take(i,t))}setFallbackCouponCursor({autoFallbackCouponsCount:t}){let e=_.select("couponView"),i=c.default.takeRight(e.get("coupons"),t);e.set("autoFallback",{coupons:i,autoFallbackCouponsCount:t})}couponsToTry(t={}){let e=_.select("couponView"),i=e.get("coupons"),{automaticCouponsRun:o,couponTryCount:n,autoFallbackCouponsCount:a}=t,p=o||this.state.manuallyActivatedAutoRun?c.default.take(e.get("coupons"),n):i;return a&&Rt({autoFallbackCouponsCount:a})&&this.state.autoFallback&&(p=c.default.takeRight(e.get("coupons"),a),this.setFallbackCouponCursor({autoFallbackCouponsCount:a,coupons:p})),o&&this.setAutomaticCouponCursor(),p}async onTryCodes({ignoreCancelled:t,disableAutomatic:e,disableCookieDrop:i,config:o={}}={}){Ft("onTryCodes",{ignoreCancelled:t,disableAutomatic:e,disableCookieDrop:i,config:o});let{fromAutoRun:n,manuallyActivatedFallback:a,manuallyActivatedSameTabReload:p}=o,{clickId:l,couponRunId:d,isFallbackRun:m}=o,f=_.get("couponNotif")==="siteHub",g=n&&!f,h=!!c.default.get(this.props,"cashbackView.reward.amount"),w=this.props.affiliateRedirect;w&&(g=c.default.get(w,"autoFallback.autoFallback",g)&&!f),this.setState({autoFallback:g}),d=d||sessionStorage.getItem("__wb_amz_coup_id")||c.default.get(w,"couponRunId")||Hs.default.v4(),l=l||sessionStorage.getItem("__wb_clickId")||J();let x=u("shopify_async_tigger")&&_.get("platform")==="Shopify",R=c.default.get(_.get("siteAPIData"),"siteData.coupons.type"),C=R==="roo",S=R==="asyncTigger"||x;(f&&this.state.manuallyActivatedAutoRun||m||a)&&(_.select("couponView").set("manuallyActivatedAutoRun",!1),this.setState({manuallyActivatedAutoRun:!1}));let{couponTryCount:F,autoFallbackCouponsCount:N}=this.determineCouponTryCount({disableAutomatic:e,autoFallback:g}),D=c.default.get(this.props,"cashbackView.reward")?c.default.get(this.props,"cashbackView.reward"):!1,I=c.default.get(this.props.cashbackView,"postCoupons"),O=!1;if(D&&D.amount&&!I&&(O=!0),await this.determineShouldRespectSameTab()&&(this.state.redirectInCurrentTab||ft())&&(O||!this.props.view.disableAffiliate)&&!i)return me(O,{clickId:l,couponRunId:d,fromAutoRun:n,autoFallback:{autoFallback:g,autoFallbackCouponsCount:N}});this.setState({didTryCodes:!0,running:!0,rooRunning:!!this.props.view.roo,disableAutomatic:e===!0});let U;C?U=Ze.tryCodes:S?U=Jo:U=he;let Y=this.getRunAnimation();if(Io()===!1){sessionStorage.setItem("__wb_amz_coup_id",d),document.querySelector("#nav-link-accountList .nav-line-1").click();return}let lt=!this.state.disableAutomatic&&this.state.automaticCouponsEnabled,it=this.couponsToTry({automaticCouponsRun:lt,couponTryCount:F,autoFallbackCouponsCount:N});ee.default.all([U({ignoreCancelled:t,disableAffiliate:i||O||this.props.view.disableAffiliate,coupons:it,automaticCouponsRun:lt,autoFallback:g,manuallyActivatedFallback:a,manuallyActivatedSameTabReload:p,isSiteHub:f,passedInClickId:l,couponRunId:d,cashback:h}),O&&!i?Ot({clickId:l,coupons:!0,fromAutoRun:n,isSiteHub:f}):ee.default.resolve(),C?ee.default.resolve().delay(Y.duration):ee.default.resolve()]).then(([ht,ot,Et])=>{ot&&y("track","activateCashbackRedirect",{rewardAmount:D.amount,rewardDisplay:D.type}),sessionStorage.removeItem("__wb_clickId"),sessionStorage.removeItem("__wb_amz_coup_id");let xt=c.default.get(ht,"finishWithoutResult")||c.default.get(ht,"pageReload")||c.default.get(ht,"changePageLocation");setTimeout(()=>{_.unset("affiliateRedirectData"),this.setState({running:!1,barComplete:!0,rooRunning:!1},()=>{setTimeout(()=>this.setState({barComplete:!1,manuallyActivatedAutoRun:!1,currentCodeIndexTigger:0,autoFallback:!1}),300)})},xt?2400:200)})}async activateCreditsAfterAutomatic({clickId:t,fromAutoRun:e,fromActivateRewards:i,savings:o,codeEntered:n,manuallyActivatedAutoRun:a,shouldLoadEmailCreateAccountNotification:p}={}){let l=await this.determineShouldRespectSameTab(),d=c.default.get(this.props.cashbackView,"postCoupons");this.setState({creditsActivated:!0}),(ft()||this.state.redirectInCurrentTab||i)&&l&&!a?await me(!d,{clickId:t,fromAutoRun:e,fromActivateRewards:i,autoSavings:o,codeEntered:n,shouldLoadEmailCreateAccountNotification:p}):(await Ot({clickId:t,coupons:!0,codeEntered:n,fromAutoRun:e,fromActivateRewards:i}),p&&Ge())}async activateRewardsOnly({clickId:t,fromAutoRun:e,fromActivateRewards:i,ctaText:o,label:n,pageLocation:a,fromAutoCoupImmediateNotif:p}={}){let l=await this.determineShouldRespectSameTab(),d=n||zo();this.setState({activatingCredits:!0});let m=c.default.get(this.props,"cashbackView.reward"),f=this.state.automaticCouponsEnabled&&!this.state.manuallyActivatedAutoRun||!this.state.disableAutomatic&&this.state.automaticCouponsEnabled;if(Ht(),this.dismissOrActivateRewardsOnlyCouponNotificationEvent({ctaText:o,label:d,runAutomatically:f,eventName:"dismissCouponNotification",pageLocation:a,activateRewardsOnly:!0,fromActivateRewards:i,fromAutoCoupImmediateNotif:p}),(this.state.redirectInCurrentTab||i||u("also_pin_202401_test"))&&l){let g=await so();await ze(3e3),y("track","activateCashbackRedirect",c.default.assign({rewardAmount:m.amount,rewardDisplay:m.type},g)),this.onClosePopup(d,{skipEvent:!0,willRedirect:!0}),location.href=g.affiliateUrl;return}await Ot({clickId:t,coupons:!0,fromAutoRun:e,fromActivateRewards:!0}),this.setState({activatingCredits:!1,creditsActivated:!0}),y("track","activateCashbackRedirect",{rewardAmount:m.amount,rewardDisplay:m.type}),this.onClosePopup(d,{skipEvent:!0,shouldLoadCreateAccountNotification:!0})}getRunAnimation(){let{roo:t,estimatedRunTime:e}=this.props.view,i;return t?i={duration:0,stagger:0}:e<=5e3?i={class:"fast",stagger:500,duration:5500}:e<=1e4?i={class:"medium",stagger:1e3,duration:10500}:e<=15e3?i={class:"slow",stagger:1500,duration:15500}:e<=2e4?i={class:"extra-slow",stagger:2e3,duration:20500}:i={class:"extra-extra-slow",stagger:2500,duration:25500},i}closeModalOnClickOutside(t){let e=!this.state.disableAutomatic&&this.state.automaticCouponsEnabled,i=t.path||t.nativeEvent.composedPath&&t.nativeEvent.composedPath();!c.default.find(i,n=>n.className&&c.default.isString(n.className)&&n.className.includes("coupon-notification"))&&t.isTrusted&&!this.state.hideNotification&&(this.shouldShowFullPage()||e)&&!this.state.running&&this.state.result&&!e&&this.onClosePopup()}closeModalTimeout(t){this.coupModalAutoDismissId=setTimeout(()=>this.onClosePopup(),t)}clearCloseModalTimeout(){clearTimeout(this.coupModalAutoDismissId)}async sendCouponNotificationEvent({isSiteHub:t,notifyImmediate:e}={}){await new Promise(D=>setTimeout(D,300));let i=(0,qs.findDOMNode)(this),o="",n="",a="",p="";if(i){let D=i.querySelector("button"),I=i.querySelector("h2"),O=i.querySelector("h4");D&&D.textContent&&(n=D.textContent.toLowerCase()),I&&I.textContent&&(a=I.textContent.toLowerCase()),O&&O.textContent&&(p=O.textContent.toLowerCase())}o=`${a} ${p}`,a==="trying coupon codes"&&(o="");let l=await Ro(),d=_.get("affiliateRedirect"),m=c.default.get(d,"redirected"),f=c.default.get(this,"state.result"),g=c.default.get(f,"couponRunId"),h=po({automaticCouponsRun:c.default.get(f,"automaticCouponsRun")||e,autoFallback:c.default.get(f,"autoFallback"),isSiteHub:c.default.get(f,"isSiteHub")||t,manuallyActivatedFallback:c.default.get(f,"manuallyActivatedFallback"),sameTabAffiliateRedirect:m}),w=this.state.result?"couponNotificationResult":"couponNotification",x,R=_.get("lifetimeSavings"),C=c.default.get(R,"lifetimeSavings.amount",0)*100;if(u("ext_coupon_savings_emphasis")&&C>=1e3?x="":w==="couponNotification"&&!m&&(x=fe()),Ct()){let D=c.default.get(this.state,"result.savings");if(this.state.result&&D<=0&&!t||!this.state.result&&!t)return}let S=c.default.get(f,"savings");S>0&&!c.default.get(f,"bestCoupon")&&(S=0);let F=!!c.default.get(this.props,"cashbackView.reward.amount");c.default.get(this.props,"view.hasDeferredCouponRewards")&&(h==="auto"||h==="auto_fallback"&&S>0)&&(F=!1),y("page",w,{view:w,type:"notification",source:"coupons",cashback:F,cashbackAmount:F?c.default.get(this.props,"cashbackView.reward.amount"):void 0,cashbackType:F?c.default.get(this.props,"cashbackView.reward.type"):void 0,vendorMetaId:c.default.get(this.props,"cashbackView.id"),savings:S,triggerType:h,copyTestVariant:x,couponRunId:g,engine:_.get(["siteAPIData","siteData","coupons","type"]),hasCredits:je(l),ctaText:n,notificationText:o,deweyResult:c.default.get(this.props.deweyResult,"pageType")})}componentWillUnmount(){this.timeout&&clearTimeout(this.timeout),_.get("couponNotif")&&_.unset("couponNotif"),window.removeEventListener("click",this.boundCloseModal)}},jn=ae({affiliateRedirect:["affiliateRedirect"],view:["couponView"],deweyResult:["deweyResult"],cashbackView:["cashbackView"],exclusions:["siteAPIData","siteData","merchantPage","exclusions"],tld:["siteAPIData","meta","domain"],vendorName:["siteAPIData","meta","name"],giftCardView:["giftCardView"],session:["session"],settings:["settings"],googleData:["googleData"],events:["events"],shouldHidePrompt:["shouldHidePrompt"],shouldShowSPAPrompt:["shouldShowSPAPrompt"],warnAboutStandDown:["warnAboutStandDown"]},Gi);export{ma as a,Gt as b,bs as c,bt as d,gi as e,Pi as f,Gn as g,jn as h};
