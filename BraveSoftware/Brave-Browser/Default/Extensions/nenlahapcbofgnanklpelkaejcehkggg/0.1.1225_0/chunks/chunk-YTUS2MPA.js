import{a as d}from"./chunk-WWUAKAAN.js";import{a as f}from"./chunk-D3PBAGDZ.js";import{b as F}from"./chunk-3XIOB4EC.js";import{a as p}from"./chunk-BCG2KUGW.js";import{a as G}from"./chunk-O4TFJKJQ.js";import{c as v,f as O,h as R,q as N,u as l}from"./chunk-4SRFE46V.js";import{b as A,i as P,l as D,p as lt,q as M}from"./chunk-52XVUBCW.js";import{e as k}from"./chunk-3GYLW4KZ.js";async function S(t,e,n,o){let r=Date.now(),a=0,i=t();for(;!i&&a<e;)await dt(n),i=t(),a=Date.now()-r;i&&o(i)}function dt(t){return new Promise(e=>{setTimeout(e,t)})}lt();var x=k(M());var y,W=!1;async function ft(){return d($,t=>I())}function I(){let t=Y();if(t)return _(t),pt(t),t}function pt(t){t.addEventListener("click",()=>{h("coupert","cashback"),l("track","coupertActivate",{url:location.href,cashbackRate:L()})})}function L(){if(!y&&(E(),!y))return null;let t=[...y.querySelectorAll('div[style*="color: initial;"] div div > div span')].find(n=>!!n.textContent.match(/Cash Back(?! Terms)/));if(t){let n=t.previousElementSibling?t.previousElementSibling.innerText:t.nextElementSibling?t.nextElementSibling.innerText:void 0;return n||null}let e=[...y.querySelectorAll('div[style*="color: initial;"] div div > div > div')].find(n=>n.textContent.includes("Rewards Found!"));if(e){let n=e.nextElementSibling&&e.nextElementSibling.innerText;return n||null}}function _(t){if(W)return;W=!0;let e=L();l("track","coupertNotification",{name:"cashback",url:location.href,ctaText:t.innerText,cashbackRate:e})}async function U(){d($,async t=>{let e=!1,n={childList:!0};new MutationObserver(i=>{x.default.forEach(i,async u=>{x.default.get(u,"type")==="childList"&&e===!1&&(e=!0,await ft())})}).observe(t,n);let r=I(),a=await f({action:"getCompState",comp:"coupert"});r&&!a&&_(r)})}function $(){try{let t=E();return!!y?.querySelector("div").innerText.match(/^(?!.*coupons?).*rewards.*$/is)?t:!1}catch{return!1}}function ht(){if(!!y.querySelector("div").innerText.match(/Continue to Checkout/))return y.querySelector('div[style*="color: initial;"]')}async function mt(t){f({action:"endSavingsCheck",comp:"coupert"});let e=[...t.querySelectorAll("div")].find(r=>r.textContent.match(/Congratulations!|You saved/)),n=0,o=[];if(e){let r=[...t.querySelectorAll("div p")].find(u=>u.textContent.includes("Congratulations!")),a=[...t.querySelectorAll("div div > div > div > div > div")].find(u=>u.textContent.includes("You saved")),i=r?r.previousElementSibling:a;if(i){let C=[...i.querySelectorAll("span, p")].find(B=>B.textContent==="With the code:")?.nextElementSibling?.textContent,m;a?m=[...a.querySelectorAll("div > div")].find(ut=>ut.innerText.includes("You saved")).nextElementSibling.textContent:m=i.previousElementSibling.textContent,m&&(n=p(m)),C&&o.push(C)}}l("track","coupertTryCouponsResult",{savings:n,coupons:o,url:location.href}),L(),h("coupert","coupons")}async function yt(){return d(K,t=>j())}function Y(){return y.querySelector("[class*=cpui-btn-primary--]")}function j(){let t=Y();if(t)return Ct(t),t}function Ct(t){let e=t.innerText;t.addEventListener("click",()=>{f({action:"initSavingsCheck",comp:"coupert"}),l("track","coupertTryCoupons",{ctaText:e,url:location.href}),S(ht,12e4,500,mt)})}async function V(){d(K,t=>{let e=!1,n={childList:!0};new MutationObserver(a=>{x.default.forEach(a,async i=>{x.default.get(i,"type")==="childList"&&e===!1&&(e=!0,await yt())})}).observe(t,n);let r=j();if(r){let a=y.querySelector("[class^=cbButton]"),i=r.innerText,u=a?.innerText;l("track","coupertNotification",{name:"coupon",ctaText:i,url:location.href,secondaryCtaText:u})}})}function K(){try{let t=E();return!!t?.querySelector("div").innerText.match(/(coupons?|savings)/i)?t:!1}catch{return!1}}function E(){let e=[...document.querySelectorAll('div[style^="display: block"]')].find(n=>{let o=n.openOrClosedShadowRoot||chrome.dom.openOrClosedShadowRoot(n);if(o&&o.querySelector('link[href="chrome-extension://mfidniedemcgceagapgdekdbmanojomk/css/content.css"]'))return o});if(e){let n=e.openOrClosedShadowRoot||chrome.dom.openOrClosedShadowRoot(e);return y=n,n}}var q=k(G());async function z(){let t=await f({action:"getHoneyState",comp:"honey"}),e=await f({action:"getCompState",comp:"piggy"});!t&&!e&&d(gt,n=>{let[o,r]=bt(n);l("track","ebatesNotif",{url:location.href,cashbackRate:o,previousCashbackRate:r});let a=St(n);a&&a.addEventListener("click",()=>{l("track","ebatesActivate",{url:location.href,cashbackRate:o,previousCashbackRate:r}),h("ebates","cashback")});let i=n.querySelector(".rr-button-close, [title^=Dismiss], .rr-tertiary");i&&i.addEventListener("click",()=>{l("track","ebatesDismiss",{url:location.href,cashbackRate:o,previousCashbackRate:r})})})}async function J(){await f({action:"getHoneyState",comp:"honey"})||d(vt,e=>{l("track","ebatesCouponNotif",{url:location.href});let n=[...e.querySelectorAll(".r-button")].find(r=>r.textContent.includes("Apply Coupons"));n&&n.addEventListener("click",()=>{l("track","ebatesTryCoupons",{url:location.href})});let o=e.querySelector(".rr-button-close, [aria-label^=Dismiss]");o&&o.addEventListener("click",()=>{l("track","ebatesCouponDismiss",{url:location.href})})})}function gt(){try{return Q().shadowRoot.querySelector(".ebates-notification")}catch{return!1}}function vt(){try{let t=Q().shadowRoot;return[...t.querySelectorAll(".r-button")].find(n=>n.textContent.includes("Apply Coupons"))?t.querySelector("aside[data-tid=coupons-magic-notification]"):!1}catch{return!1}}function St(t){let e=t.querySelector(".rr-button-primary, button.r-button");return e&&/activate/i.test(e.innerText)?e:t.querySelector(".ebates-notification-button.ebates-notification-button-activate")||t.querySelector("ebates-notification-button.ebates-notification-button-login")}function bt(t){try{let e=t.querySelector(".ebates-notification .ebates-notification-button-activate")||t.querySelector(".rr-button-primary, button.r-button"),n=t.querySelector(".rr-text-secondary"),o=(0,q.default)(e).text(),r=(0,q.default)(n).text().trim()||void 0;return[o,r]}catch{return!1}}function Q(){return[...document.querySelectorAll("html > *")].find(t=>{if(t.shadowRoot&&t.shadowRoot.querySelector(".ebates-notification, aside[data-tid=coupons-magic-notification]"))return!0})}var g=k(G()),c=k(M());var s;function Z(){try{let t=s?.querySelectorAll("#honey button");return t?.length&&t}catch{return!1}}function H(){try{let t=s?.querySelector("#honey-shadow"),e;if(t){let n=(0,g.default)(t).find("[id*=HoneyGoldAmount]").text()||(0,g.default)(t).find("[class*=DescriptiveGold] span[class*=textBold]").text()||(0,g.default)(t).find("[class^=ctaColumn] [class^=container] [class^=title]").text()||(0,g.default)(t).find('[class*=goldText] span:contains("Gold")').text()||(0,g.default)(t).find("[class^=valueContainer] [class*=price]").text()||(0,g.default)(t).find("[class^=subTextAndTerms] [class*=subText]").text(),o=n&&n.match(/(\d+[,\.]?\d*% to \d+[,\.]?\d*(?:%|\sHoney Gold|\sGold|\scash back))/);e=o?o[1]:null}return e}catch{return null}}function wt(){return new Promise((t,e)=>{d(Z,n=>{let o=c.default.last(n);t(o)})})}function tt(){let t=s?.querySelector("#honey-shadow"),e;return t&&(e=(0,g.default)(t).find('[class*=bodyContentGreen] p:contains("Cart Total")').text(),e=p(e)),e}function et(){let t=s?.querySelector("#honey-shadow"),e;return t&&(e=(0,g.default)(t).find("div:contains('re-activate Honey')").text()),!!e}function X(){h("honey","cashback")}function kt(t){let e=t?.innerText;l("track","activateHoney",{url:location.href,ctaText:e,cashbackRate:H(),reactivation:et()})}function xt(){d(Z,t=>{let e=[...t].find(r=>r.innerText==="Apply Coupons"),n=Tt(t),o=Rt(t);if(e){let r=tt(),a=e.textContent,i=H();e.addEventListener("click",()=>{n&&l("track","honeyTryCoupons",{url:location.href,cartTotal:r,ctaText:a,cashbackRate:i}),f({action:"initSavingsCheck",comp:"honey"}),S(rt,4e4,500,ot)})}n&&n.addEventListener("click",X),o&&o.addEventListener("click",()=>{kt(o),X()})})}async function nt(){try{S(rt,4e4,500,ot),d(()=>{let e=[...document.querySelectorAll("#honeyContainer, div[data-reactroot]")].find(n=>{let o=n.openOrClosedShadowRoot||chrome.dom.openOrClosedShadowRoot(n);return o&&o?.getElementById("honey-shadow")});if(e)return e.openOrClosedShadowRoot||chrome.dom.openOrClosedShadowRoot(e)},async t=>{s=t,xt();let e=await wt(),n=e?e.textContent:null,o=tt(),r=c.default.debounce(u=>{l("track",u?"showHoney":"hideHoney",{url:location.href,cartTotal:o,ctaText:n,cashbackRate:H(),reactivation:et()})},1e3),a=new MutationObserver(u=>{c.default.forEach(u,C=>{let m=c.default.get(C,"target.style.visibility");m==="hidden"?r(!1):(m==="initial"||m==="visible")&&r(!0)})}),i=s?.querySelector("#honey-shadow");if(i){a.observe(i,{attributes:!0,attributeFilter:["style"]});let u=i?.style?.visibility;u==="hidden"?r(!1):(u==="initial"||u==="visible")&&r(!0)}})}catch{}}function ot(t){f({action:"endSavingsCheck",comp:"honey"});let e=c.default.get(t,"savings")&&typeof t.savings=="number"?+t.savings:null,n=c.default.get(t,"originalPrice")&&typeof t.originalPrice=="number"?+t.originalPrice:null,o=c.default.get(t,"withHoneyPrice")&&typeof t.withHoneyPrice=="number"?+t.withHoneyPrice:null;l("track","honeyTryCouponsResult",{savings:e,rewardsSavings:c.default.get(t,"rewards",null),originPrice:n,finalPrice:o,codeApplied:c.default.get(t,"workingCode",null),url:location.href}),h("honey","coupons",()=>v.set(["warnAboutStandDown"],!0))}function Tt(t){return c.default.find(t,e=>/coupon(?:s)?|code(?:s)?/i.test(e.innerHTML))||c.default.find(s?.querySelector("#honey")?.querySelectorAll("span"),e=>e.innerHTML==="Coupon codes")}function Rt(t){return c.default.find(t,e=>/claim honey gold|claim rewards|activate cash back|activate rewards/i.test(e.innerHTML))}var Mt=[()=>{try{let t=/You saved|youâ€™re saving/i;if(s?.innerHTML.match(t)){let n=c.default.get(s?.querySelector("[class*=savingsPrice], [class^=savingsText]"),"textContent"),o=n?p(n):null,r=c.default.get(s?.querySelector("[id*=OriginalPrice], [class^=originalTotal]"),"textContent"),a=r?p(r):null,i=c.default.get(s?.querySelector("[id*=WithHoneyPrice], [class^=price].price5"),"textContent"),u=i?p(i):null,C=c.default.get(s?.querySelector("[id*=HoneyGoldAmount], [class^=valueContainer] > [class^=value]"),"textContent"),m=c.default.get(s?.querySelector("[class*=workingCode], [class*=bestCode-]"),"textContent");return{foundModal:!0,savings:o,rewards:C,originalPrice:a,withHoneyPrice:u,workingCode:m}}}catch{}return!1},()=>{try{let t=/Honey Gold.+activated/i;if(s?.innerHTML.match(t))return{foundModal:!0,rewards:c.default.get(s?.querySelector("[class*=DescriptiveGold] span[class*=textBold]"),"textContent")}}catch{}return!1},()=>{try{let t=/forget your free sample/i;if(s?.innerHTML.match(t)){let n=c.default.get(s?.querySelector("[id*=FreeItemReceipt][id*=titleContent]"),"textContent"),o=n?p(n):null,r=c.default.get(s?.querySelector("[id*=honeyGoldContainer] [class*=bold]"),"textContent"),a=s?.querySelectorAll("[class*=couponsContainer] [class*=couponPointer] [class*=couponTitle]"),i=c.default.map(a,u=>u.textContent);return{foundModal:!0,savings:o,rewards:r,workingCode:i}}}catch{}return!1},()=>{try{let t=/have the best/i;if(s?.innerHTML.match(t)){let n=s?.querySelector("[class^=price]")?.textContent;return{foundModal:!0,withHoneyPrice:n?p(n):void 0}}}catch{}return!1},()=>{try{let t=/Get.+Gold back/;if(s?.innerHTML.match(t))return{foundModal:!0,rewards:c.default.get(s?.querySelector("[id*=bonusCashContentContainer] [id*=span-bonusCashContent]"),"textContent")}}catch{}return!1},()=>{try{let t=/\d+% back|activated/;if(s?.innerHTML.match(t))return{foundModal:!0,rewards:c.default.get(s?.querySelector("[id*=bonusCashContentContainer] [id*=span-bonusCashContent]"),"textContent")}}catch{}return!1},()=>{try{let t=/youâ€™re earning cash back/i;if(s?.innerHTML.match(t))return{foundModal:!0,rewards:c.default.get(s?.querySelector("[class^=valueContainer] [class*=price]"),"textContent")}}catch{}return!1}];function rt(){let t=!1;return c.default.forEach(Mt,e=>{let n=e();if(c.default.has(n,"foundModal")){t=n;return}}),t}var w=k(M());var b,T;function Lt(){try{T&&(T=void 0);let t=b?.querySelectorAll("#root button");return t?.length&&t}catch{return!1}}function Et(t){if(/cash back/i.test(t.innerHTML))return t?.textContent}function qt(t){f({action:"endSavingsCheck",comp:"pie"});let e=w.default.get(t,"savings")&&typeof t.savings=="number"?+t.savings:null,n=typeof T=="number"&&Date.now()-T;l("track","pieTryCouponsResult",{savings:e,cashbackRate:w.default.get(t,"rewards",null),coupons:w.default.get(t,"coupons",[]),runTime:n,url:location.href}),h("pie","coupons",()=>v.set(["warnAboutStandDown"],!0))}function Ht(t){return[...t].find(n=>/Apply Coupons/i.test(n.innerHTML))}function Bt(){d(Lt,t=>{let e=Ht(t);if(e){Dt("coupon",e);let n=e.textContent||void 0;e.addEventListener("click",()=>{T=Date.now(),e&&at("pieTryCoupons",{url:location.href,ctaText:n}),f({action:"initSavingsCheck",comp:"pie"}),S(Pt,4e4,500,qt)})}})}async function it(){try{d(()=>{let e=[...document.querySelectorAll('div[style^="all: initial !important;"]')].find(n=>{let o=n.openOrClosedShadowRoot||chrome.dom.openOrClosedShadowRoot(n);return o&&o?.querySelector('style[data-emotion="pie"]')});if(e)return e.openOrClosedShadowRoot||chrome.dom.openOrClosedShadowRoot(e)},async t=>{b=t,Bt()})}catch{}}var At=[()=>{try{if(b){let t=[],e=/Continue to Checkout/i;if(b.innerHTML.match(e)){let o=[...b.querySelectorAll("span")].find(C=>C?.textContent?.includes("Cash Back")),r;o&&(r=Et(o));let a=b?.querySelector('svg[fill="currentColor"]')?.nextElementSibling,i=a?.textContent,u=a?.parentElement?.nextElementSibling?.textContent;return i&&t.push(i),{foundModal:!0,savings:u?p(u):void 0,rewards:r,coupons:t}}}}catch{}return!1}];function Pt(){let t=!1;return w.default.forEach(At,e=>{let n=e();if(w.default.has(n,"foundModal")){t=n;return}}),t}async function at(t,e={}){l("track",t,{...e,url:location.href})}function Dt(t,e){at("pieNotification",{name:t,ctaText:e.innerText})}function Ot(){function t(){d(()=>document.querySelector('form[action*="i.clean.gg"]'),e=>{l("track","extensionError",{type:"possible_error",source:"clean"})})}document.readyState!=="loading"?t():document.addEventListener("DOMContentLoaded",t)}async function st(){let t=O();return t=R("ext_separate_domain_platform")?v.get("platformDomain"):await F(t)||t,t}var we=()=>{nt(),z(),J(),U(),V(),it(),Ot()};var ct=(t,e)=>N("hasActivatedCompetitor",t);async function h(t,e,n){let o=await st(),r=`${t}WarningNotif-${o}`;chrome.storage.local.get(r,a=>{let i=a[r];(e==="cashback"&&v.get(["cashback","user","activated"])||e==="coupons")&&(!i||D(A(P(i),{days:1}),new Date))&&R("notif_reactivation_base")&&(n&&n(),ct({domain:o,comp:t}))})}export{S as a,h as b,we as c};
