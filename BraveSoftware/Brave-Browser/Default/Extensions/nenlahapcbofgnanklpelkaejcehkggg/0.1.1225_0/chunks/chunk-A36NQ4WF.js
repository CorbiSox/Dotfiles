import{a as T,b as $}from"./chunk-N3RCD34N.js";import{a as S}from"./chunk-LLA7RVSB.js";import{c as a,f as n,h as l,q as o,u as f}from"./chunk-4SRFE46V.js";import{b as R,c as G}from"./chunk-LC5XJ32R.js";import{d as v,j as C,p as U,q as A,r as O}from"./chunk-52XVUBCW.js";import{e as g}from"./chunk-3GYLW4KZ.js";var y=async t=>o("activatePinnedTab",t);function k(){return a.get(["sameTabRedirectDomains"])?.includes(n())}U();var u=g(A()),_=g(O());G();$();var P=g(A());var N=t=>{let{pageViewId:e,domain:i}=t,c=P.default.pick(window.location,["hash","host","hostname","href","origin","pathname","port","search"]);return o("affiliateLinkMonitorSetup",{startingLocation:c,pageViewId:e,domain:i})};var b=t=>o("competitorCashbackCacheGet",{domain:n(),comp:t});var h=t=>o("competitorCashbackCacheRemove",{domain:n(),comp:t});var E=t=>o("completeTooltipSteps",{step:t});var M=t=>o("dismissCashback",t);var w=(t,e)=>o("domainLocalStorageSet",{domain:n(),key:t,value:e});var V=()=>o("getCashback");function I(t,e,i,c,{redirect:m=!1,cashback:r=!1,...p}={}){let s,d;if(window.__wb_contentId){switch(t){case"cashbackNotification":s="cashback";break;case"couponNotification":case"couponNotificationResult":s="coupons";break;case"siteHubOffers":s="sitehub";break}s&&(d=window.__wb_contentId[s])}f("track","desktopExtensionClick",{name:t,label:e?.toLowerCase(),type:i,subType:c,cashback:r,redirect:m,...p,contentId:d})}var L=t=>o("checkIfInPriceComparison",t);var H=new Set(["ebay.com","stubhub.com"]);async function x(t){if(H.has(t))return L(t)}function Ut(){M()}async function Ot(){let t=!1,e=await V();return e&&u.default.get(e,"reward.amount")&&(t=e),t}function $t(t){let e={[t]:Date.now()},i=u.default.cloneDeep(a.get(["events"]));i=u.default.merge(i,e),a.set(["events"],i),E(t)}async function Gt(t){let e={rakuten:"rakuten",honey:"honey",rmn:"rmn"},i=await b(e.honey),c=await b(e.rakuten),m=await b(e.rmn),r="";i&&(r="honey"),m&&(r="rmn"),c&&(r="rakuten"),chrome.storage.local.set({[`${r}WarningNotif-${t}`]:T()},()=>{c&&h(e.rakuten),i&&h(e.honey),m&&h(e.rmn),r===""&&h(r)})}async function F({clickId:t,coupons:e,codeEntered:i,fromAutoRun:c,fromActivateRewards:m,isSiteHub:r}={}){let p=n();a.set(["couponsAffiliateDisabledSites",`${p}_${a.get("tabId")}`],C(v(new Date,30)));let s=t||_.default.v4().replace(/-/g,"");return y({pageViewId:a.get("pageViewId"),clickId:s,domain:p,coupons:e,codeEntered:i,programId:a.get(["siteAPIData","programId"]),vendorMetaId:a.get("cashback","id"),fromAutoRun:c,fromActivateRewards:m,isSiteHub:r})}async function J(){let t=n();if(k()||document.URL.includes("shop.app")){let d=a.get("pageViewId");await N({pageViewId:d,domain:t})}await Promise.all([w("affiliateRedirect",JSON.stringify({redirected:!0,location:location.href})),w("emailCreateAccount",JSON.stringify({shouldLoadNotification:!0}))]),a.set(["couponsAffiliateDisabledSites",`${t}_${a.get("tabId")}`],C(v(new Date,30)));let e=_.default.v4().replace(/-/g,""),i,c=a.get("siteAPIData","tld"),m="cashback",r=await x(t);r&&(m="cashback-ims");let p={destUrl:location.href,channel:m,subExperience:"credits",redirectId:R(e),sameTab:!0,vendorMetaId:a.get("cashback","id"),clickEvent:"cashbackRedirect",...!r&&{destDomain:c}};i=S({params:p});let s={affiliateUrl:i,pageViewId:a.get("pageViewId"),clickId:e,domain:t,preventPinnedTab:!l("also_pin_202401_test"),vendorMetaId:a.get("cashback","id"),programId:a.get(["siteAPIData","programId"])};return y(s),s}async function Ht({reward:t,pageLocation:e,view:i,label:c}={}){f("trackClick","activateCashback","activate",{rewardAmount:t.amount,rewardDisplay:t.type,label:c,view:i,pageLocation:e}),I(e==="sitehub"?"siteHubOffers":i==="cashbackReactivate"?"rewardsReactivation":"cashbackNotification",c,"cta","primary",{redirect:!0,cashback:!!t.amount,rewardAmount:t.amount,rewardDisplay:t.type,view:i});let m=a.get(["siteAPIData"]),r=a.get(["deweyResult"]),p=u.default.get(r,"pageData.meta"),s=!0;if(p&&u.default.has(p,"disable_aff_link_current_tab")&&(s=!1),s&&(u.default.get(m,"meta.affiliate_link_current_tab")||k())){let D=await J();return f("track","activateCashbackRedirect",u.default.assign({rewardAmount:t.amount,rewardDisplay:t.type,view:i},D)),location.href=D.affiliateUrl,{isRedirectEnabled:!0}}a.set(["cashbackView","user","activating"],!0),a.set(["cashback","user","activating"],!0),a.set(["offers","cashback","user","activating"],!0);let d=await F();return a.set(["cashbackView","user","activated"],!0),a.set(["cashback","user","activated"],!0),a.set(["offers","cashback","user","activated"],!0),f("track","activateCashbackRedirect",u.default.assign({rewardAmount:t.amount,rewardDisplay:t.type,view:i},d)),{isRedirectEnabled:!1}}function Ft(){let t=a.get(["couponView","partnerGroupsList"]);return l("dtcnp_test")&&!t?.groupA?.includes(n())||l("dtcnp_tier_2")&&t?.groupB?.includes(n())||l("dtcnp_tier_3")&&t?.groupC?.includes(n())?(f("page","possibleExperience",{type:null,source:"credits",notificationText:"credits"}),!0):!1}export{I as a,y as b,N as c,w as d,k as e,x as f,Ut as g,Ot as h,$t as i,Gt as j,F as k,J as l,Ht as m,Ft as n};
