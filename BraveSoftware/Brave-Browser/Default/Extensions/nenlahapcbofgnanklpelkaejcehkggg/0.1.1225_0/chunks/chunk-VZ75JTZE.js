import{a as C}from"./chunk-3R2PURR4.js";import{a as P}from"./chunk-ZIQ6U6YW.js";import{a as b}from"./chunk-O4TFJKJQ.js";import{h as g,q as D}from"./chunk-4SRFE46V.js";import{q as I}from"./chunk-52XVUBCW.js";import{b as d,c as x}from"./chunk-42JNP4CL.js";import{e as w}from"./chunk-3GYLW4KZ.js";var T=w(P()),v=w(b()),m=w(I()),u=w(C());x();var _=({domain:r,pid:n,title:s})=>D("getWirelessDeviceId",{domain:r,pid:n,title:s});var l;async function W(r){let n=m.default.cloneDeep(r||{}),s=n.domain||"",c=n.pageType||"",p=!!n.pageData?.tag?.some(e=>e.indexOf("wireless_device")===0);if(c==="productPage"&&p){let e=n.pageData.products?.find(y=>(y.sku||y.pid)&&y.title)||{},{sku:t,pid:a,title:o}=e,i=await _({domain:s,pid:a||t,title:o});typeof i=="string"&&(e.wireless_device_id=i,n.pageData.wireless=Object.assign({},n.pageData.wireless||{},{deviceId:i}),n.pageData.tag.push(`device_id_${i.replaceAll("-","_")}`))}return n}function k(){window.__wb_timing.deweyUtilRequireAt=performance.now();let r,n;function s(){if(r)return r;n="async";let e=new u.Dewey;e._isasync=!0,e.setDocument(document),e.setParser(v.default),r=e;let t=!1;return r.startAttempt=0,r.deweyMode=n,r.pageTypeComplete=(a,o)=>{t||(t=!0,window.__wb_timing.deweyPageTypeFoundAt=performance.now())},r.emitter.on("result",a=>{let o=m.default.get(a,"pageType");o&&r.pageTypeComplete(o,"emitter")}),r}let c=!1,p={get deweyMode(){return s().deweyMode},get startAttempt(){return s().startAttempt},setDefaultConfig:e=>{s().setDefaultConfig(e)},get emitter(){return s().emitter},evaluateIdentifierTree:async(e,t)=>{let a=s();if(a._isasync){let o=t,i=t.deweyParser;return await u.evaluateIdentifierTree({identifiers:e,parser:i,evalDocument:o,matchTypes:{url:0,title:0,selectors:[]}})}return a.evaluateIdentifierTree(e,t)},run:async(e,t)=>{d("dewey.run",e);let a=s(),o={...e,ensureUrlTriggerIsPresent:g("ext_dewey_ensure_url_trigger")};return a.run(o,t)},start:()=>{if(c)return;c=!0;let e=performance.now();window.__wb_timing.deweyStartAt=e,d("dewey.start");let t=s();t.extractVarsSplit=!0;let a=(0,T.exponential)({randomisationFactor:0,initialDelay:50,maxDelay:3e3});async function o(){t.startAttempt++;let i=await p.run(),y=m.default.get(i,"pageType"),f=performance.now()-e;!y&&f<5e3?a.backoff():s().pageTypeComplete(y,"startup")}a.on("ready",o),o()}};return p}window.Dewey||(window.Dewey=k()),l=window.Dewey;var O=l;export{W as a,O as b};
