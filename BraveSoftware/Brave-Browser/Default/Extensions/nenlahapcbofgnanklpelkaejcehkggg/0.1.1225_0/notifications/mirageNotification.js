import{a as V}from"../chunks/chunk-DT7PBS4M.js";import{a as H}from"../chunks/chunk-A5YKHYT6.js";import{c as $,f as z,g as K}from"../chunks/chunk-TSZP6UXS.js";import{b as k}from"../chunks/chunk-VZ75JTZE.js";import{a as F}from"../chunks/chunk-IOEYPKEV.js";import{f as q}from"../chunks/chunk-NYGFFQMG.js";import{a as O}from"../chunks/chunk-NZY4JV6E.js";import{c as R}from"../chunks/chunk-4GT6T77M.js";import"../chunks/chunk-4GJAJKDK.js";import"../chunks/chunk-3R2PURR4.js";import"../chunks/chunk-JDV5FZKX.js";import{q as h}from"../chunks/chunk-E4QNY2PC.js";import"../chunks/chunk-ZIQ6U6YW.js";import{a as T}from"../chunks/chunk-B7GBMFFD.js";import{a as A}from"../chunks/chunk-AKTW5CPL.js";import{a as U}from"../chunks/chunk-LLA7RVSB.js";import{a as P}from"../chunks/chunk-Z6PVZUDE.js";import"../chunks/chunk-FEK2HJKI.js";import{a as rt}from"../chunks/chunk-NJ63VSGO.js";import"../chunks/chunk-OTRTIFBS.js";import{a as E}from"../chunks/chunk-MFYKHTND.js";import{J as w,a as b,b as M,c as m}from"../chunks/chunk-3I3QPOUL.js";import{a as L}from"../chunks/chunk-O4TFJKJQ.js";import{a as at,c as f,f as d,h as B,u as l}from"../chunks/chunk-4SRFE46V.js";import"../chunks/chunk-IJQWISPG.js";import"../chunks/chunk-HY2GWXPO.js";import"../chunks/chunk-LC5XJ32R.js";import"../chunks/chunk-6LTHT6DZ.js";import"../chunks/chunk-XSKOAVIS.js";import{q as y}from"../chunks/chunk-52XVUBCW.js";import"../chunks/chunk-42JNP4CL.js";import"../chunks/chunk-SOWOQI5E.js";import"../chunks/chunk-YCRAP75I.js";import"../chunks/chunk-JAUVA5AU.js";import{e as r}from"../chunks/chunk-3GYLW4KZ.js";var Z=r(L()),p=r(y()),tt=r(at());var ft=r(b()),W=r(b()),g=r(rt()),X=r(L()),o=r(y());var s=r(m()),G="activateMirageNotification",v,x,N=class extends W.Component{constructor(...t){super(...t),this.state={hideNotification:!0}}componentDidMount(){let t=o.default.get(this.props.view,"actions",[]);o.default.each(t,e=>{let n=o.default.get(e,"type");["openNonLoyaltyUrl","openUrl"].includes(n)&&(v=o.default.get(e,"props.domain"),n==="openUrl"&&(x=o.default.get(e,"props.vendorMetaId")))}),l("page","mirageNotification",{view:"mirageNotification",type:"notification",destDomain:v,vendorMetaId:x,runId:o.default.get(this.props,"view.runId")});let i=Number(o.default.get(this.props.view,"launchDelayMS"))||1e3;setTimeout(()=>{this.setState({hideNotification:!1})},i)}render(){let{hideNotification:t}=this.state,{image:i,heading:e,subheading:n,cta:c}=this.props.view,u=!0;return t||l("page","mirageNotificationShown",{view:"mirageNotification",type:"notification",destDomain:v,vendorMetaId:x,runId:o.default.get(this.props,"view.runId")}),(0,s.jsx)(T,{className:t?"disabled mirage-notification":"mirage-notification",style:{top:"0",bottom:"auto",left:u?"auto":"0",right:u?"0":"auto"},children:(0,s.jsx)(g.Motion,{style:{opacity:(0,g.spring)(t?0:1,{stiffness:180,damping:20}),y:(0,g.spring)(t?-100:0,{stiffness:180,damping:20})},dragSelector:"header",isDraggable:B("ext_notif_drag"),onDragEnd:this.trackFirstDragEnd,children:({opacity:S,y:nt})=>(0,s.jsxs)("div",{className:"mirage-notification-content",style:{transform:`translate3d(0,${nt}%,0)`,opacity:`${S}`},children:[(0,s.jsxs)("header",{children:[(0,s.jsx)(E,{width:120}),(0,s.jsx)(R,{}),(0,s.jsx)(P,{onClick:this.onClosePopup.bind(this,"x")})]}),(0,s.jsxs)("section",{children:[o.default.get(i,"src")?(0,s.jsx)("div",{className:"notification-image-wrapper",style:o.default.get(i,"wrapperStyle"),children:(0,s.jsx)("div",{className:"notification-image",style:{backgroundImage:`url("${o.default.get(i,"src")}")`,...o.default.get(i,"style",{})}})}):null,(0,s.jsx)("h2",{style:o.default.get(e,"style"),children:o.default.get(e,"value")}),(0,s.jsx)("h4",{style:o.default.get(n,"style"),children:o.default.get(n,"value","")}),(0,s.jsx)("div",{className:"button-wrapper",children:(0,s.jsx)("button",{className:"primary-btn-large",style:o.default.get(c,"style"),onClick:this.onClickCTA.bind(this),children:o.default.get(c,"value")})})]})]})})})}trackFirstDragEnd=o.default.once((t,i)=>{F("mirageNotification",t,i)});async onClickCTA(){let{clickId:t,redirectId:i}=A();o.default.map(o.default.get(this.props.view,"actions"),e=>{let n=o.default.get(e,"props.vendorMetaId")||this.props.view.vendorMetaId;if(["openNonLoyaltyUrl","openUrl"].includes(e.type)&&o.default.get(e,"props.href")){let c=e.type==="openUrl"?this.getRedirectUrl(e,i,n):o.default.get(e,"props.href");window.open(c)}else if(e.type==="track")l("trackClick",e.event||G,"",o.default.assign({clickId:t,redirectId:i,vendorMetaId:n,runId:o.default.get(this.props,"view.runId")},e.props));else if(e.type==="click")(0,X.default)(e.selector).click();else if(e.type==="pinnedTab"){let c=this.getRedirectUrl(e,i,n);this.pinnedTab(t,c)}}),this.setState({hideNotification:!0}),this.throttleNotif()}onClosePopup(t){this.setState({hideNotification:!0}),l("trackClick","dismissMirageNotification",t,{runId:o.default.get(this.props,"view.runId")}),this.throttleNotif()}throttleNotif(){let t=d();h({domain:t,message:"throttle"})}async pinnedTab(t,i){try{H({url:i})}catch{}}getRedirectUrl(t,i,e){let n=o.default.get(t,"props.channel","cashback");return U({params:{channel:n,clickEvent:G,credits:n==="cashback"||n==="cashback-ims",destUrl:o.default.get(t,"props.href"),destDomain:o.default.get(t,"props.destDomain")||o.default.get(t,"props.domain"),redirectId:i,subExperience:o.default.get(t,"props.subExperience")||"mirage_notification",vendorMetaId:e},isWbPublisher:!0})}},D=M({view:["mirageNotification"],events:["events"],session:["session"]},N);var _=r(b()),j=r(y());var Q=r(m());async function st(a,t){let i=f.get("siteAPIData"),e={rootEl:"div",logLevel:null},n={siteAPIData:i,providedData:t,...(0,j.pick)(t,["throttleDurationMS","throttleKey"])},c=await V();return{config:e,content:a,data:n,...c}}var J=({content:a,providedData:t,onUnload:i})=>{let[e,n]=(0,_.useState)();return(0,_.useEffect)(()=>{st(a,t).then(c=>n(c)).catch(console.error)},[]),e?(0,Q.jsx)($,{config:e.config,content:e.content,host:e.host,user:e.user,data:e.data,onEvent:c=>z(c,i),onRequest:K}):null};var I=r(m());window.__wb_timing.mirageNoteRequireAt=performance.now();var it;function ct(){it?.()}var C;async function et(a){if(!a)return;let t=document;if(t.deweyParser=Z.default,t.html=document.documentElement.innerHTML,await k.evaluateIdentifierTree(a,t))return!0}async function ot(a){if(C)return;let t=(0,tt.v4)(),i=await q({deweyResult:a,runId:t}),e=p.default.get(i,"throttleDurationMs");if(!await h({domain:d(),message:"checkThrottled",throttleDurationMs:e})&&!C){if(C=!0,typeof i?.blocksTemplate=="string"&&i.blocksTemplate.length){let{blocksTemplate:c,blocksData:u}=i;it=(await w({appName:"blocksNotification",blankSlate:!0,app:(0,I.jsx)(J,{content:c,providedData:u,onUnload:ct}),disableDelay:!0})).unloadApp}else if(i&&!i.error&&(p.default.get(i,"heading.value")||p.default.get(i,"subheading.value")||p.default.get(i,"cta.value"))){if(p.default.get(i,"skipNotification")===!0){l("track","mirageNotificationSkipped");return}i.runId=t,f.set("mirageNotification",i),w({appName:"mirageNotification",cssUrl:"mirageNotification.css",app:(0,I.jsx)(D,{})})}}}async function Y(){try{let{siteData:a}=await O(),t=f.get(["deweyResult"]),i=await et(p.default.get(a,"mirageNotification.identifiers"));t&&i?await ot(t):pt(a)}catch(a){console.log(a)}}function pt(a){k.emitter.on("result",async t=>{await et(p.default.get(a,"mirageNotification.identifiers"))&&await ot(t)})}document.readyState!=="loading"?Y():document.addEventListener("DOMContentLoaded",Y);
