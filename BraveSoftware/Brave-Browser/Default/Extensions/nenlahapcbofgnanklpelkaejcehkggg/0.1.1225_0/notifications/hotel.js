import{a as at}from"../chunks/chunk-DU7HFEZV.js";import{a as q,b as dt,c as $,d as ft}from"../chunks/chunk-D63ZIPV5.js";import{a as O,b as V,d as K}from"../chunks/chunk-3H2LF7G7.js";import{a as G}from"../chunks/chunk-ALJKGYUM.js";import{a as nt}from"../chunks/chunk-G4GLYCCY.js";import{a as Z}from"../chunks/chunk-RNDVJQN2.js";import{a as ot}from"../chunks/chunk-IOEYPKEV.js";import{a as et,l as it}from"../chunks/chunk-NYGFFQMG.js";import{c as tt}from"../chunks/chunk-4GT6T77M.js";import"../chunks/chunk-JDV5FZKX.js";import{a as j}from"../chunks/chunk-B7GBMFFD.js";import{a as Y}from"../chunks/chunk-AKTW5CPL.js";import{a as J}from"../chunks/chunk-LLA7RVSB.js";import{a as E}from"../chunks/chunk-Z6PVZUDE.js";import{a as y}from"../chunks/chunk-FEK2HJKI.js";import{a as wt}from"../chunks/chunk-NJ63VSGO.js";import{f as R}from"../chunks/chunk-OTRTIFBS.js";import{a as X}from"../chunks/chunk-MFYKHTND.js";import{I as Q,J as D,a as N,b as F,c as x,l as _t}from"../chunks/chunk-3I3QPOUL.js";import"../chunks/chunk-O4TFJKJQ.js";import{c as w,d as L,h as T,q as P,u as f}from"../chunks/chunk-4SRFE46V.js";import"../chunks/chunk-LC5XJ32R.js";import"../chunks/chunk-6LTHT6DZ.js";import"../chunks/chunk-XSKOAVIS.js";import{q as M}from"../chunks/chunk-52XVUBCW.js";import{c as ut}from"../chunks/chunk-42JNP4CL.js";import{m as mt}from"../chunks/chunk-SOWOQI5E.js";import"../chunks/chunk-YCRAP75I.js";import"../chunks/chunk-JAUVA5AU.js";import{e as h}from"../chunks/chunk-3GYLW4KZ.js";var ve=h(N()),b=h(M()),pt=h(mt());ut();ft();dt();var A=n=>P("findHotel",n);var Mt=h(N()),st=h(N()),rt=h(_t()),I=h(wt()),d=h(M());var H=n=>P("visitHotel",n);var g=h(x()),U=class extends st.Component{state={};constructor(...e){super(...e),this.state={hideNotification:!0}}componentDidMount(){let e=d.default.get(this.props,"view.hotel");if(e){let t=this.getWikibuyHotelEventData(e);t.searchId=d.default.get(this.props.view,"searchId"),f("page","wbHotelNotification",t)}setTimeout(()=>{this.setState({hideNotification:!1})},500)}render(){let{hideNotification:e}=this.state,{hotel:t,url:s,discount:o,rewards:a,headerText:r,subheaderText:i,imageUrl:c,buttonText:p,footerText:u}=d.default.get(this.props,"view",{}),{stars:_,distance:v}=t,k=!0,C=!0;if(r)return(0,g.jsx)(j,{className:e?"disabled hotel-page":"hotel-page",style:{top:k?"0":"auto",bottom:k?"auto":"0",left:C?"auto":"0",right:C?"0":"auto"},dragSelector:"header",isDraggable:T("ext_notif_drag"),onDragEnd:this.trackFirstDragEnd,children:(0,g.jsx)(I.Motion,{style:{opacity:(0,I.spring)(e?0:1,{stiffness:180,damping:20}),y:(0,I.spring)(e?k?-100:100:0,{stiffness:180,damping:20})},children:({opacity:ht,y:gt})=>(0,g.jsxs)("div",{className:"hotel-notification",style:{transform:`translate3d(0,${gt}%,0)`,opacity:`${ht}`},children:[(0,g.jsxs)("header",{children:[(0,g.jsx)(X,{width:120}),(0,g.jsx)(tt,{}),(0,g.jsx)(E,{onClick:this.onClosePopup.bind(this,"x")})]}),(0,g.jsxs)("section",{children:[(0,g.jsx)("h2",{children:this.formatHeader(r,t,o,a)}),i&&(0,g.jsx)("h4",{style:{marginBottom:0},children:i.replace("{stars}",_).replace("{distance}",v)}),c&&(0,g.jsx)("img",{src:c,style:{width:"100%",marginTop:10},onError:W=>{W.target.onError=null,W.target.src=R+"/images/upload_content/hotel_placeholder_light.jpeg"}}),(0,g.jsx)("div",{className:"button-wrapper",children:(0,g.jsx)("button",{className:"primary-btn-large",onClick:()=>this.onClickDeal(s),children:p})}),u&&(0,g.jsx)("h6",{style:{fontStyle:"italic",marginTop:5},children:u})]})]})})})}trackFirstDragEnd=d.default.once((e,t)=>{ot("hotelNotification",e,t)});formatHeader(e,t,s,o){let a,r=t.address;return a=e.replace("{discount}",y(s,{removeCents:!0})).replace("{title}",t.name).replace("{city}",r.cityName).replace("{state}",r.stateCode!==""?r.stateCode:r.stateName),o&&o.amount&&o.type=="fixed"&&(a=a.replace("{rewards}",y(o.amount*100,{removeCents:!0}))),o&&o.amount&&o.type=="percentage"&&(a=a.replace("{rewards}",`${Math.floor(o.amount)}%`)),a}getTextProperties(){let e=rt.default.findDOMNode(this),t=e.querySelector("section"),o=e.querySelector("button").innerText;return{notificationText:t.innerText.replace(`
${o}`,""),ctaText:o}}async onClickDeal(e,t){let s=d.default.get(this.props,"view.hotel");s&&(f("trackClick","wbViewHotelDeal","view hotel",{...this.getWikibuyHotelEventData(s),dest_domain:"capitaloneshopping.com",dest_url:e,searchId:d.default.get(this.props.view,"searchId")}),H({redirect:e})),t||this.setState({hideNotification:!0})}onClosePopup(e){this.setState({hideNotification:!0});let t=d.default.get(this.props,"view.hotel.wikibuyHotel");if(t){let s=this.getWikibuyHotelEventData(t);s.searchId=d.default.get(this.props.view,"hotel.searchId"),f("trackClick","wbDismissHotelNotification",e,s)}else f("trackClick","dismissHotelNotification",e,{...this.getTextProperties(),type:"notification",view:"hotelNotification",searchId:d.default.get(this.props.view,"hotel.searchId")})}getWikibuyHotelEventData(e){let{address:t,id:s,name:o,offers:a}=e,r=d.default.get(this.props,"view.hotel.searchParams"),i={...this.getTextProperties(),...r,hotelId:s,hotelLocation:`${t.cityName}, ${t.stateCode}`,hotelName:o,pricePostDiscount:a[0].pricing.pricePostDiscount.toString(),pricePreDiscount:a[0].pricing.pricePreDiscount.toString(),type:"notification",url:location.href,view:"hotelNotification",searchId:d.default.get(this.props.view,"hotel.searchId")};return i.latitude=i.latitude?i.latitude.toString():i.latitude,i.longitude=i.longitude?i.longitude.toString():i.longitude,i}},z=F({view:["hotelView"],events:["events"],session:["session"]},U);var ee=h(N()),lt=h(N()),m=h(M());var l=h(x()),bt=({savings:n,rewards:e,savingsBtn:t,rewardsBtn:s,onClickDeal:o})=>{let a;if(n){let r=y(n,{removeCents:!0});a=t?t.replace("{discount}",r):`Save ${r}`}else if(e){let r=y(e,{removeCents:!0});a=s?s.replace("{rewards}",r):`Earn ${r} in rewards`}return(0,l.jsx)("div",{className:"wikibuy-savings-component",onClick:o,children:(0,l.jsx)("h4",{children:a})})},yt=({displayData:n,savings:e,rewards:t,hotel:s,onClickDeal:o,onClose:a})=>{let r,i,c,p,u,_,v="",k="",C=m.default.get(s,"photoUrl");if(e)({headerText:r,subheaderText:i,showImage:c,showHotelImage:p,buttonText:u,footerText:_}=n.savings),v=y(e,{removeCents:!0});else if(t)({headerText:r,subheaderText:i,showImage:c,showHotelImage:p,buttonText:u,footerText:_}=n.rewards),k=y(t,{removeCents:!0});else return;return(0,l.jsx)("section",{className:"annotation-tooltip-component",children:(0,l.jsxs)("div",{className:"annotation-tooltip-container",children:[(0,l.jsxs)("div",{className:"annotation-tooltip-header",children:[(0,l.jsx)("h2",{children:v?r.replace("{discount}",v):(0,l.jsx)("span",{className:"green-text",children:r.replace("{rewards}",`${k} in Rewards`)})}),(0,l.jsx)(E,{onClick:a.bind(void 0,"x")})]}),(0,l.jsxs)("div",{onClick:o,children:[i&&(0,l.jsx)("h4",{className:"text",style:{marginBottom:0},children:i.replace("{discount}",v).replace("{hotel_name}",s.name)}),c&&(0,l.jsx)(at,{className:"credits-icon"}),p&&C&&(0,l.jsx)("img",{src:C,style:{width:"100%",margin:"5px"}}),(0,l.jsx)("div",{className:"button-wrapper",children:(0,l.jsx)("button",{className:"primary-btn-large",children:u})}),_&&(0,l.jsx)("h6",{style:{fontStyle:"italic",marginTop:5},children:_})]})]})})},S=class extends lt.Component{state={isComplete:!1,savings:!1,rewards:!1,showSavingsDetails:!1};componentWillMount(){let e=this.props.inputData;A(e).then(t=>{this.setState({isComplete:!0}),w.set("hotelView",{data:t}),this.setState({responseData:t});let{discount:s,showNotif:o,wikibuyCreditsPerNight:a,wikibuyCredits:r,cashback:i,wikibuyHotel:c,url:p}=t,u={...c,url:p};this.setState({hotel:u}),o&&s?this.setState({savings:s}):a>0&&i&&this.setState({rewards:r})})}componentDidMount(){let e=this.state.responseData;f("page","hotelNotification",{type:"notification",view:"hotelNotification_inline",credits:!!m.default.get(e,"cashback.reward.amount"),creditsAmount:m.default.get(e,"cashback.reward.amount"),creditsType:m.default.get(e,"cashback.reward.type")})}onEnterSavingsButton(){this.props.hideDetails||(this.savingsDetailsLeaveTimeout&&clearTimeout(this.savingsDetailsLeaveTimeout),this.showSavingsDetails())}onLeaveSavingsButton(){this.savingsDetailsLeaveTimeout=setTimeout(()=>{this.hideSavingsDetails(),this.setState({preventInitialShow:!0})},500)}hideSavingsDetails(){this.setState({showSavingsDetails:!1,preventInitialShow:!0})}showSavingsDetails(){this.setState({showSavingsDetails:!0})}render(){let{displayData:e,hideDetails:t,btnStyle:s}=this.props,{savingsBtn:o,rewardsBtn:a}=e,{isComplete:r,savings:i,rewards:c,hotel:p}=this.state,u=this.state.showSavingsDetails;!this.state.preventInitialShow&&r&&(i||c)&&!t&&(u=!0,setTimeout(()=>{this.hideSavingsDetails()},2e3));let _=this.state.showSavingsDetails;return(0,l.jsx)("div",{className:`hotel-page-annotation ${_?"tooltip-open":""}`,children:(0,l.jsxs)("div",{className:`savings-button ${`${r?`${i||c?"savings":"no-savings"}`:"searching"}`}`,style:s||{},onMouseEnter:this.onEnterSavingsButton.bind(this),onMouseLeave:this.onLeaveSavingsButton.bind(this),children:[(0,l.jsx)(V,{}),r?i||c?(0,l.jsx)(bt,{savings:i,rewards:c,savingsBtn:o,rewardsBtn:a,onClickDeal:()=>{p&&(i||c)&&this.onClickDeal(p.url)}}):(0,l.jsx)(K,{}):(0,l.jsx)(O,{}),r&&(i||c)&&u?(0,l.jsx)(yt,{savings:i,rewards:c,displayData:e,url:p.url,hotel:p,onClickDeal:()=>this.onClickDeal(p.url),onClose:this.hideSavingsDetails.bind(this)}):null]})})}async onClickDeal(e,t){let s=m.default.get(this.state,"hotel"),o=m.default.get(this.state,"responseData.searchId"),a=m.default.get(this.state);if(s)f("trackClick","wbViewHotelDeal","view hotel",{...this.getWikibuyHotelEventData(s),dest_domain:"capitaloneshopping.com",dest_url:e,searchId:o}),H({redirect:e});else{let{clickId:r,redirectId:i}=Y(),c=m.default.get(this.props,"view.hotel.source");f("trackClick","viewHotelDeal","view hotel",{type:"notification",view:"hotelNotification_inline",source:c,redirectId:i,clickId:r,credits:!!m.default.get(a,"cashback.reward.amount"),creditsAmount:m.default.get(a,"cashback.reward.amount"),creditsType:m.default.get(a,"cashback.reward.type"),searchId:o});let p=`${e}&wsid=${r}`;p=J({params:{clickEvent:"viewHotelDeal",destUrl:p,redirectId:i,subExperience:"hotels_view_offer"},isWbPublisher:!0}),H({redirect:p})}t||this.setState({showSavingsDetails:!0})}getWikibuyHotelEventData(e){let{address:t,id:s,name:o,offers:a}=e,i={...m.default.get(this.state.responseData,"searchParams"),hotelId:s,hotelLocation:`${t.cityName}, ${t.stateCode}`,hotelName:o,pricePostDiscount:a[0].pricing.pricePostDiscount.toString(),pricePreDiscount:a[0].pricing.pricePreDiscount.toString(),type:"notification",url:location.href,view:"hotelNotification_inline",searchId:m.default.get(this.props.view,"hotel.searchId")};return i.latitude=i.latitude?i.latitude.toString():i.latitude,i.longitude=i.longitude?i.longitude.toString():i.longitude,i}componentWillUnmount(){this.savingsDetailsLeaveTimeout&&clearTimeout(this.savingsDetailsLeaveTimeout)}};var B=h(x());window.__wb_timing.hotelRequireAt=performance.now();async function vt(){let n=await Z();nt(n)}function kt(n){return(0,B.jsx)(z,{...n})}async function xt(n){let{props:e,...t}=n,s=location.hostname.replace(/^www\./,""),o=await A(b.default.assign({domain:s,pagePath:location.pathname},t));if(w.set("checkingHotels",!1),o&&(o.discount||o.rewards))L({active:!0}),w.set("hotelView",o),D({appName:"hotel",cssUrl:"hotel.css",app:kt(e)});else{let a=w.get("displayDealsViewIfDeal");typeof a=="function"&&a()}}function Dt(n){let{domain:e,contentData:t,...s}=n,o=b.default.assign({domain:e,pagePath:location.pathname},s),a=t&&t.selectorsByDomain?b.default.get(t.selectorsByDomain,e,null):null;if(!a)return;let r=t&&t.displayByDomain?b.default.get(t.displayByDomain,e,null):null;function i(c){return(0,B.jsx)(S,{...c})}if(L({active:!0}),e=="airbnb.com"){let[c,p]=a,u=document.querySelector(c.selector),_=document.querySelector(p.selector);D({appName:"hotel",cssUrl:"hotel.css",app:i({inputData:o,displayData:r,btnStyle:c.btnStyle}),insertAfterElement:u}),D({appName:"hotel",cssUrl:"hotel.css",app:i({inputData:o,displayData:r,hideDetails:!0,btnStyle:p.btnStyle}),insertAfterElement:_,mountClass:"_14f4nnk",allowToHide:!0})}else D({appName:"hotel",cssUrl:"hotel.css",app:i({inputData:o,displayData:r,btnStyle:a.btnStyle}),insertBeforeElement:document.querySelector(a.selector)})}var St=(n,e)=>{let t={...n};t.title=q(n.name),t.address=q(n.address),t.rooms=parseInt(n.room_count),t.adults=parseInt(n.adults_stay),t.children=parseInt(n.children_stay),t.latitude=n.latitude?n.latitude.toString():"",t.longitude=n.longitude?n.longitude.toString():"",f("track","deweyHotelSearch",{...t,url:e})},Ct=n=>{let e=[];for(let t of n){let s=t.key.toLowerCase();if(s=="hotels"&&(s="hcom"),t.value){let o={};o[s]=t.value,e.push(o)}}return e};async function Nt(n,e){let t=b.default.get(n,"pageData.hotel",{}),s=b.default.get(n,"pageData.meta");s&&(t={...s,...t}),t.domain=e,t.checkIn=$(t.check_in_date?t.check_in_date:t.checkIn),t.checkOut=$(t.check_out_date?t.check_out_date:t.checkOut);let o=b.default.get(t,"meta_partner_id[0]"),a=[];o&&(a=Ct(o),t.exactMatchMap=a),St(t,location.href),t.domain=e;let r=T("hotel_inline_conquesting"),i;r&&(e==="airbnb.com"||e==="google.com")&&(i=await et({contentSlug:"hotel-inline-conquesting",contentProps:{domain:e}})),i?Dt({data:t,domain:e,deweyResult:n,exactMatchMap:a,inlineConquestingContentData:i}):xt({data:t,deweyResult:n,exactMatchMap:a})}async function Ht(n){let e=await it({deweyResult:n});e&&e.ui&&D({appName:"hotelsForFlights",blankSlate:!0,app:(0,B.jsx)(G,{content:e})})}async function ct(){w.set("checkingHotels",!0),await vt();let n=pt.default.getDomain(window.location.href);Q("hotel");try{let e=b.default.cloneDeep(w.get("deweyResult")||{});if(e.pageType,e.pageType==="hotelsPage")await Nt(e,n);else if(e.pageType==="confirmationPage")await Ht(e);else return}catch(e){w.set("checkingHotels",!1),console.error(e)}}document.readyState!=="loading"?ct():document.addEventListener("DOMContentLoaded",ct);
