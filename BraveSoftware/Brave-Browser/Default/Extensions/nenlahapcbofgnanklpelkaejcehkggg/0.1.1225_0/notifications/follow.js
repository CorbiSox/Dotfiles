import{a as Q}from"../chunks/chunk-QN7PJSSJ.js";import{a as F}from"../chunks/chunk-DU7HFEZV.js";import{a as L}from"../chunks/chunk-RFNJKUZW.js";import{a as K}from"../chunks/chunk-G4GLYCCY.js";import{a as H}from"../chunks/chunk-RNDVJQN2.js";import{a as J}from"../chunks/chunk-3MQH4JJT.js";import{a as X}from"../chunks/chunk-NZY4JV6E.js";import{c as Y}from"../chunks/chunk-4GT6T77M.js";import{a as M}from"../chunks/chunk-Z6PVZUDE.js";import{a as W}from"../chunks/chunk-FEK2HJKI.js";import{a as E}from"../chunks/chunk-NJ63VSGO.js";import"../chunks/chunk-OTRTIFBS.js";import{a as I}from"../chunks/chunk-MFYKHTND.js";import{J as j,a as k,b as T,c as h}from"../chunks/chunk-3I3QPOUL.js";import"../chunks/chunk-O4TFJKJQ.js";import{c as r,q as g,u}from"../chunks/chunk-4SRFE46V.js";import{a as B,d as ct}from"../chunks/chunk-RXMLGJMT.js";import"../chunks/chunk-6LTHT6DZ.js";import"../chunks/chunk-XSKOAVIS.js";import{q as P}from"../chunks/chunk-52XVUBCW.js";import"../chunks/chunk-42JNP4CL.js";import{n as pt}from"../chunks/chunk-SOWOQI5E.js";import"../chunks/chunk-YCRAP75I.js";import"../chunks/chunk-JAUVA5AU.js";import{e as c}from"../chunks/chunk-3GYLW4KZ.js";var pe=c(k()),nt=c(pt()),N=c(P());var Dt=c(k()),it=c(k()),v=c(E()),s=c(P());var _=c(P());var Z=i=>g("addVote",i);var tt=i=>g("getFeedbackData",i);function w(i){return i=i==="video"?"review":i,i==="advice"?i:`${i}s`}async function lt(){let i=r.get(["ProductPage","inputData","product"]),t=r.get(["ProductPage","inputData","asin"]),e=r.get(["ProductPage","inputData","feedback"]),n=r.get(["session","id"]),p=i&&i.wbpid?i.wbpid:`amazon.com_${t}`,o=await tt({wbpid:p,userId:n,product:i,meta:e});r.set(["ProductPage","feedbackData"],o)}function dt(i,t){let e=(t||i).split(".")[0];e==="video"&&(e="review");let n=r.get(["ProductPage","feedbackData"]),p;if(t){let o=_.default.find(n[w(e)],{id:t});p=_.default.find(_.default.get(o,"comments"),{id:i})}else n&&(p=_.default.find(n[w(e)],{id:i}));return{feedback:p,type:e}}function ft({feedback:i,updatedFeedback:t,type:e,data:n}){n.parent_id?(r.select(["ProductPage","feedbackData",w(e),{id:n.parent_id}]).set(["comments",{id:n.id}],t),n.parent_id===r.get(["selectedFeedback","id"])&&r.set(["selectedFeedback","comments",{id:n.id}],t)):(r.merge(["ProductPage","feedbackData",w(e),{id:n.id}],t),i.id===r.get(["selectedFeedback","id"])&&r.set(["selectedFeedback"],t))}function ut({feedback:i,type:t}){let e=r.get(["ProductPage","feedbackData",w(t)]);e&&(e.push(i),r.set(["ProductPage","feedbackData",w(t)],e),r.commit())}async function A(i){let t=r.get(["session","id"]),{feedback:e,type:n}=dt(i.id,i.parent_id);function p(o){return o=_.default.clone(o),o.up_votes=o.up_votes||0,o.down_votes=o.down_votes||0,o.up_votes=i.upVote?o.up_votes+1:o.up_votes,o.down_votes=i.upVote?o.down_votes:o.down_votes+1,o.vote_selection==="up_vote"&&(o.up_votes-=1),o.vote_selection==="down_vote"&&(o.down_votes-=1),o.vote_selection=i.upVote?"up_vote":"down_vote",o}if(e){let o=p(e);ft({feedback:e,updatedFeedback:o,type:n,data:i})}else{let o=p(i);ut({feedback:o,type:n})}await Z(_.default.assign({userId:t},i)),await lt()}var et=i=>g("toggleMatchSurvey",i);var a=c(h()),V=class extends it.Component{constructor(...t){super(...t),this.state={title:"Was this a good result?",subtitle:"Your feedback helps other Capital One Shoppers.",hideNotification:!0,showReasons:!1,showComment:!1,selectedReasons:[],reasonText:"",dismiss:!1}}componentDidMount(){u("page","matchSurvey",{view:"matchSurvey",type:"notification",offerSignUp:s.default.get(this.props.view,"offerSignUp"),qualified:s.default.get(this.props.view,"qualified",!1),balance:s.default.get(this.props.view,"balance",0)}),setTimeout(()=>{this.setState({hideNotification:!1})},1e3)}componentWillReceiveProps(t){s.default.get(t,"view.hiddenFromWebApp")&&!s.default.get(this.props,"view.hiddenFromWebApp")&&this.setState({hideNotification:!0})}onChange(t,e){if(e.type==="input")return;let n=this.state.selectedReasons,p=n.indexOf(t);p===-1?n.push(t):n.splice(p,1),this.setState({selectedReasons:n})}onTextUpdate(t){let e=t.target.value;this.setState({reasonText:e})}renderReasons(){let t=["Not the same product","Price is incorrect","Out of stock","Item condition","Bad seller","Other"],e;return this.state.showReasons&&(e=s.default.map(t,(n,p)=>{let o=this.state.selectedReasons.indexOf(n)!==-1;return(0,a.jsxs)("div",{className:"reason",children:[(0,a.jsx)("input",{type:"checkbox",checked:o,onChange:this.onChange.bind(this,n),id:s.default.kebabCase(n)}),(0,a.jsx)("label",{htmlFor:s.default.kebabCase(n),children:(0,a.jsx)("h5",{className:"text",children:n})})]},s.default.kebabCase(n))})),(0,a.jsxs)("div",{className:"reasons-wrapper",children:[e,(0,a.jsx)("textarea",{placeholder:"tell us more",value:this.state.reasonText,onChange:this.onTextUpdate.bind(this)}),(0,a.jsx)("button",{className:"primary-btn-small",onClick:this.onSubmit.bind(this),children:"Submit"})]})}render(){let{hideNotification:t}=this.state,e=this.state.title,n=this.state.subtitle,p=!1,o=!1,f;return this.state.showReasons||this.state.showComment?f=this.renderReasons():this.state.dismiss||this.state.buttonsHidden?f=(0,a.jsx)("div",{className:"thanks-wrapper"}):f=(0,a.jsxs)("div",{className:"button-wrapper",children:[(0,a.jsx)("button",{className:"secondary-btn-small",onClick:this.onYes.bind(this),children:"Yes"}),(0,a.jsx)("button",{className:"secondary-btn-small",onClick:this.onNo.bind(this),children:"No"})]}),(0,a.jsx)("div",{className:t?"disabled follow-page":"follow-page",style:{top:p?"0":"auto",bottom:p?"auto":"0",left:o?"auto":"0",right:o?"0":"auto"},children:(0,a.jsx)(v.Motion,{style:{opacity:(0,v.spring)(t?0:1,{stiffness:180,damping:20}),y:(0,v.spring)(t?p?-100:100:0,{stiffness:180,damping:20})},children:({opacity:R,y})=>(0,a.jsxs)("div",{className:"follow-notification",style:{transform:`translate3d(0,${y}%,0)`,opacity:`${R}`},children:[(0,a.jsxs)("header",{style:{display:"flex",justifyContent:"space-between"},children:[(0,a.jsx)(I,{}),(0,a.jsx)(M,{onClick:this.onClosePopup.bind(this,"x")})]}),(0,a.jsxs)("section",{children:[(0,a.jsx)("h2",{children:e}),n?(0,a.jsx)("h4",{children:n}):null,f]})]})})})}onYes(){let t=s.default.get(this.props,"view.resultData");A({up_votes:0,down_votes:0,id:`product.${s.default.get(t,"details.product.wbpid")}`,wbpid:s.default.get(t,"run.originResult.product.wbpid"),match_wbpid:s.default.get(t,"details.product.wbpid"),upVote:!0}),this.onNotificationInteraction(),this.setState({match:!0,title:"Thanks!",subtitle:"Your vote helps improve results for everyone on Capital One Shopping.",buttonsHidden:!0}),this.timeout=setTimeout(()=>{this.setState({hideNotification:!0})},2500);let e={match:!0,quoteId:s.default.get(t,"run.id"),matchId:s.default.get(t,"details.id"),notification:!0,mpnBrandMatch:s.default.get(t,"details.meta.imsMpnBrandMatch",!1),certifiedRefurbished:s.default.get(t,"details.certifiedRefurbished",!1)};u("track","matchSurvey",e)}onNo(){let t=s.default.get(this.props,"view.resultData");A({up_votes:0,down_votes:0,id:`product.${s.default.get(t,"details.product.wbpid")}`,wbpid:s.default.get(t,"run.originResult.product.wbpid"),match_wbpid:s.default.get(t,"details.product.wbpid"),upVote:!1}),this.onNotificationInteraction(),this.setState({match:!1,showReasons:!0,showComment:!0,title:"Uh oh!",subtitle:"What was wrong with this result?"});let e={match:!1,quoteId:s.default.get(t,"run.id"),matchId:s.default.get(t,"details.id"),notification:!0,mpnBrandMatch:s.default.get(t,"details.meta.imsMpnBrandMatch",!1),certifiedRefurbished:s.default.get(t,"details.certifiedRefurbished",!1)};u("track","matchSurvey",e)}onSubmit(){this.onNotificationInteraction();let t=s.default.get(this.props,"view.resultData"),e={match:this.state.match,quoteId:t.run.id,matchId:t.details.id,notification:!0};this.state.reasonText&&(e.text=this.state.reasonText),this.state.selectedReasons&&this.state.selectedReasons.length&&(e.reason=s.default.get(this.state.selectedReasons,"[0]"),e.reasons=this.state.selectedReasons),u("track","matchSurveyReason",e),this.setState({dismiss:!0,showReasons:!1,showComment:!1,title:"Thanks for helping!",subtitle:"The next Capital One Shopper will benefit from your contribution."}),setTimeout(()=>this.onClosePopup("submit"),3200)}onClosePopup(t){this.onNotificationInteraction(),this.setState({hideNotification:!0}),u("trackClick","dismissMatchSurvey",t)}onNotificationInteraction(){et(s.default.get(this.props,"view.resultData"))}componentWillUnmount(){clearTimeout(this.timeout)}},U=T({view:["followView"],events:["events"],session:["session"]},V);var Lt=c(k()),x=c(k()),C=c(E()),$=c(P());ct();var l=c(h()),mt=i=>{let{autoGC:t,hasCredits:e,hasCoupons:n}=i,o=$.default.get(t,"redemptionEnabled")?$.default.get(t,"redemptionAmount",0):0,f=!0,R=!0,[y,O]=(0,x.useState)(!0),[q,st]=(0,x.useState)(0);(0,x.useEffect)(()=>{u("page",e?"autoGCReminder":"couponReminder",{view:"savingsReminder",type:"notification",hasCredits:e}),at(),setTimeout(()=>{O(!1)},1e3)},[]);async function at(){O(!1);let d=200,m=1;for(;d<7e3;){let S=Q();S.updated&&st(S.offset),await B(d),m>25&&(d*=1.5),m+=1}}function rt(){let d='Add to cart, continue to checkout, and click "Redeem my Rewards" when prompted.',m=`${d} We'll try available coupons to increase your dicsount.`,S="Add to cart, continue to checkout, and click try codes to see your discount.",D="";return e&&n?D=m:e?D=d:D=S,(0,l.jsx)("h5",{className:"description",children:D})}return(0,l.jsx)("div",{className:y?"disabled savings-reminder-page":"savings-reminder-page",style:{top:f?"0":"auto",bottom:f?"auto":"0",left:R?"auto":"0",right:q||(R?"15px":"auto")},children:(0,l.jsx)(C.Motion,{style:{opacity:(0,C.spring)(y?0:1,{stiffness:180,damping:20}),y:(0,C.spring)(y?f?-100:100:0,{stiffness:180,damping:20})},children:({opacity:d,y:m})=>(0,l.jsxs)("div",{className:"savings-reminder-notification",style:{transform:`translate3d(0,${m}%,0)`,opacity:`${d}`},children:[(0,l.jsxs)("header",{children:[(0,l.jsx)(I,{}),(0,l.jsx)(Y,{}),(0,l.jsx)(M,{onClick:z.bind(void 0,"x")})]}),(0,l.jsxs)("section",{children:[(0,l.jsx)("h2",{className:"align-center",children:e?`${W(o,{removeCents:!0})} Rewards redemption applied at checkout`:"Savings applied at checkout"}),(0,l.jsx)(F,{}),rt(),(0,l.jsx)("div",{className:"button-wrapper",children:(0,l.jsx)("button",{className:"primary-btn-large",onClick:()=>z("Got it"),children:"Got it!"})})]})]})})});function z(d){O(!0),u("trackClick",e?"dismissAutoGCReminderNotification":"dismissCouponReminderNotification",d,{hasCredits:e})}},G=T({},mt);var b=c(h());window.__wb_timing.followRequireAt=performance.now();function _t(){return nt.default.all([H(),X(),L()]).spread((i,t,e)=>{K(i),r.merge({siteAPIData:t}),r.set("lifetimeSavings",e)})}async function ot(){await _t();let i=r.get(["followView","resultData"]),t=N.default.get(i,"details.pricing.coupons.length"),e=N.default.get(i,"details.pricing.autoGC",{}),n=N.default.get(e,"redemptionEnabled",!1),p=N.default.get(i,"details.pricing.credits.qualifyToRedeemCredits",!1),o=n&&p;o&&J(i),j({appName:"follow",cssUrl:"follow.css",app:(f=>(0,b.jsx)(b.Fragment,{children:t||o?(0,b.jsx)(G,{autoGC:e,hasCredits:o,hasCoupons:t}):(0,b.jsx)(U,{})}))()})}document.readyState!=="loading"?ot():document.addEventListener("DOMContentLoaded",ot);
